###Maginot Changes

########################
### Military Theory ####
########################

# Main tech
giga_tech_maginot_world = {
	cost = @giga_tier6cost2
	area = society
	tier = 5
	category = { military_theory }
	is_rare = yes
	prerequisites = { "tech_mega_engineering" "giga_tech_asteroid_artillery" }
	weight = @tier5weight3
	prereqfor_desc = {
		hide_prereq_for_desc = component
		hide_prereq_for_desc = ship
		hide_prereq_for_desc = army # cwtools errors but this does work, armies are hidden from tooltip
		custom = { title = "allow_maginot"	desc = "maginot_desc" }
		#custom = { title = "allow_maginot_strategic_defence_command_platform"	desc = "maginot_strategic_defence_command_platform_desc" }
	}
	modifier = {
		country_naval_cap_add = 50
		army_defense_health_mult = 0.25 # improved bunker techniques or something idk
		army_defense_morale_mult = 0.25
	}

	potential = {
		has_any_galactic_wonders_dlc = yes
		NOT = { has_global_flag = maginot_disabled }
	}

	weight_modifier = {
		# Maginot requires galactic wonders unless bypass below is true, which adds weight after the zeroing here and will roll the tech
		# must not be in potential to work, and must not be moved
		modifier = { factor = 0
			has_galactic_wonders = no 
		}
		# finishing the unyielding tree is required unless bypassed
		modifier = { factor = 0
			has_maginot_defensive_tradition_prereq = no
		}
		# bypass: if overlord or a fellow scholarium subject has the tech, then a bulwark can roll it regardless of conditions
		# and will be vastly more likely to roll if they do meet conditions
		# additionally: if overlord/scholarium has the prerequisites, but not the tech (say they did not pick Unyielding),
		# but the Bulwark does have it, then the Bulwark can get Maginot worlds by leeching off them
		modifier = { add = @tier5weight3
			is_specialist_subject_type = { TYPE = bulwark }
			exists = overlord
			overlord = {
				OR = {
					# overlord either
					# has maginot tech on their own
					has_technology = giga_tech_maginot_world
					# or prerequisites
					AND = {
						has_galactic_wonders = yes
						has_technology = giga_tech_asteroid_artillery
						# and the original Bulwark must have Unyielding (and mega-engineering)
						root = { has_maginot_defensive_tradition_prereq = yes }
					}
					# or a Scholarium subject
					any_subject = {
						is_specialist_subject_type = { TYPE = scholarium }
						OR = {
							# either
							# has maginot world tech on their own
							has_technology = giga_tech_maginot_world
							# or the prerequisites
							AND = {
								has_galactic_wonders = yes
								has_technology = giga_tech_asteroid_artillery
								# but the original Bulwark must have Unyielding (and mega-engineering)
								root = { has_maginot_defensive_tradition_prereq = yes }
							}
						}
					}
				}
			}
		}
		# AI get help to roll it because of their random AP/tradition spam
		modifier = { add = @giga_tier6weight3 # but less likely than getting it properly
			is_ai = yes
			OR = {
				has_ascension_perk = ap_eternal_vigilance
				has_tradition = tr_gigabulwark_adopt
				has_tradition = tr_unyielding_adopt
			}
		}

		# it is intended that bulwarks using the bypass also get the tech weight boost from the inline block
		inline_script = technology/defensive_tech_weight_bonus
		
		inline_script = {
			script = technologies/rare_technologies_weight_modifiers
			TECHNOLOGY = giga_tech_maginot_world
		}
	}

	ai_weight = {
		# the AI should basically always pick this tech if it somehow managed to get the APs required, and so should auto-research
		factor = @giga_aiweight_multiplier_strong

		# ai bulwarks should really pick this
		# auto-research uses these weights according to vanilla comments, hence specifying is AI
		modifier = {
			factor = 10.0 
			is_ai = yes 
			is_specialist_subject_type = { TYPE = bulwark } 
		}
		modifier = {
			factor = 2
			is_ai = yes 
			OR = {
				has_ai_personality = xenophobic_isolationists
			}
		}
	}
}

# TODO: these should be modified when the actual defence system for the maginot is redone too

# Buff tech
giga_tech_maginot_firepower_1 = {
	cost = @giga_tier6cost3
	area = society
	tier = 5
	category = { military_theory }
	prerequisites = { "giga_tech_maginot_world" "tech_mass_accelerator_2" } 
	weight = @giga_tier6weight2
	#is_rare = yes
	prereqfor_desc = {
		custom = { title = "allow_giga_maginot_firepower_1"	desc = "allow_giga_maginot_firepower_1" }
	}

	weight_modifier = {
		modifier = { factor = @giga_tech_weight_boost_massive has_ascension_perk = ap_eternal_vigilance } # reward full defence focus
		inline_script = {
			script = technologies/rare_technologies_weight_modifiers
			TECHNOLOGY = giga_tech_maginot_firepower_1
		}
		modifier = { factor = 0		has_global_flag = maginot_disabled }
	}

	ai_weight = {
		factor = @giga_aiweight_multiplier_medium	#You have it now use it.
	}
}

giga_tech_maginot_planetcraft_upgrade = {
	cost = @giga_tier7cost3
	area = engineering
	tier = 5
	category = { voidcraft }
	prerequisites = { "giga_tech_maginot_firepower_1" "giga_tech_war_planet" } 
	weight = @giga_tier6weight3
	is_rare = yes
	prereqfor_desc = {
		custom = { title = "allow_giga_maginot_planetcraft_upgrade"	desc = "allow_giga_maginot_planetcraft_upgrade" }
	}

	weight_modifier = {
		modifier = { factor = @giga_tech_weight_boost_massive has_ascension_perk = ap_eternal_vigilance } # reward full defence focus
		inline_script = {
			script = technologies/rare_technologies_weight_modifiers
			TECHNOLOGY = giga_tech_maginot_planetcraft_upgrade
		}
		modifier = { factor = 0		has_global_flag = maginot_disabled }
	}

	ai_weight = {
		factor = @giga_aiweight_multiplier_strong	#Defend yourself.
	}
}

giga_tech_maginot_systemcraft_upgrade = {
	cost = @giga_250_000_cost
	area = engineering
	tier = 5
	category = { voidcraft }
	prerequisites = { "giga_tech_maginot_planetcraft_upgrade" "giga_tech_war_system_6" } 
	weight = @giga_tier7weight3
	is_rare = yes
	prereqfor_desc = {
		custom = { title = "allow_giga_maginot_systemcraft_upgrade"	desc = "allow_giga_maginot_systemcraft_upgrade" }
	}

	weight_modifier = {
		modifier = { factor = @giga_tech_weight_boost_massive has_ascension_perk = ap_eternal_vigilance } # reward full defence focus
		inline_script = {
			script = technologies/rare_technologies_weight_modifiers
			TECHNOLOGY = giga_tech_maginot_systemcraft_upgrade
		}
		modifier = { factor = 0		has_global_flag = maginot_disabled }
	}

	ai_weight = {
		factor = @giga_aiweight_multiplier_insane	#what the fuck.
	}
}

