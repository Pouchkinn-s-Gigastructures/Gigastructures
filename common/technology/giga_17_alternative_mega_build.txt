
giga_tech_amb_supertensiles = {
	cost = @tier3cost1
	area = physics
	tier = 1 # we need to be able to draw this potentially from the very start
	category = { field_manipulation }
	prerequisites = {} # notionally behind mega-engineering but prereqs are handled in weights because we need this earlier depending on setup
	weight = @tier3weight1

	potential = { has_global_flag = @giga_amb_flag }

	modifier = {
		country_base_giga_sr_amb_megaconstruction_produces_add = 10
	}

	weight_modifier = {
		# do not draw if
		modifier = { factor = 0
			# none of these are true
			nor = {
				has_technology = tech_starbase_3 # requirement for vanilla early megas
				count_owned_megastructure = { count > 0 limit = { giga_is_wrecked_ship = no } } # if we have any megas we probably need this to upgrade 
				has_country_flag = giga_sr_amb_megaconstruction_found # if we found some in the wild we should be able to research it
			}
		}

		modifier = { factor = 0 not = { has_global_flag = @giga_amb_flag }}
	}

	ai_weight = {
		factor = @giga_aiweight_multiplier_strong # if this pops up the AI should really consider investing since they likely need it
		modifier = {
			factor = 100 
			or = {
				check_variable = { which = giga_amb_building_technical value > 0 }
				check_variable = { which = giga_amb_building_kilos value > 0 }
				check_variable = { which = giga_amb_building_megas value > 0 }
				check_variable = { which = giga_amb_building_gigas value > 0 }
			}
		} # if we are currently building a mega we REALLY need this
	}
}

giga_tech_amb_living_metal_infusion = {
	cost = @tier5cost1
	area = engineering
	tier = 5
	category = { materials }
	prerequisites = {
		tech_mine_living_metal
		giga_tech_amb_supertensiles
	}
	is_rare = yes
	weight = @tier5weight1

	potential = { has_global_flag = @giga_amb_flag }

	weight_modifier = {
		modifier = {
			factor = 0.25
			NOR = {
				has_trait_in_council = { TRAIT = leader_trait_curator }
				has_trait_in_council = { TRAIT = leader_trait_spark_of_genius }
				has_trait_in_council = { TRAIT = leader_trait_expertise_materials }
			}
		}
		inline_script = {
			script = technologies/rare_technologies_weight_modifiers
			TECHNOLOGY = giga_tech_amb_living_metal_infusion
		}

		modifier = { factor = 0 not = { has_global_flag = @giga_amb_flag }}
	}

	ai_weight = {
		factor = @giga_aiweight_multiplier_medium
	}
}

giga_tech_amb_sentient_metal_molecular_foundries = {
	cost = @tier5cost1
	area = physics
	tier = 5
	category = { computing }
	prerequisites = {
		tech_ehof_sentient_tier_3
		giga_tech_amb_supertensiles
	}
	is_rare = yes
	weight = @tier5weight1

	potential = { has_global_flag = @giga_amb_flag }

	weight_modifier = {
		modifier = {
			factor = 0.25
			NOR = {
				has_trait_in_council = { TRAIT = leader_trait_curator }
				has_trait_in_council = { TRAIT = leader_trait_spark_of_genius }
				has_trait_in_council = { TRAIT = leader_trait_expertise_computing }
			}
		}
		inline_script = {
			script = technologies/rare_technologies_weight_modifiers
			TECHNOLOGY = giga_tech_amb_sentient_metal_molecular_foundries
		}

		modifier = { factor = 0 not = { has_global_flag = @giga_amb_flag }}
	}

	ai_weight = {
		factor = @giga_aiweight_multiplier_medium
	}
}

giga_tech_orbital_ring_supertensiles_mine_hub = {
	cost = @tier4cost2
	area = engineering
	tier = 4
	is_rare = yes
	category = { industry }
	prerequisites = { tech_orbital_ring_tier_1 giga_tech_amb_supertensiles  }
	weight = @tier4weight3

	potential = {
		has_global_flag = @giga_amb_flag
		has_overlord_dlc = yes
	}

	weight_modifier = {
		factor = 0.5
		modifier = { factor = 0 has_overlord_dlc = no }
		modifier = { factor = 0 not = { any_owned_planet = { has_building = building_giga_supertensiles_mines } } }
		inline_script = {
			script = technologies/rare_technologies_weight_modifiers
			TECHNOLOGY = giga_tech_orbital_ring_supertensiles_mine_hub
		}
	}

	ai_weight = {
		modifier = { factor = 0 has_overlord_dlc = no }
	}
}

giga_tech_fe_megaworkshop_1 = {
	area = physics
	cost = @fallentechcost
	tier = @fallentechtier
	category = { field_manipulation }
	ai_update_type = all
	weight = @tier5weight3
	is_rare = yes

	potential = { has_global_flag = @giga_amb_flag }

	weight_modifier = {
		modifier = {
			factor = 0
			NOT = {
				has_crisis_level = crisis_cosmogenesis_level_5
			}
		}
		modifier = {
			factor = 1.5
			has_ascension_perk = ap_technological_ascendancy
		}
		modifier = {
			factor = 2
			any_owned_planet = {
				is_planet_class = pc_cosmogenesis_world
				num_pops > 50
			}
		}
	}
}

giga_tech_fe_megaworkshop_2 = {
	area = physics
	cost = @fallentechcost
	tier = @fallentechtier
	category = { field_manipulation }
	ai_update_type = all
	weight = @tier5weight3
	is_rare = yes

	potential = { has_global_flag = @giga_amb_flag }

	prerequisites = { giga_tech_fe_megaworkshop_1 }
}


############################################################################################################################################
# ACOT compat


giga_tech_amb_supertensiles_acot_delta = {
	cost = @acot_tier6cost2
	area = physics
	tier = 6
	category = { field_manipulation }
	prerequisites = { giga_tech_amb_supertensiles tech_dark_matter_power_core_dm }
	weight = @tier5weight1

	potential = { 
		has_acot = yes
		has_global_flag = @giga_amb_flag

		NOT = { has_global_flag = acot_building_forbidden }
	}

	weight_modifier = {
		modifier = { factor = 0 not = { has_global_flag = @giga_amb_flag }}
	}

	ai_weight = {
		factor = @giga_aiweight_multiplier_medium
	}
}

giga_tech_amb_supertensiles_acot_alpha = {
	cost = @acot_tier7cost2
	area = physics
	tier = 7
	category = { field_manipulation }
	prerequisites = { giga_tech_amb_supertensiles_acot_delta tech_dark_matter_power_core_ae }
	weight = @tier5weight1

	potential = { 
		has_acot = yes
		has_global_flag = @giga_amb_flag

		NOT = { has_global_flag = acot_building_forbidden }
		has_technology = tech_dark_matter_power_core_ae
	}

	weight_modifier = {
		modifier = { factor = 0 not = { has_global_flag = @giga_amb_flag }}
	}

	ai_weight = {
		factor = @giga_aiweight_multiplier_medium
	}
}

giga_tech_amb_supertensiles_acot_phanon = {
	cost = @acot_tier8cost2
	area = physics
	tier = 8
	category = { field_manipulation }
	prerequisites = { giga_tech_amb_supertensiles_acot_alpha tech_civil_phanon_application }
	weight = @tier5weight1

	potential = { 
		has_acot = yes
		has_global_flag = has_aot_mod
		has_global_flag = @giga_amb_flag

		NOT = { has_global_flag = aot_phanon_content_OFF }
		has_technology = tech_civil_phanon_application
	}

	weight_modifier = {
		modifier = { factor = 0 not = { has_global_flag = @giga_amb_flag }}
	}

	ai_weight = {
		factor = @giga_aiweight_multiplier_medium 
	}
}

giga_tech_amb_supertensiles_acot_sigma = {
	cost = @acot_tier9cost2
	area = physics
	tier = 9
	category = { field_manipulation }
	prerequisites = { giga_tech_amb_supertensiles_acot_phanon tech_dark_matter_power_core_se }
	weight = @tier5weight1

	potential = { 
		has_acot = yes
		has_global_flag = has_aot_mod
		has_global_flag = @giga_amb_flag

		NOT = { has_global_flag = acot_building_forbidden }
		has_technology = tech_dark_matter_power_core_se
	}

	weight_modifier = {
		modifier = { factor = 0 not = { has_global_flag = @giga_amb_flag }}
	}

	ai_weight = {
		factor = @giga_aiweight_multiplier_medium 
	}
}

