ehof_giga_new_initialize_system = {
	switch = {
		trigger = galaxy_size
		huge = {
			ehof_giga_new_initialize_system_2 = {
				ehof_init_min_angle = $ehof_init_min_angle$
				ehof_init_max_angle = $ehof_init_max_angle$
				min_distance = @ehof_init_huge_min_distance
				max_distance = @ehof_init_huge_max_distance
			}
		}
		large = {
			ehof_giga_new_initialize_system_2 = {
				ehof_init_min_angle = $ehof_init_min_angle$
				ehof_init_max_angle = $ehof_init_max_angle$
				min_distance = @ehof_init_large_min_distance
				max_distance = @ehof_init_large_max_distance
			}
		}
		medium = {
			ehof_giga_new_initialize_system_2 = {
				ehof_init_min_angle = $ehof_init_min_angle$
				ehof_init_max_angle = $ehof_init_max_angle$
				min_distance = @ehof_init_medium_min_distance
				max_distance = @ehof_init_medium_max_distance
			}
		}
		small = {
			ehof_giga_new_initialize_system_2 = {
				ehof_init_min_angle = $ehof_init_min_angle$
				ehof_init_max_angle = $ehof_init_max_angle$
				min_distance = @ehof_init_small_min_distance
				max_distance = @ehof_init_small_max_distance
			}
		}
		tiny = {
			ehof_giga_new_initialize_system_2 = {
				ehof_init_min_angle = $ehof_init_min_angle$
				ehof_init_max_angle = $ehof_init_max_angle$
				min_distance = @ehof_init_tiny_min_distance
				max_distance = @ehof_init_tiny_max_distance
			}
		}
		default = {
			ehof_giga_new_initialize_system_2 = {
				ehof_init_min_angle = $ehof_init_min_angle$
				ehof_init_max_angle = $ehof_init_max_angle$
				min_distance = @ehof_init_default_min_distance
				max_distance = @ehof_init_default_max_distance
			}
		}
	}
	# log = "test test giga_new mod called"
	# print_scope_effect = yes
}

ehof_giga_new_initialize_system_2 = {
	no_scope = {
		spawn_system = {
			min_orientation_angle = $ehof_init_min_angle$
			max_orientation_angle = $ehof_init_max_angle$
			min_distance >= $min_distance$
			max_distance <= $max_distance$
			hyperlane = no
			initializer = "ehof_origin_cohesive_cluster"
			effect = {
				save_event_target_as = giga_last_ehof_spawn
			}
		}
	}
}

ehof_giga_new_create_new_system = {
	switch = {
		trigger = galaxy_size
		huge = {
			no_scope = {
				spawn_system = {
					min_orientation_angle = $ehof_init_min_angle$
					max_orientation_angle = $ehof_init_max_angle$
					min_distance >= @ehof_init_huge_min_distance
					max_distance <= @ehof_init_huge_max_distance
					hyperlane = $hyperlane$
					initializer = $initializer$
					effect = {
						save_event_target_as = giga_last_ehof_spawn
					}
				}
			}
		}
		large = {
			no_scope = {
				spawn_system = {
					min_orientation_angle = $ehof_init_min_angle$
					max_orientation_angle = $ehof_init_max_angle$
					min_distance >= @ehof_init_large_min_distance
					max_distance <= @ehof_init_large_max_distance
					hyperlane = $hyperlane$
					initializer = $initializer$
					effect = {
						save_event_target_as = giga_last_ehof_spawn
					}
				}
			}
		}
		medium = {
			no_scope = {
				spawn_system = {
					min_orientation_angle = $ehof_init_min_angle$
					max_orientation_angle = $ehof_init_max_angle$
					min_distance >= @ehof_init_medium_min_distance
					max_distance <= @ehof_init_medium_max_distance
					hyperlane = $hyperlane$
					initializer = $initializer$
					effect = {
						save_event_target_as = giga_last_ehof_spawn
					}
				}
			}
		}
		small = {
			no_scope = {
				spawn_system = {
					min_orientation_angle = $ehof_init_min_angle$
					max_orientation_angle = $ehof_init_max_angle$
					min_distance >= @ehof_init_small_min_distance
					max_distance <= @ehof_init_small_max_distance
					hyperlane = $hyperlane$
					initializer = $initializer$
					effect = {
						save_event_target_as = giga_last_ehof_spawn
					}
				}
			}
		}
		tiny = {
			no_scope = {
				spawn_system = {
					min_orientation_angle = $ehof_init_min_angle$
					max_orientation_angle = $ehof_init_max_angle$
					min_distance >= @ehof_init_tiny_min_distance
					max_distance <= @ehof_init_tiny_max_distance
					hyperlane = $hyperlane$
					initializer = $initializer$
					effect = {
						save_event_target_as = giga_last_ehof_spawn
					}
				}
			}
		}
		default = {
			no_scope = {
				spawn_system = {
					min_orientation_angle = $ehof_init_min_angle$
					max_orientation_angle = $ehof_init_max_angle$
					min_distance >= @ehof_init_default_min_distance
					max_distance <= @ehof_init_default_max_distance
					hyperlane = $hyperlane$
					initializer = $initializer$
					effect = {
						save_event_target_as = giga_last_ehof_spawn
					}
				}
			}
		}
	}
	log = "new system being generated, printing scope"
	print_scope_effect = yes
}

ehof_giga_new_create_new_continuous_system = {
	spawn_system = {
		min_distance >= @ehof_init_continuing_min
		max_distance <= @ehof_init_continuing_max
		hyperlane = no
		initializer = $initializer$
		effect = {
			save_event_target_as = giga_last_ehof_spawn
		}
	}
}

ehof_giga_new_create_new_continuous_system_short = {
	spawn_system = {
		min_distance >= @ehof_init_continuing_short_min
		max_distance <= @ehof_init_continuing_short_max
		hyperlane = no
		initializer = $initializer$
		effect = {
			save_event_target_as = giga_last_ehof_spawn
		}
	}
}

ehof_giga_new_create_sc_x = {
	log = "spawning sc_$star$"
	random_list = {
		20 = {
			log = "calling basic_init_01_sc_$star$"
			ehof_giga_new_create_new_continuous_system = {
				initializer = basic_init_01_sc_$star$
			}
		}
		20 = {
			log = "calling basic_init_02_sc_$star$"
			ehof_giga_new_create_new_continuous_system = {
				initializer = basic_init_02_sc_$star$
			}
		}
		10 = {
			log = "calling basic_init_03_sc_$star$"
			ehof_giga_new_create_new_continuous_system = {
				initializer = basic_init_03_sc_$star$
			}
		}
		10 = {
			log = "calling basic_init_04_sc_$star$"
			ehof_giga_new_create_new_continuous_system = {
				initializer = basic_init_04_sc_$star$
			}
		}
		6 = {
			log = "calling basic_init_05_sc_$star$"
			ehof_giga_new_create_new_continuous_system = {
				initializer = basic_init_05_sc_$star$
			}
		}
		4 = {
			log = "calling basic_init_06_sc_$star$"
			ehof_giga_new_create_new_continuous_system = {
				initializer = basic_init_06_sc_$star$
			}
		}
	}
	root = {
		remove_country_flag = ehof_create_sc_$star$
	}
}

ehof_giga_new_create_kugelblitz_system = {
	set_star_flag = ruined_kugelblitz_system
	giga_field_system_debris = yes
	random_system_planet = {
		limit = {
			is_planet_habitable = no
			is_star = no
		}
		set_planet_flag = has_giga
		giga_set_has_mega_flag = yes
		save_event_target_as = spawn_giga_ruined_kugelblitz
		giga_field_debris = yes
		trigger_megastructure_icon = yes
	}
	spawn_megastructure = {
		type = "kugelblitz_ruined"
		coords_from = event_target:spawn_giga_ruined_kugelblitz
	}
}

ehof_giga_new_create_macrotest_system = {
	set_star_flag = ruined_engineering_system
	giga_field_system_debris = yes
	random_system_planet = {
		limit = {
			OR = {
				is_planet_class = pc_machine
				is_planet_class = pc_broken
				is_planet_class = pc_shattered
			}
		}
		set_planet_flag = has_giga
		giga_set_has_mega_flag = yes
		save_event_target_as = spawn_giga_ruined_engineering
		giga_field_debris = yes
		trigger_megastructure_icon = yes
	}
	spawn_megastructure = {
		type = "macro_test_site_ruined"
		coords_from = event_target:spawn_giga_ruined_engineering
	}
}

ehof_giga_new_create_neutronium_gigaforge_system = {
	set_star_flag = ruined_neutroniumgigaforge_system
	giga_field_system_debris = yes
	random_system_planet = {
		limit = {
			OR = {
				is_planet_class = pc_neutron_star
				is_planet_class = pc_pulsar
			}
		}
		set_planet_flag = has_giga
		giga_set_has_mega_flag = yes
		save_event_target_as = spawn_giga_ruined_neutroniumgigaforge
		giga_field_debris = yes
		trigger_megastructure_icon = yes
	}
	spawn_megastructure = {
		type = "neutronium_gigaforge_ruined"
		coords_from = event_target:spawn_giga_ruined_neutroniumgigaforge
	}
}

ehof_giga_new_create_particle_accellerator_system = {
	set_star_flag = ruined_accelerator_system
	giga_field_system_debris = yes
	random_system_planet = {
		limit = {
			is_star = yes
		}
		set_planet_flag = has_giga
		giga_set_has_mega_flag = yes
		save_event_target_as = spawn_giga_ruined_accelerator
		giga_field_debris = yes
		trigger_megastructure_icon = yes
	}
	spawn_megastructure = {
		type = "particle_accelerator_ruined"
		coords_from = event_target:spawn_giga_ruined_accelerator
	}
}

ehof_giga_new_create_artificial_eco_system = {
	set_star_flag = ruined_ecosystem_system
	giga_field_system_debris = yes
	random_system_planet = {
		limit = {
			is_star = no
		}
		set_planet_flag = has_giga
		giga_set_has_mega_flag = yes
		save_event_target_as = spawn_giga_ruined_massive_zoo
		giga_field_debris = yes
		trigger_megastructure_icon = yes
	}
	spawn_megastructure = {
		type = "orbital_artificial_eco_ruined"
		coords_from = event_target:spawn_giga_ruined_massive_zoo
	}
}

ehof_giga_new_create_yggdrasil_system = {
	set_star_flag = ruined_orchid_system
	giga_field_system_debris = yes
	random_system_planet = {
		limit = {
			is_planet_class = pc_gas_giant
		}
		set_planet_flag = has_giga
		giga_set_has_mega_flag = yes
		save_event_target_as = spawn_giga_ruined_yggdrasil_orchid
		giga_field_debris = yes
		trigger_megastructure_icon = yes
	}
	spawn_megastructure = {
		type = "yggdrasil_orchid_ruined"
		coords_from = event_target:spawn_giga_ruined_yggdrasil_orchid
	}
}

ehof_giga_new_create_broken_ringworld_system = {
	set_star_flag = ruined_ring_system
	star = {
		set_planet_size = 25
		trigger_megastructure_icon = yes
		giga_set_has_mega_flag = yes
		giga_field_debris = yes
		if = {
			limit = {
				has_distar = yes
			}
			random = {
				chance = 50
				add_anomaly = {
					category = DISTAR_CLONE_CAT
				}
			}
		}
	}
	giga_remove_system_planets = yes
	giga_field_system_debris = yes
	spawn_megastructure = {
		type = "ring_world_ruined"
		orbit_angle = 0
		orbit_distance = 45
	}
	spawn_megastructure = {
		type = "ring_world_ruined"
		orbit_angle = 90
		orbit_distance = 45
	}
	spawn_megastructure = {
		type = "ring_world_ruined"
		orbit_angle = 180
		orbit_distance = 45
	}
	spawn_megastructure = {
		type = "ring_world_ruined"
		orbit_angle = 270
		orbit_distance = 45
	}
}

ehof_giga_new_create_broken_titanic_ringworld_system = {
	set_star_flag = ruined_ring_system
	set_star_flag = ruined_titanic_ring_system
	set_star_flag = ring_world_built_one
	star = {
		set_planet_size = 25
		trigger_megastructure_icon = yes
		giga_set_has_mega_flag = yes
		giga_field_debris = yes
		if = {
			limit = {
				has_distar = yes
			}
			random = {
				chance = 50
				add_anomaly = {
					category = DISTAR_CLONE_CAT
				}
			}
		}
	}
	giga_remove_system_planets = yes
	giga_field_system_debris = yes
	spawn_megastructure = {
		type = "ring_world_ruined"
		orbit_angle = 0
		orbit_distance = 45
	}
	spawn_megastructure = {
		type = "ring_world_ruined"
		orbit_angle = 90
		orbit_distance = 45
	}
	spawn_megastructure = {
		type = "ring_world_ruined"
		orbit_angle = 180
		orbit_distance = 45
	}
	spawn_megastructure = {
		type = "ring_world_ruined"
		orbit_angle = 270
		orbit_distance = 45
	}
	spawn_megastructure = {
		type = "ring_world_titanic_ruined"
		orbit_angle = 0
		orbit_distance = 90
	}
	spawn_megastructure = {
		type = "ring_world_titanic_ruined"
		orbit_angle = 90
		orbit_distance = 90
	}
	spawn_megastructure = {
		type = "ring_world_titanic_ruined"
		orbit_angle = 180
		orbit_distance = 90
	}
	spawn_megastructure = {
		type = "ring_world_titanic_ruined"
		orbit_angle = 270
		orbit_distance = 90
	}
	while = {
		count = 4
		giga_field_system_debris = yes
	}
}

ehof_giga_new_create_broken_behemoth_ringworld_system = {
	set_star_flag = ruined_ring_system
	set_star_flag = ruined_behemoth_ring_system
	set_star_flag = ring_world_built_one
	set_star_flag = ring_world_built_two
	star = {
		set_planet_size = 25
		trigger_megastructure_icon = yes
		giga_set_has_mega_flag = yes
		giga_field_debris = yes
		if = {
			limit = {
				has_distar = yes
			}
			random = {
				chance = 50
				add_anomaly = {
					category = DISTAR_CLONE_CAT
				}
			}
		}
	}
	giga_remove_system_planets = yes
	giga_field_system_debris = yes
	spawn_megastructure = {
		type = "ring_world_ruined"
		orbit_angle = 0
		orbit_distance = 45
	}
	spawn_megastructure = {
		type = "ring_world_ruined"
		orbit_angle = 90
		orbit_distance = 45
	}
	spawn_megastructure = {
		type = "ring_world_ruined"
		orbit_angle = 180
		orbit_distance = 45
	}
	spawn_megastructure = {
		type = "ring_world_ruined"
		orbit_angle = 270
		orbit_distance = 45
	}
	spawn_megastructure = {
		type = "ring_world_titanic_ruined"
		orbit_angle = 0
		orbit_distance = 90
	}
	spawn_megastructure = {
		type = "ring_world_titanic_ruined"
		orbit_angle = 90
		orbit_distance = 90
	}
	spawn_megastructure = {
		type = "ring_world_titanic_ruined"
		orbit_angle = 180
		orbit_distance = 90
	}
	spawn_megastructure = {
		type = "ring_world_titanic_ruined"
		orbit_angle = 270
		orbit_distance = 90
	}
	spawn_megastructure = {
		type = "ring_world_behemoth_ruined"
		orbit_angle = 0
		orbit_distance = 134
	}
	spawn_megastructure = {
		type = "ring_world_behemoth_ruined"
		orbit_angle = 90
		orbit_distance = 134
	}
	spawn_megastructure = {
		type = "ring_world_behemoth_ruined"
		orbit_angle = 180
		orbit_distance = 134
	}
	spawn_megastructure = {
		type = "ring_world_behemoth_ruined"
		orbit_angle = 270
		orbit_distance = 134
	}
	while = {
		count = 7
		giga_field_system_debris = yes
	}
}

ehof_giga_new_create_broken_gargantuan_ringworld_system = {
	set_star_flag = ruined_ring_system
	set_star_flag = ruined_gargantuan_ring_system
	set_star_flag = ring_world_built_one
	set_star_flag = ring_world_built_two
	set_star_flag = ring_world_built_three
	star = {
		set_planet_size = 25
		trigger_megastructure_icon = yes
		giga_set_has_mega_flag = yes
		giga_field_debris = yes
		if = {
			limit = {
				has_distar = yes
			}
			random = {
				chance = 50
				add_anomaly = {
					category = DISTAR_CLONE_CAT
				}
			}
		}
	}
	giga_remove_system_planets = yes
	giga_field_system_debris = yes
	spawn_megastructure = {
		type = "ring_world_ruined"
		orbit_angle = 0
		orbit_distance = 45
	}
	spawn_megastructure = {
		type = "ring_world_ruined"
		orbit_angle = 90
		orbit_distance = 45
	}
	spawn_megastructure = {
		type = "ring_world_ruined"
		orbit_angle = 180
		orbit_distance = 45
	}
	spawn_megastructure = {
		type = "ring_world_ruined"
		orbit_angle = 270
		orbit_distance = 45
	}
	spawn_megastructure = {
		type = "ring_world_titanic_ruined"
		orbit_angle = 0
		orbit_distance = 90
	}
	spawn_megastructure = {
		type = "ring_world_titanic_ruined"
		orbit_angle = 90
		orbit_distance = 90
	}
	spawn_megastructure = {
		type = "ring_world_titanic_ruined"
		orbit_angle = 180
		orbit_distance = 90
	}
	spawn_megastructure = {
		type = "ring_world_titanic_ruined"
		orbit_angle = 270
		orbit_distance = 90
	}
	spawn_megastructure = {
		type = "ring_world_behemoth_ruined"
		orbit_angle = 0
		orbit_distance = 134
	}
	spawn_megastructure = {
		type = "ring_world_behemoth_ruined"
		orbit_angle = 90
		orbit_distance = 134
	}
	spawn_megastructure = {
		type = "ring_world_behemoth_ruined"
		orbit_angle = 180
		orbit_distance = 134
	}
	spawn_megastructure = {
		type = "ring_world_behemoth_ruined"
		orbit_angle = 270
		orbit_distance = 134
	}
	spawn_megastructure = {
		type = "ring_world_gargantuan_ruined"
		orbit_angle = 0
		orbit_distance = 179
	}
	spawn_megastructure = {
		type = "ring_world_gargantuan_ruined"
		orbit_angle = 90
		orbit_distance = 179
	}
	spawn_megastructure = {
		type = "ring_world_gargantuan_ruined"
		orbit_angle = 180
		orbit_distance = 179
	}
	spawn_megastructure = {
		type = "ring_world_gargantuan_ruined"
		orbit_angle = 270
		orbit_distance = 179
	}
	while = {
		count = 10
		giga_field_system_debris = yes
	}
}

ehof_giga_new_create_broken_dyson_system = {
	set_star_flag = ruined_dyson_system
	if = {
		limit = {
			urmazin_system = no
		}
		every_system_planet = {
			limit = {
				is_planet_habitable = yes
			}
			change_pc = "rl_unhabitable_planets"
		}
	}
	giga_field_system_debris = yes
	star = {
		trigger_megastructure_icon = yes
	}
	if = {
		limit = {
			has_global_flag = giga_dyson_scaling
		}
		if = {
			limit = {
				star = {
					is_planet_class = pc_b_star
				}
			}
			spawn_megastructure = {
				type = "dyson_sphere_ruined_b_star"
				owner = from
			}
		}
		else_if = {
			limit = {
				star = {
					is_planet_class = pc_m_giant_star
				}
			}
			spawn_megastructure = {
				type = "dyson_sphere_ruined_m_giant_star"
				owner = from
			}
		}
		else_if = {
			limit = {
				star = {
					is_planet_class = pc_a_star
				}
			}
			spawn_megastructure = {
				type = "dyson_sphere_ruined_a_star"
				owner = from
			}
		}
		else_if = {
			limit = {
				star = {
					is_planet_class = pc_f_star
				}
			}
			spawn_megastructure = {
				type = "dyson_sphere_ruined_f_star"
				owner = from
			}
		}
		else_if = {
			limit = {
				star = {
					is_planet_class = pc_g_star
				}
			}
			spawn_megastructure = {
				type = "dyson_sphere_ruined_g_star"
				owner = from
			}
		}
		else_if = {
			limit = {
				star = {
					is_planet_class = pc_k_star
				}
			}
			spawn_megastructure = {
				type = "dyson_sphere_ruined_k_star"
				owner = from
			}
		}
		else_if = {
			limit = {
				star = {
					is_planet_class = pc_m_star
				}
			}
			spawn_megastructure = {
				type = "dyson_sphere_ruined_m_star"
				owner = from
			}
		}
		else = {
			spawn_megastructure = {
				type = "dyson_sphere_ruined"
				owner = from
			}
		}
	}
}

ehof_giga_new_create_broken_mega_shipyard_system = {
	set_star_flag = ruined_mega_shipyard_system
	giga_field_system_debris = yes
	star = {
		trigger_megastructure_icon = yes
	}
	spawn_megastructure = {
		type = "mega_shipyard_ruined"
	}
}

ehof_giga_new_create_broken_matter_decomp_system = {
	set_star_flag = ruined_matter_decompressor_system
	giga_field_system_debris = yes
	star = {
		trigger_megastructure_icon = yes
	}
	spawn_megastructure = {
		type = "matter_decompressor_ruined"
	}
}

ehof_giga_new_create_broken_science_nexus_system = {
	set_star_flag = ruined_nexus_system
	giga_field_system_debris = yes
	random_system_planet = {
		limit = {
			is_planet_habitable = no
			is_moon = no
			is_asteroid = no
			is_star = no
		}
		save_event_target_as = science_nexus_target
		giga_field_debris = yes
		trigger_megastructure_icon = yes
	}
	spawn_megastructure = {
		type = "think_tank_ruined"
		coords_from = event_target:science_nexus_target
	}
}

ehof_giga_new_create_broken_sentry_array_system = {
	set_star_flag = ruined_sentry_system
	giga_field_system_debris = yes
	random_system_planet = {
		save_event_target_as = sentry_array_target
		giga_field_debris = yes
		trigger_megastructure_icon = yes
	}
	spawn_megastructure = {
		type = "spy_orb_ruined"
		coords_from = event_target:sentry_array_target
	}
}

ehof_giga_new_create_broken_strategic_coord_system = {
	set_star_flag = ruined_strategic_coordination_center_system
	giga_field_system_debris = yes
	random_system_planet = {
		save_event_target_as = coordination_target
		giga_field_debris = yes
		trigger_megastructure_icon = yes
	}
	spawn_megastructure = {
		type = "strategic_coordination_center_ruined"
		coords_from = event_target:coordination_target
	}
}

ehof_giga_new_create_broken_mega_art_system = {
	set_star_flag = ruined_mega_art_installation_system
	giga_field_system_debris = yes
	random_system_planet = {
		limit = {
			is_planet_habitable = yes
		}
		save_event_target_as = mega_art_installation_target
		giga_field_debris = yes
		trigger_megastructure_icon = yes
	}
	spawn_megastructure = {
		type = "mega_art_installation_ruined"
		coords_from = event_target:mega_art_installation_target
	}
}

ehof_giga_new_create_broken_interstellar_assembly_system = {
	set_star_flag = ruined_interstellar_assembly_system
	giga_field_system_debris = yes
	star = {
		trigger_megastructure_icon = yes
	}
	spawn_megastructure = {
		type = "interstellar_assembly_ruined"
	}
}

ehof_giga_new_set_first_reality_code_arch = {
	change_pc = pc_toxic
	set_planet_flag = code_world1@from
	set_planet_flag = code_world_1
	set_planet_flag = ehof_giga_new_reality_code_planet
	prev = {
		set_star_flag = quest_system
	}
	from = {
		set_country_flag = code_world1@prev
		set_country_flag = ehof_started_reality_code
		if = {
			limit = {
				is_ai = yes
			}
			set_country_flag = ehof_ai_system_ready
		}
		remove_country_flag = ehof_spawn_reality_code
		remove_country_flag = ehof_code_toxic_world
	}
	if = {
		limit = {
			from = {
				is_ai = yes
			}
		}
		create_archaeological_site = code1_digsite
	}
	else = {
		
			enable_special_project = {
				name = INVESTIGATE_REALITY_CODE_1
				owner = from
				location = this
				
			}
		from = {
			country_event = {
				id = ehof_travel.1001
				days = 2
			}
		}
	}
}

ehof_giga_new_set_second_reality_code_arch = {
	change_pc = pc_broken
	set_planet_flag = code_world2@from
	set_planet_flag = code_world_2
	set_planet_flag = ehof_giga_new_reality_code_planet
	prev = {
		set_star_flag = quest_system
	}
	from = {
		set_country_flag = code_world2@prev
		if = {
			limit = {
				is_ai = yes
			}
			set_country_flag = ehof_ai_system_ready
		}
		remove_country_flag = ehof_spawn_reality_code
		remove_country_flag = ehof_code_broken_world
	}
	if = {
		limit = {
			from = {
				is_ai = yes
			}
		}
		create_archaeological_site = code2_digsite
	}
	else = {
		enable_special_project = {
			name = INVESTIGATE_REALITY_CODE_2
			owner = from
			location = this
			
		}
	from = {
		country_event = {
			id = ehof_travel.1001
			days = 2
		}
	}
	}
	# set_planet_flag = code_world2@from
}

ehof_giga_new_set_third_reality_code_arch = {
	change_pc = pc_frozen
	set_planet_flag = code_world3@from
	set_planet_flag = code_world_3
	set_planet_flag = ehof_giga_new_reality_code_planet
	prev = {
		set_star_flag = quest_system
	}
	from = {
		set_country_flag = code_world3@prev
		if = {
			limit = {
				is_ai = yes
			}
			set_country_flag = ehof_ai_system_ready
		}
		remove_country_flag = ehof_spawn_reality_code
		remove_country_flag = ehof_code_frozen_world
	}
	if = {
		limit = {
			from = {
				is_ai = yes
			}
		}
		create_archaeological_site = code3_digsite
	}
	else = {
		enable_special_project = {
			name = INVESTIGATE_REALITY_CODE_3
			owner = from
			location = this
			
		}
	from = {
		country_event = {
			id = ehof_travel.1001
			days = 2
		}
	}
	}
	# set_planet_flag = code_world3@from
}

ehof_giga_new_set_fourth_reality_code_arch = {
	change_pc = pc_molten
	set_planet_flag = code_world4@from
	set_planet_flag = code_world_4
	set_planet_flag = ehof_giga_new_reality_code_planet
	prev = {
		set_star_flag = quest_system
	}
	from = {
		set_country_flag = code_world4@prev
		if = {
			limit = {
				is_ai = yes
			}
			set_country_flag = ehof_ai_system_ready
		}
		remove_country_flag = ehof_spawn_reality_code
		remove_country_flag = ehof_code_molten_world
	}
	if = {
		limit = {
			from = {
				is_ai = yes
			}
		}
		create_archaeological_site = code4_digsite
	}
	else = {
		enable_special_project = {
			name = INVESTIGATE_REALITY_CODE_4
			owner = from
			location = this
			
		}
	from = {
		country_event = {
			id = ehof_travel.1001
			days = 2
		}
	}
	}
	# set_planet_flag = code_world4@from
}

ehof_giga_new_set_fifth_reality_code_arch = {
	change_pc = pc_gas_giant
	set_planet_flag = code_world5@from
	set_planet_flag = code_world_5
	set_planet_flag = ehof_giga_new_reality_code_planet
	prev = {
		set_star_flag = quest_system
	}
	from = {
		set_country_flag = code_world5@prev
		if = {
			limit = {
				is_ai = yes
			}
			set_country_flag = ehof_ai_system_ready
		}
		remove_country_flag = ehof_spawn_reality_code
		remove_country_flag = ehof_code_gas_giant_world
	}
	if = {
		limit = {
			from = {
				is_ai = yes
			}
		}
		create_archaeological_site = code5_digsite
	}
	else = {
		enable_special_project = {
			name = INVESTIGATE_REALITY_CODE_5
			owner = from
			location = this
			
		}
	from = {
		country_event = {
			id = ehof_travel.1001
			days = 2
		}
	}
	}
	# set_planet_flag = code_world5@from
}

ehof_giga_new_set_sixth_reality_code_arch = {
	prev = {
		set_star_flag = quest_system
		star = {
			set_planet_flag = code_world6@from
			set_planet_flag = code_world_6
			set_planet_flag = ehof_giga_new_reality_code_planet
			# prev = { set_star_flag = quest_system }
			from = {
				set_country_flag = code_world6@prev
				if = {
					limit = {
						is_ai = yes
					}
					set_country_flag = ehof_ai_system_ready
				}
				remove_country_flag = ehof_spawn_reality_code
				remove_country_flag = ehof_code_star_world
			}
			if = {
				limit = {
					from = {
						is_ai = yes
					}
				}
				create_archaeological_site = code6_digsite
			}
			else = {
				enable_special_project = {
					name = INVESTIGATE_REALITY_CODE_6
					owner = from
					location = this
					
				}
			from = {
				country_event = {
					id = ehof_travel.1001
					days = 2
				}
			}
			}
		}
	}
}

ehof_giga_new_create_red_toxic = {
	set_global_flag = ehof_red_toxic_exists
	random_system_planet = {
		limit = {
			is_star = no
			is_asteroid = no
			giga_habitable_structure = no
			is_planet_habitable = no
			has_anomaly = no
			NOT = {
				exists = archaeological_site
			}
		}
		clear_deposits = yes #In case it randomly rolled a deposit
		change_pc = pc_red_toxic
		add_modifier = { modifier = red_toxic days = -1}
		add_anomaly = {
			category = intoxicated_world_category
		}
	}
}

ehof_giga_new_cleanup_country_flags = {
	remove_country_flag = has_chosen_custom_ehof_spawn
	remove_country_flag = has_ehof_custom_random_megastructure_spawn
	remove_country_flag = has_random_custom_ehof_spawn
	remove_country_flag = has_ehof_custom_random_spawned_leviathan
	remove_country_flag = has_random_custom_ehof_hostile_spawn
}

create_ehof_dest_poi = {
	create_point_of_interest = {
		id = ehof_sys_$counter$
		name = "ehof_sys"
		desc = "ehof_sys_desc"
		event_chain = ehof_system_list
		location = prev
	}
	change_variable = {
		which = ehof_system_number_counter
		value = 1
	}
	add_event_chain_counter = {
		event_chain = ehof_system_list
		counter = total_systems
		amount = 1
	}
}

ehof_giga_new_energy_option_cost = {
	add_resource = {
		energy = -1
		# $resource_2$ = @ehof_target_neg_p$value_2$
		multiplier = ehof_basic_travel_cost_display
	}
}

ehof_giga_new_set_ehof_basic_travel_cost = {
	if = {
		limit = {
			check_variable = {
				which = ehof_phase
				value = 1
			}
		}
		set_variable = {
			which = ehof_basic_travel_cost_display
			value = @ehof_target_p1
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = ehof_phase
				value = 2
			}
		}
		set_variable = {
			which = ehof_basic_travel_cost_display
			value = @ehof_target_p2
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = ehof_phase
				value = 3
			}
		}
		set_variable = {
			which = ehof_basic_travel_cost_display
			value = @ehof_target_p3
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = ehof_phase
				value = 4
			}
		}
		set_variable = {
			which = ehof_basic_travel_cost_display
			value = @ehof_target_p4
		}
	}
}

giga_clear_ehof_country_flags = {
	remove_country_flag = ehof_destination_picked
	remove_country_flag = ehof_travel_diplomacy
	remove_country_flag = ehof_can_activate
	remove_country_flag = ehof_can_deactivate
	remove_country_flag = ehof_is_upgrading
	remove_country_flag = ehof_on_cooldown
}

giga_remove_ehof_mega_flags = {
	remove_megastructure_flag = ehof_wormhole_node
	remove_megastructure_flag = ehof_phase_00
	remove_megastructure_flag = ehof_phase_01
	remove_megastructure_flag = ehof_phase_02
	remove_megastructure_flag = ehof_phase_03
	remove_megastructure_flag = ehof_phase_04
	remove_megastructure_flag = ehof_phase_01_decommissioned
	remove_megastructure_flag = ehof_phase_02_decommissioned
	remove_megastructure_flag = ehof_phase_03_decommissioned
	remove_megastructure_flag = ehof_phase_04_decommissioned
	#new, easier to track states this way
	remove_megastructure_flag = giga_ehof_activating
	remove_megastructure_flag = giga_ehof_active
}



giga_ehof_amb_reset = { #Mainly just as a fallback and for upgrading the ehof
	if = {
		limit = { 
			any_system_ambient_object = { 
				ehof_any_amb_object = yes
			} 
		}
		every_system_ambient_object = {
			limit = {
				ehof_any_amb_object = yes
				}
			destroy_ambient_object = this
		}
	}
	random_system_megastructure = {
		limit = { giga_is_any_ehof_non_flag = yes }
		giga_remove_ehof_mega_flags = yes
		switch = {
			trigger = is_megastructure_type 
			ehof_megastructure_phase1 = {
				set_megastructure_flag = ehof_phase_01
				solar_system = {
					create_ambient_object = {
						type = "ehof_megastructure_phase1_idle"
						location = star
						use_3d_location = yes
						entity_face_object = star
						entity_offset = { min = 0 max = 0 }
						entity_offset_angle = { min = 0 max = 0 }
						entity_offset_height = { min = 0 max = 0 }
						scale = 1
					}
				}	
			}
	
			ehof_megastructure_phase2 = {
				set_megastructure_flag = ehof_phase_02
				solar_system = {
					create_ambient_object = {
						type = "ehof_megastructure_phase2_idle"
						location = star
						use_3d_location = yes
						entity_face_object = star
						entity_offset = { min = 0 max = 0 }
						entity_offset_angle = { min = 0 max = 0 }
						entity_offset_height = { min = 0 max = 0 }
						scale = 1
					}
				}	
			}
	
			ehof_megastructure_phase3 = {
				set_megastructure_flag = ehof_phase_03
				solar_system = {
					create_ambient_object = {
						type = "ehof_megastructure_phase3_idle"
						location = star
						use_3d_location = yes
						entity_face_object = star
						entity_offset = { min = 0 max = 0 }
						entity_offset_angle = { min = 0 max = 0 }
						entity_offset_height = { min = 0 max = 0 }
						scale = 1
					}
				}	
			}
	
			ehof_megastructure_phase4 = {
				set_megastructure_flag = ehof_phase_04
				solar_system = {
					create_ambient_object = {
						type = "ehof_megastructure_phase4_idle"
						location = star
						use_3d_location = yes
						entity_face_object = star
						entity_offset = { min = 0 max = 0 }
						entity_offset_angle = { min = 0 max = 0 }
						entity_offset_height = { min = 0 max = 0 }
						scale = 1
					}
				}	
			}
		}
	}
}

giga_ehof_set_idle = {
	if = {
		limit = { 
			any_system_ambient_object = { 
				OR = {
					ehof_activating_amb_object = yes
					ehof_active_amb_object = yes
					ehof_decommissioned_amb_object = yes
				}
			} 
		}
		every_system_ambient_object = {
			limit = {
					OR = {
						ehof_activating_amb_object = yes
						ehof_active_amb_object = yes
						ehof_decommissioned_amb_object = yes
					}
				}
			destroy_ambient_object = this
		}
	}
	random_system_megastructure = {	
		limit = { giga_is_any_ehof_non_flag = yes }
		giga_remove_ehof_mega_flags = yes
		switch = {
			trigger = is_megastructure_type 
			ehof_megastructure_phase1 = {
				set_megastructure_flag = ehof_phase_01
				solar_system = {
					create_ambient_object = {
						type = "ehof_megastructure_phase1_idle"
						location = star
						use_3d_location = yes
						entity_face_object = star
						entity_offset = { min = 0 max = 0 }
						entity_offset_angle = { min = 0 max = 0 }
						entity_offset_height = { min = 0 max = 0 }
						scale = 1
					}
				}	
			}
	
			ehof_megastructure_phase2 = {
				set_megastructure_flag = ehof_phase_02
				solar_system = {
					create_ambient_object = {
						type = "ehof_megastructure_phase2_idle"
						location = star
						use_3d_location = yes
						entity_face_object = star
						entity_offset = { min = 0 max = 0 }
						entity_offset_angle = { min = 0 max = 0 }
						entity_offset_height = { min = 0 max = 0 }
						scale = 1
					}
				}	
			}
	
			ehof_megastructure_phase3 = {
				set_megastructure_flag = ehof_phase_03
				solar_system = {
					create_ambient_object = {
						type = "ehof_megastructure_phase3_idle"
						location = star
						use_3d_location = yes
						entity_face_object = star
						entity_offset = { min = 0 max = 0 }
						entity_offset_angle = { min = 0 max = 0 }
						entity_offset_height = { min = 0 max = 0 }
						scale = 1
					}
				}	
			}
	
			ehof_megastructure_phase4 = {
				set_megastructure_flag = ehof_phase_04
				solar_system = {
					create_ambient_object = {
						type = "ehof_megastructure_phase4_idle"
						location = star
						use_3d_location = yes
						entity_face_object = star
						entity_offset = { min = 0 max = 0 }
						entity_offset_angle = { min = 0 max = 0 }
						entity_offset_height = { min = 0 max = 0 }
						scale = 1
					}
				}	
			}
		}
	}
}

giga_ehof_set_activating = {
	if = {
		limit = { 
			any_system_ambient_object = { 
				OR = {
					ehof_idle_amb_object = yes
					ehof_active_amb_object = yes
					ehof_decommissioned_amb_object = yes
				}
			} 
		}
		every_system_ambient_object = {
			limit = {
					OR = {
						ehof_idle_amb_object = yes
						ehof_active_amb_object = yes
						ehof_decommissioned_amb_object = yes
					}
				}
			destroy_ambient_object = this
		}
	}
	random_system_megastructure = {
		limit = { giga_is_any_ehof_non_flag = yes }
		giga_remove_ehof_mega_flags = yes
		set_megastructure_flag = giga_ehof_activating
		switch = {
			trigger = is_megastructure_type 
			ehof_megastructure_phase1 = {
				set_megastructure_flag = ehof_phase_01
				set_megastructure_flag = giga_ehof_activating
				solar_system = {
					create_ambient_object = {
						type = "ehof_megastructure_phase1_activating"
						location = star
						use_3d_location = yes
						entity_face_object = star
						entity_offset = { min = 0 max = 0 }
						entity_offset_angle = { min = 0 max = 0 }
						entity_offset_height = { min = 0 max = 0 }
						scale = 1
					}
				}	
			}
	
			ehof_megastructure_phase2 = {
				set_megastructure_flag = ehof_phase_02
				set_megastructure_flag = giga_ehof_activating
				solar_system = {
					create_ambient_object = {
						type = "ehof_megastructure_phase2_activating"
						location = star
						use_3d_location = yes
						entity_face_object = star
						entity_offset = { min = 0 max = 0 }
						entity_offset_angle = { min = 0 max = 0 }
						entity_offset_height = { min = 0 max = 0 }
						scale = 1
					}
				}	
			}
	
			ehof_megastructure_phase3 = {
				set_megastructure_flag = ehof_phase_03
				set_megastructure_flag = giga_ehof_activating
				solar_system = {
					create_ambient_object = {
						type = "ehof_megastructure_phase3_activating"
						location = star
						use_3d_location = yes
						entity_face_object = star
						entity_offset = { min = 0 max = 0 }
						entity_offset_angle = { min = 0 max = 0 }
						entity_offset_height = { min = 0 max = 0 }
						scale = 1
					}
				}	
			}
	
			ehof_megastructure_phase4 = {
				set_megastructure_flag = ehof_phase_04
				set_megastructure_flag = giga_ehof_activating
				solar_system = {
					create_ambient_object = {
						type = "ehof_megastructure_phase4_activating"
						location = star
						use_3d_location = yes
						entity_face_object = star
						entity_offset = { min = 0 max = 0 }
						entity_offset_angle = { min = 0 max = 0 }
						entity_offset_height = { min = 0 max = 0 }
						scale = 1
					}
				}	
			}
		}
	}
}

giga_ehof_set_active = {
	if = {
		limit = { 
			any_system_ambient_object = { 
				OR = {
					ehof_activating_amb_object = yes
					ehof_idle_amb_object = yes
					ehof_decommissioned_amb_object = yes
				}
			} 
		}
		every_system_ambient_object = {
			limit = {
					OR = {
						ehof_activating_amb_object = yes
						ehof_idle_amb_object = yes
						ehof_decommissioned_amb_object = yes
					}
				}
			destroy_ambient_object = this
		}
	}
	random_system_megastructure = {
		limit = { giga_is_any_ehof_non_flag = yes }
		giga_remove_ehof_mega_flags = yes
		set_megastructure_flag = giga_ehof_active
		switch = {
			trigger = is_megastructure_type 
			ehof_megastructure_phase1 = {
				set_megastructure_flag = ehof_phase_01
				solar_system = {
					create_ambient_object = {
						type = "ehof_megastructure_phase1_active"
						location = star
						use_3d_location = yes
						entity_face_object = star
						entity_offset = { min = 0 max = 0 }
						entity_offset_angle = { min = 0 max = 0 }
						entity_offset_height = { min = 0 max = 0 }
						scale = 1
					}
				}	
			}
	
			ehof_megastructure_phase2 = {
				set_megastructure_flag = ehof_phase_02
				solar_system = {
					create_ambient_object = {
						type = "ehof_megastructure_phase2_active"
						location = star
						use_3d_location = yes
						entity_face_object = star
						entity_offset = { min = 0 max = 0 }
						entity_offset_angle = { min = 0 max = 0 }
						entity_offset_height = { min = 0 max = 0 }
						scale = 1
					}
				}	
			}
			ehof_megastructure_phase3 = {
				set_megastructure_flag = ehof_phase_03
				solar_system = {
					create_ambient_object = {
						type = "ehof_megastructure_phase3_active"
						location = star
						use_3d_location = yes
						entity_face_object = star
						entity_offset = { min = 0 max = 0 }
						entity_offset_angle = { min = 0 max = 0 }
						entity_offset_height = { min = 0 max = 0 }
						scale = 1
					}
				}	
			}
			ehof_megastructure_phase4 = {
				set_megastructure_flag = ehof_phase_04
				solar_system = {
					create_ambient_object = {
						type = "ehof_megastructure_phase4_active"
						location = star
						use_3d_location = yes
						entity_face_object = star
						entity_offset = { min = 0 max = 0 }
						entity_offset_angle = { min = 0 max = 0 }
						entity_offset_height = { min = 0 max = 0 }
						scale = 1
					}
				}	
			}
		}
		solar_system = {
			spawn_megastructure = {
				type = "ehof_megastructure_wormhole_destination"
				owner = from
				orbit_angle = 240
				orbit_distance = 37
				init_effect = {
					set_megastructure_flag = ehof_wormhole_opened_by_@root
					set_megastructure_flag = ehof_wormhole_node
				}
			}
		}
	}
}

giga_ehof_set_decommissioned = {
	if = {
		limit = { 
			any_system_ambient_object = { 
				OR = {
					ehof_activating_amb_object = yes
					ehof_active_amb_object = yes
					ehof_idle_amb_object = yes
				}
			} 
		}
		every_system_ambient_object = {
			limit = {
					OR = {
						ehof_activating_amb_object = yes
						ehof_active_amb_object = yes
						ehof_idle_amb_object = yes
					}
				}
			destroy_ambient_object = this
		}
	}
	random_system_megastructure = {
		limit = { giga_is_any_ehof_non_flag = yes }
		giga_remove_ehof_mega_flags = yes
		switch = {
			trigger = is_megastructure_type 
			ehof_megastructure_phase0 = {
				remove_megastructure = this
			}
			ehof_megastructure_phase1 = {
				set_megastructure_flag = ehof_phase_01_decommissioned
				solar_system = {
					create_ambient_object = {
						type = "ehof_megastructure_phase1_decommissioned"
						location = star
						use_3d_location = yes
						entity_face_object = star
						entity_offset = { min = 0 max = 0 }
						entity_offset_angle = { min = 0 max = 0 }
						entity_offset_height = { min = 0 max = 0 }
						scale = 1
					}
				}	
			}
	
			ehof_megastructure_phase2 = {
				set_megastructure_flag = ehof_phase_02_decommissioned
				solar_system = {
					create_ambient_object = {
						type = "ehof_megastructure_phase2_decommissioned"
						location = star
						use_3d_location = yes
						entity_face_object = star
						entity_offset = { min = 0 max = 0 }
						entity_offset_angle = { min = 0 max = 0 }
						entity_offset_height = { min = 0 max = 0 }
						scale = 1
					}
				}	
			}
	
			ehof_megastructure_phase3 = {
				set_megastructure_flag = ehof_phase_03_decommissioned
				solar_system = {
					create_ambient_object = {
						type = "ehof_megastructure_phase3_decommissioned"
						location = star
						use_3d_location = yes
						entity_face_object = star
						entity_offset = { min = 0 max = 0 }
						entity_offset_angle = { min = 0 max = 0 }
						entity_offset_height = { min = 0 max = 0 }
						scale = 1
					}
				}	
			}
	
			ehof_megastructure_phase4 = {
				set_megastructure_flag = ehof_phase_04_decommissioned
				solar_system = {
					create_ambient_object = {
						type = "ehof_megastructure_phase4_decommissioned"
						location = star
						use_3d_location = yes
						entity_face_object = star
						entity_offset = { min = 0 max = 0 }
						entity_offset_angle = { min = 0 max = 0 }
						entity_offset_height = { min = 0 max = 0 }
						scale = 1
					}
				}	
			}
		}
	}
}

giga_activate_an_ehof = {
	if = {
		limit = { any_owned_megastructure = { has_megastructure_flag = ehof_phase_04_decommissioned } }
		capital_scope.solar_system = {
			closest_system = {
				limit = { any_system_megastructure = { has_megastructure_flag = ehof_phase_04_decommissioned } }
				random_system_megastructure = {
					limit = { has_megastructure_flag = ehof_phase_04_decommissioned }
					remove_megastructure_flag = ehof_phase_04_decommissioned
				}
				giga_ehof_set_idle = yes
			}
		}
	}
	else_if = {
		limit = { any_owned_megastructure = { has_megastructure_flag = ehof_phase_03_decommissioned } }
		capital_scope.solar_system = {
			closest_system = {
				limit = { any_system_megastructure = { has_megastructure_flag = ehof_phase_03_decommissioned } }
				random_system_megastructure = {
					limit = { has_megastructure_flag = ehof_phase_03_decommissioned }
					remove_megastructure_flag = ehof_phase_03_decommissioned
				}
				giga_ehof_set_idle = yes
			}
		}
	}
	else_if = {
		limit = { any_owned_megastructure = { has_megastructure_flag = ehof_phase_02_decommissioned } }
		capital_scope.solar_system = {
			closest_system = {
				limit = { any_system_megastructure = { has_megastructure_flag = ehof_phase_02_decommissioned } }
				random_system_megastructure = {
					limit = { has_megastructure_flag = ehof_phase_02_decommissioned }
					remove_megastructure_flag = ehof_phase_02_decommissioned
				}
				giga_ehof_set_idle = yes
			}
		}
	}
	else_if = {
		limit = { any_owned_megastructure = { has_megastructure_flag = ehof_phase_01_decommissioned } }
		capital_scope.solar_system = {
			closest_system = {
				limit = { any_system_megastructure = { has_megastructure_flag = ehof_phase_01_decommissioned } }
				random_system_megastructure = {
					limit = { has_megastructure_flag = ehof_phase_01_decommissioned }
					remove_megastructure_flag = ehof_phase_01_decommissioned
				}
				giga_ehof_set_idle = yes
			}
		}
	}
}

giga_decomission_all_ehofs = {
	giga_clear_ehof_country_flags = yes

	every_owned_megastructure = {
		limit = {
			OR = {
				has_megastructure_flag = ehof_phase_00
				has_megastructure_flag = ehof_phase_01
				has_megastructure_flag = ehof_phase_02
				has_megastructure_flag = ehof_phase_03
				has_megastructure_flag = ehof_phase_04
			}
		}
		solar_system = {
			giga_ehof_set_decommissioned = yes
		}
		switch = {
			trigger = has_megastructure_flag
			ehof_phase_00 = {
				remove_megastructure = this
			}
		}
	}
}