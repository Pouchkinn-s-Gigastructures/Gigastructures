namespace = giga_o_star

country_event = {
	id = giga_o_star.1000
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		event_target:global_event_country = {
			set_variable = {
				which = giga_o_star_total_galaxy_star_count
				value = 0
			}
		}
		every_system = {
			event_target:global_event_country = {
				change_variable = {
					which = giga_o_star_total_galaxy_star_count
					value = 1
				}
			}
		}
		event_target:global_event_country = {
			set_variable = {
				which = giga_o_star_total_count
				value = giga_o_star_total_galaxy_star_count
			}
			divide_variable = {
				which = giga_o_star_total_count
				value = 70
			}
			while = {
				limit = {
					event_target:global_event_country = {
						check_variable = {
							which = giga_o_star_total_count
							value > 0
						}			
					}
					any_system = {
						giga_is_bitrinary = no
						has_no_non_gate_megastructure = yes
						NOR = {
							is_star_class = sc_black_hole
							is_star_class = sc_neutron_star
							is_star_class = sc_pulsar
							any_system_planet = {
								has_planet_flag = paluushia
								has_planet_flag = gigaflusion
								is_colony = yes
								is_artificial = yes
								has_planet_flag = has_megastructure
								has_planet_flag = megastructure
								is_planet_class = pc_ice_asteroid
							}
							any_ship_in_system = { exists = THIS }
						}
					}
				}
				event_target:global_event_country = {
					subtract_variable = {
						which = giga_o_star_total_count
						value = 1
					}				
				}
				random_system = {
					limit = {
						giga_is_bitrinary = no
						has_no_non_gate_megastructure = yes
						NOR = {
							is_star_class = sc_black_hole
							is_star_class = sc_neutron_star
							is_star_class = sc_pulsar
							any_system_planet = {
								has_planet_flag = paluushia
								has_planet_flag = gigaflusion
								is_colony = yes
								is_artificial = yes
								has_planet_flag = has_megastructure
								has_planet_flag = megastructure
								is_planet_class = pc_ice_asteroid
							}
							any_ship_in_system = { exists = THIS }
						}
					}
					set_star_class = sc_giga_o_star
					set_star_flag = giga_o_star_system
					star = {
						clear_deposits = yes
						add_deposit = d_energy_10
						add_deposit = d_energy_10
						change_pc = pc_giga_o_star
						set_planet_size = 25
						add_modifier = {
							modifier = giga_o_star_modifier
							days = -1
						}
						create_ambient_object = {
							type = "giga_o_star_nebula_1"
							entity_offset_height = 0
							location = this
						}
						last_created_ambient_object = {
							set_location = {
								target = prev
								distance = 0
								angle = random
							}
							set_ambient_object_flag = o_star_solar_wind
						}
					}
					every_system_planet = {
						limit = { 
							OR = {
								is_colonizable = yes
								is_planet_class = pc_toxic
								is_planet_class = pc_frozen
								is_planet_class = pc_barren_cold
							}
						}
						random_list = {
							10 = { change_pc = pc_molten }
							10 = { change_pc = pc_barren }
							2 = { change_pc = pc_broken }
							1 = { change_pc = pc_shattered }
						}
					}
					every_system_planet = {
						limit = {
							planet_size > 5
						}
						change_planet_size = -3
					}
				}
			}
		}
	}
}

# Found system
ship_event = {
	id = giga_o_star.2000
	title = "giga_o_star.2000.name"
	desc = "giga_o_star.2000.desc"
	picture = GFX_evt_giga_o_star
	show_sound = event_radio_chatter
	location = from
	is_triggered_only = yes

	trigger = {
		owner = { NOT = { has_country_flag = found_giga_o_star_class } }
		from = {
			has_star_flag = giga_o_star_system
		}
	}

	immediate = { owner = { set_country_flag = found_giga_o_star_class } }
	option = { name = "giga_o_star.2000.a" }
}