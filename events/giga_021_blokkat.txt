namespace = giga_blokkat

#SPAWNING SCRIPT
event = {
	id = giga_blokkat.1500
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		NOR = { 
			has_global_flag = blokkats_failed_to_spawn
			has_global_flag = blokkats_managed_to_spawn 
			has_global_flag = giga_blokkats_disabled
		}
	}

	immediate = {
		#Check if we can begin the spawning protocols
		event_target:global_event_country = {
			if = {
				limit = { 
					NOR = { 
						has_global_flag = blokkat_trying_to_spawn
						has_global_flag = giga_blokkats_disabled
					} 
				}
				if = {
					limit = { #Default
						check_variable = { which = blokkat_spawn_date value = 2500 }
						OR = {
							end_game_years_passed >= 100
							AND = { end_game_years_passed >= 1 giga_blokkat_defeated_crisis = yes }
						}
					}
					begin_blokkat_spawn_cycle = yes
				}
				else_if = {
					limit = { #2450
						check_variable = { which = blokkat_spawn_date value = 2450 }
						end_game_years_passed >= 50
					}
					begin_blokkat_spawn_cycle = yes
				}
				else_if = {
					limit = { #2400
						check_variable = { which = blokkat_spawn_date value = 2400 }
						end_game_years_passed >= 1
					}
					begin_blokkat_spawn_cycle = yes
				}
				else_if = {
					limit = { #2350
						check_variable = { which = blokkat_spawn_date value = 2350 }
						mid_game_years_passed >= 50
					}
					begin_blokkat_spawn_cycle = yes
				}
				else_if = {
					limit = { #2300
						check_variable = { which = blokkat_spawn_date value = 2300 }
						mid_game_years_passed >= 1
					}
					begin_blokkat_spawn_cycle = yes
				}
				else_if = {
					limit = { #2250
						check_variable = { which = blokkat_spawn_date value = 2250 }
						years_passed >= 50
					}
					begin_blokkat_spawn_cycle = yes
				}
				else_if = {
					limit = { #2250
						check_variable = { which = blokkat_spawn_date value = 2200 }
						years_passed >= 0
					}
					begin_blokkat_spawn_cycle = yes
				}
				else_if = { #Random
					limit = {
						check_variable = { which = blokkat_spawn_date value = 2550 }
						years_passed >= 50
						end_game_years_passed < 100
					}
					random_list = {
						1 = {
							set_global_flag = blokkats_managed_to_spawn
							country_event = { id = giga_blokkat.1000 days = 10 random = 10 }
						}
						99 = {}
					}
				}
				else_if = { #Random but time's up
					limit = {
						check_variable = { which = blokkat_spawn_date value = 2550 }
						end_game_years_passed >= 100
					}
					set_global_flag = blokkats_managed_to_spawn
					country_event = { id = giga_blokkat.1000 days = 10 random = 10 }
				}
			}
			if = { #Run it 10 times, 10% chance each year
				limit = {
					has_global_flag = blokkat_trying_to_spawn
					check_variable = {
						which = blokkat_trying_to_spawn_count
						value < 11
					}
				}
				random_list = {
					7 = {
						set_global_flag = blokkats_managed_to_spawn
						country_event = { id = giga_blokkat.1000 days = 10 random = 10 }
					}
					93 = {}
				}
				change_variable = {
					which = blokkat_trying_to_spawn_count
					value = 1
				}
			}
			if = { #They failed to spawn, sad
				limit = {
					check_variable = {
						which = blokkat_trying_to_spawn_count
						value >= 11
					}
				}
				set_global_flag = blokkats_failed_to_spawn
			}
		}
	}
}

#Something big: Global event, starts a countdown.

country_event = {
	id = giga_blokkat.1000
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = { NOT = { has_global_flag = blokkats_managed_to_spawn } }
			set_global_flag = blokkats_managed_to_spawn
		}
		event_target:global_event_country = {
			set_variable = {
				which = blokkat_distance_from_galaxy
				value = 1000000 #lightyears, blokkats will spawn 5 to 10 years after initial event.
			}
			country_event = { id = giga_blokkat.1003 days = 80 }
		}
		every_country = {
			country_event = { id = giga_blokkat.1001 } #Initial popup
			country_event = { id = giga_blokkat.1002 days = 90 }
		}
	}
}

#Lower the distance variable
country_event = {
	id = giga_blokkat.1003
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				check_variable = {
					which = blokkat_distance_from_galaxy
					value > 0
				}
			}
			subtract_variable = {
				which = blokkat_distance_from_galaxy
				value = 4164 #CHANGE TO 4164
			}
			country_event = { id = giga_blokkat.1003 days = 14 }
			if = { #Hole in the void event
				limit = {
					check_variable = {
						which = blokkat_distance_from_galaxy
						value < 500000
					}
				}
				every_country = { #wait, no
					limit = {
						has_country_flag = crisis.234
						NOT = { has_country_flag = blokkat_hole_in_void }
					}
					set_country_flag = blokkat_hole_in_void
					country_event = { id = giga_blokkat.1004 }
				}
			}
			if = { #Hole in the void event
				limit = {
					check_variable = {
						which = blokkat_distance_from_galaxy
						value < 300000
					}
					NOT = { has_global_flag = calculated_blokkat_arrival_system }
				}
				set_global_flag = calculated_blokkat_arrival_system
				event_target:global_event_country = {
					country_event = { id = giga_blokkat.1010 }
				}
				every_country = { #wait, no
					limit = {
						is_ai = no
					}
					country_event = { id = giga_blokkat.1005 days = 2 }
				}
			}
			if = { #Hole in the void event
				limit = {
					check_variable = {
						which = blokkat_distance_from_galaxy
						value < 0
					}
					NOT = { has_global_flag = blokkats_arrived }
				}
				set_global_flag = blokkats_arrived
				event_target:global_event_country = {
					country_event = { id = giga_blokkat.1011 }
				}
				every_country = { #wait, no
					limit = {
						OR = { ehof_default_country = yes is_ai = no }
					}
					country_event = { id = giga_blokkat.1006 days = 1 }
				}
			}
		}
	}
}

#Popup about this big thing
country_event = {
	id = giga_blokkat.1001
	title = "giga_blokkat.1001.name"
	desc = "giga_blokkat.1001.desc"
	picture = GFX_evt_binary_stars
	show_sound = event_sensor_ping
	location = from
	is_triggered_only = yes

	option = { #k.
		name = "giga_blokkat.1001.a"
	}
}

#its coming at us!
country_event = {
	id = giga_blokkat.1002
	title = "giga_blokkat.1002.name"
	desc = "giga_blokkat.1002.desc"
	picture = GFX_evt_ship_travel
	show_sound = event_yellow_alert
	location = from
	is_triggered_only = yes

	option = { #Uh oh
		name = "giga_blokkat.1002.a"
		begin_event_chain = {
			event_chain = "blokkat_pre_arrival_chain"
			target = ROOT
		}
	}
}

#if "hole in void" event happened
country_event = {
	id = giga_blokkat.1004
	title = "giga_blokkat.1004.name"
	desc = "giga_blokkat.1004.desc"
	picture = GFX_evt_black_hole
	show_sound = event_red_alert
	location = from
	is_triggered_only = yes

	option = { #Uh oh
		name = "giga_blokkat.1004.a"
	}
}

#further analysis + distance
country_event = {
	id = giga_blokkat.1005
	title = "giga_blokkat.1005.name"
	desc = "giga_blokkat.1005.desc"
	picture = GFX_evt_ship_travel
	show_sound = event_sensor_ping
	location = event_target:blokkat_spawn_system
	is_triggered_only = yes

	option = { #Uh oh
		name = "giga_blokkat.1005.a"
		create_point_of_interest = {
			id = blokkat_pre_arrival_chain.1
			name = "blokkat_pre_arrival_chain_1"
			desc = "blokkat_pre_arrival_chain_1_desc"
			event_chain = blokkat_pre_arrival_chain
			location = event_target:blokkat_spawn_system
		}
	}
}

#Now, the Blokkats will arrive. We must locate a system that's as far away as possible from a player capital.
country_event = {
	id = giga_blokkat.1010
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_country = {
			limit = { is_ai = no }
			capital_scope = {
				solar_system = {
					save_global_event_target_as = blokkat_capital_star #The Blokkats will spawn far away from this
					set_star_flag = blokkat_capital_star
				}
			}
		}
		#This will create "rings" of distance around the player capital, the blokkats will spawn in the furthest one that is a rim
		blokkat_determine_distances = yes
		#Now we find a rim system that is in the furthest "ring"
		if = {
			limit = { any_rim_system = { check_variable = { which = blokkat_capital_distance value = 700 } } }
			random_rim_system = { limit = { check_variable = { which = blokkat_capital_distance value = 700 } } save_global_event_target_as = blokkat_spawn_system }
		}
		else_if = {
			limit = { any_rim_system = { check_variable = { which = blokkat_capital_distance value = 650 } } }
			random_rim_system = { limit = { check_variable = { which = blokkat_capital_distance value = 650 } } save_global_event_target_as = blokkat_spawn_system }
		}
		else_if = {
			limit = { any_rim_system = { check_variable = { which = blokkat_capital_distance value = 600 } } }
			random_rim_system = { limit = { check_variable = { which = blokkat_capital_distance value = 600 } } save_global_event_target_as = blokkat_spawn_system }
		}
		else_if = {
			limit = { any_rim_system = { check_variable = { which = blokkat_capital_distance value = 550 } } }
			random_rim_system = { limit = { check_variable = { which = blokkat_capital_distance value = 550 } } save_global_event_target_as = blokkat_spawn_system }
		}
		else_if = {
			limit = { any_rim_system = { check_variable = { which = blokkat_capital_distance value = 500 } } }
			random_rim_system = { limit = { check_variable = { which = blokkat_capital_distance value = 500 } } save_global_event_target_as = blokkat_spawn_system }
		}
		else_if = {
			limit = { any_rim_system = { check_variable = { which = blokkat_capital_distance value = 450 } } }
			random_rim_system = { limit = { check_variable = { which = blokkat_capital_distance value = 450 } } save_global_event_target_as = blokkat_spawn_system }
		}
		else_if = {
			limit = { any_rim_system = { check_variable = { which = blokkat_capital_distance value = 400 } } }
			random_rim_system = { limit = { check_variable = { which = blokkat_capital_distance value = 400 } } save_global_event_target_as = blokkat_spawn_system }
		}
		else_if = {
			limit = { any_rim_system = { check_variable = { which = blokkat_capital_distance value = 350 } } }
			random_rim_system = { limit = { check_variable = { which = blokkat_capital_distance value = 350 } } save_global_event_target_as = blokkat_spawn_system }
		}
		else_if = {
			limit = { any_rim_system = { check_variable = { which = blokkat_capital_distance value = 300 } } }
			random_rim_system = { limit = { check_variable = { which = blokkat_capital_distance value = 300 } } save_global_event_target_as = blokkat_spawn_system }
		}
		else_if = {
			limit = { any_rim_system = { check_variable = { which = blokkat_capital_distance value = 250 } } }
			random_rim_system = { limit = { check_variable = { which = blokkat_capital_distance value = 250 } } save_global_event_target_as = blokkat_spawn_system }
		}
		else_if = {
			limit = { any_rim_system = { check_variable = { which = blokkat_capital_distance value = 200 } } }
			random_rim_system = { limit = { check_variable = { which = blokkat_capital_distance value = 200 } } save_global_event_target_as = blokkat_spawn_system }
		}
		else_if = {
			limit = { any_rim_system = { check_variable = { which = blokkat_capital_distance value = 150 } } }
			random_rim_system = { limit = { check_variable = { which = blokkat_capital_distance value = 150 } } save_global_event_target_as = blokkat_spawn_system }
		}
		else_if = {
			limit = { any_rim_system = { check_variable = { which = blokkat_capital_distance value = 100 } } }
			random_rim_system = { limit = { check_variable = { which = blokkat_capital_distance value = 100 } } save_global_event_target_as = blokkat_spawn_system }
		}
		else_if = {
			limit = { any_rim_system = { check_variable = { which = blokkat_capital_distance value = 50 } } }
			random_rim_system = { limit = { check_variable = { which = blokkat_capital_distance value = 50 } } save_global_event_target_as = blokkat_spawn_system }
		}
		event_target:blokkat_spawn_system = {
			set_star_flag = blokkat_spawn_system
			#set_name = "Elowiny"
			star = {
				save_global_event_target_as = blokkat_spawn_star
			}
		}
	}
}

#the arrival
country_event = {
	id = giga_blokkat.1006
	title = "giga_blokkat.1006.name"
	desc = "giga_blokkat.1006.desc"
	picture = GFX_evt_supernova
	show_sound = event_red_alert
	location = event_target:blokkat_spawn_system
	is_triggered_only = yes

	option = { #Uh oh
		name = "giga_blokkat.1006.a"
		end_event_chain = blokkat_pre_arrival_chain
		hidden_effect = {
			country_event = { id = giga_blokkat.1007 }
		}
	}
}

#hi
country_event = {
	id = giga_blokkat.1007
	title = "giga_blokkat.1007.name"
	desc = {
		text = "giga_blokkat.1007.desc"
		trigger = { NOT = { has_global_flag = giga_blokkats_deathmode } }
	}
	desc = {
		text = "giga_blokkat.1007.desc.deathmode"
		trigger = { has_global_flag = giga_blokkats_deathmode }
	}
	location = event_target:blokkat_spawn_system
	is_triggered_only = yes
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:blokkat_country.ruler
		room = blokkat3d_room
	}

	option = { #Uh oh
		name = "giga_blokkat.1007.a"
		trigger = { NOT = { has_global_flag = giga_blokkats_deathmode } }
		hidden_effect = {
			country_event = { id = giga_blokkat.1008 }
		}
	}

	option = { #Uh oh
		name = "giga_blokkat.1007.b"
		trigger = { has_global_flag = giga_blokkats_deathmode }
		hidden_effect = {
			country_event = { id = giga_blokkat.1008 }
		}
	}
}

#Spawn them
country_event = {
	id = giga_blokkat.1011
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		set_global_flag = blokkat_crisis_ongoing
		set_global_flag = sbtg_blokkat_light_block
		event_target:blokkat_spawn_system = {
			set_star_class = sc_blokkat_stripmined
			set_name = {
				key = "NAME_Giga_Blokkaspawn_Void_System"
				variable_string = "[blokkat_spawn_system.GetName]"
			}
			set_asteroid_belt = { radius = 0 }
			set_star_flag = blokkat_stripmined_system
			every_system_planet = {
				clear_deposits = yes
			}
			every_system_planet = {
				limit = {
					is_star = yes
				}
				change_pc = pc_giga_empty_space
				add_modifier = {
					modifier = blokkat_can_repair_system
					days = -1
				}
			}
			every_system_planet = {
				limit = {
					is_colony = yes
				}
				destroy_colony = yes
			}
			every_system_planet = {
				limit = { is_star = no }
				giga_remove_planet = yes
			}
			every_system_ambient_object = {
				destroy_ambient_object = THIS
			}
			every_system_megastructure = {
				limit = { NOT = { mega_blokkats_wont_stripmine = yes } }
				remove_megastructure = THIS
			}
			every_fleet_in_system = {
				limit = {
					owner = { NOT = { is_country_type = blokkat_stripminers } }
				}
				destroy_fleet = THIS
			}
		}

		#Make the species
		if = {
			limit = {
				NOR = {
					has_global_flag = regular_blokkats
					has_global_flag = vintage_blokkats
					has_global_flag = anime_blokkats 
				}
			}
			create_species = {
				class = BLOKKAT
				name = "Blokkat"
				plural = "Blokkats"
				adjective = "Blokkat"
				portrait = blokkat3d_ruler
				namelist = "AI"
				traits = {
					trait = species_trait_blokkat
					trait = trait_mechanical
					trait = trait_psionic
				}
				effect = {
					save_global_event_target_as = blokkat_species
				}
			}
			create_species = { #Portraits with diversity used for admirals
				class = BLOKKAT
				name = "Blokkat"
				plural = "Blokkats"
				adjective = "Blokkat"
				portrait = blokkat3d
				namelist = "AI"
				traits = {
					trait = species_trait_blokkat
					trait = trait_mechanical
					trait = trait_psionic
				}
				effect = {
					save_global_event_target_as = diverse_blokkat_species
				}
			}
			create_species = { #Portraits used for Terminator leaders
				class = BLOKKAT
				name = "Blokkat"
				plural = "Blokkats"
				adjective = "Blokkat"
				portrait = blokkat3d
				namelist = "AI"
				traits = {
					trait = species_trait_blokkat
					trait = trait_mechanical
					trait = trait_psionic
				}
				effect = {
					save_global_event_target_as = admiral_blokkat_species
				}
			}
		}

		#Make the species
		else_if = {
			limit = { has_global_flag = regular_blokkats }
			create_species = {
				class = BLOKKAT
				name = "Blokkat"
				plural = "Blokkats"
				adjective = "Blokkat"
				portrait = blokkat
				namelist = "AI"
				traits = {
					trait = species_trait_blokkat
					trait = trait_mechanical
					trait = trait_psionic
				}
				effect = {
					save_global_event_target_as = blokkat_species
				}
			}
			create_species = { #Portraits with diversity used for admirals
				class = BLOKKAT
				name = "Blokkat"
				plural = "Blokkats"
				adjective = "Blokkat"
				portrait = diverseblokkat
				namelist = "AI"
				traits = {
					trait = species_trait_blokkat
					trait = trait_mechanical
					trait = trait_psionic
				}
				effect = {
					save_global_event_target_as = diverse_blokkat_species
				}
			}
			create_species = { #Portraits used for Terminator leaders
				class = BLOKKAT
				name = "Blokkat"
				plural = "Blokkats"
				adjective = "Blokkat"
				portrait = diverseblokkat
				namelist = "AI"
				traits = {
					trait = species_trait_blokkat
					trait = trait_mechanical
					trait = trait_psionic
				}
				effect = {
					save_global_event_target_as = admiral_blokkat_species
				}
			}
		}

		#Make the species
		else_if = {
			limit = { has_global_flag = vintage_blokkats }
			create_species = {
				class = BLOKKAT
				name = "Blokkat"
				plural = "Blokkats"
				adjective = "Blokkat"
				portrait = oldblokkat
				namelist = "AI"
				traits = {
					trait = species_trait_blokkat
					trait = trait_mechanical
					trait = trait_psionic
				}
				effect = {
					save_global_event_target_as = blokkat_species
				}
			}
			create_species = { #Portraits with diversity used for admirals
				class = BLOKKAT
				name = "Blokkat"
				plural = "Blokkats"
				adjective = "Blokkat"
				portrait = diverseoldblokkat
				namelist = "AI"
				traits = {
					trait = species_trait_blokkat
					trait = trait_mechanical
					trait = trait_psionic
				}
				effect = {
					save_global_event_target_as = diverse_blokkat_species
				}
			}
			create_species = { #Portraits used for Terminator leaders
				class = BLOKKAT
				name = "Blokkat"
				plural = "Blokkats"
				adjective = "Blokkat"
				portrait = admiraloldblokkat
				namelist = "AI"
				traits = {
					trait = species_trait_blokkat
					trait = trait_mechanical
					trait = trait_psionic
				}
				effect = {
					save_global_event_target_as = admiral_blokkat_species
				}
			}
		}

		#Make the species
		else_if = {
			limit = { has_global_flag = anime_blokkats }
			create_species = {
				class = BLOKKAT
				name = "Blokkat"
				plural = "Blokkats"
				adjective = "Blokkat"
				portrait = giga_blokumi_green
				namelist = "AI"
				traits = {
					trait = species_trait_blokkat
					trait = trait_mechanical
					trait = trait_psionic
				}
				effect = {
					save_global_event_target_as = blokkat_species
				}
			}
			create_species = { #Portraits with diversity used for admirals
				class = BLOKKAT
				name = "Blokkat"
				plural = "Blokkats"
				adjective = "Blokkat"
				portrait = giga_blokumi_1
				namelist = "AI"
				traits = {
					trait = species_trait_blokkat
					trait = trait_mechanical
					trait = trait_psionic
				}
				effect = {
					save_global_event_target_as = diverse_blokkat_species
				}
			}
			create_species = { #Portraits with diversity used for admirals
				class = BLOKKAT
				name = "Blokkat"
				plural = "Blokkats"
				adjective = "Blokkat"
				portrait = giga_blokumi_1
				namelist = "AI"
				traits = {
					trait = species_trait_blokkat
					trait = trait_mechanical
					trait = trait_psionic
				}
				effect = {
					save_global_event_target_as = admiral_blokkat_species
				}
			}
		}

		#Make the country
		create_country = {
			type = blokkat_stripminers
			name = "Blokkat Harvesters"
			species = event_target:blokkat_species
			auto_delete = no
			flag = {
				icon={
					category="Blokkat"
					file="Blokkat_flag.dds"
				}
				background={
					category="backgrounds"
					file="triangle_split.dds"
				}
				colors={
					"dark_green"
					"teal"
					"null"
					"null"
				}
			}
			ignore_initial_colony_error = yes
			effect = {
				set_country_flag = custom_difficulty_no_bonuses_flag #dynamic difficulty compat for no overflow
				#Base cost for the shieldkiller : 800k
				#On Very Easy --> 200k
				#On Baby --> 400k
				#On Bismuth --> 1.5M
				#On Endtech --> 10M (cuz screw you lol)
				#On Deathmod --> 20M (cuz double screw you lol)
				if = {
					limit = { has_global_flag = giga_blokkats_very_easy }
					set_variable = {
						which = blokkat_shieldkiller_activation_cost
						value = 200000
					}
				}
				if = {
					limit = { has_global_flag = giga_blokkats_easy }
					set_variable = {
						which = blokkat_shieldkiller_activation_cost
						value = 400000
					}
				}
				if = {
					limit = { has_global_flag = giga_blokkats_normal }
					set_variable = {
						which = blokkat_shieldkiller_activation_cost
						value = 800000
					}
				}
				if = {
					limit = { has_global_flag = giga_blokkats_bismuth }
					set_variable = {
						which = blokkat_shieldkiller_activation_cost
						value = 1500000
					}
				}
				if = {
					limit = { has_global_flag = giga_blokkats_endtech }
					set_variable = {
						which = blokkat_shieldkiller_activation_cost
						value = 5000000
					}
				}
				if = {
					limit = { has_global_flag = giga_blokkats_deathmode }
					set_variable = {
						which = blokkat_shieldkiller_activation_cost
						value = 20000000
					}
				}
				save_global_event_target_as = blokkat_country
				country_event = { id = giga_blokkat.1012 }
			}
		} 

		#Establish comms
		every_country = { establish_communications_no_message = event_target:blokkat_country }
		every_country = {
			establish_contact = {
				who = event_target:blokkat_country
				location = event_target:blokkat_spawn_system
			}
		}
	}
}

country_event = {
	id = giga_blokkat.1012
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		event_target:blokkat_spawn_system = {
			save_global_event_target_as = current_blokkat_mothership_system
			save_global_event_target_as = future_blokkat_mothership_system
		}

		set_variable = {
			which = current_blokkat_phase
			value = 1
		}

		set_variable = {
			which = current_blokkat_stripminer_max_id
			value = 1
		}

		set_variable = {
			which = current_blokkat_escort_max_id
			value = 1
		}

		#Blokkat Capture IDs
		event_target:global_event_country = {
			set_variable = {
				which = current_blokkat_prison_max_id
				value = 1
			}
		}

		#Blokkat Capture Base Research Time (months)
		every_country = {
			set_variable = {
				which = blokkat_prison_research_time
				value = 8
			}
		}

		country_event = { id = giga_blokkat.7000 days = 30 } #Start the stripmining process
		country_event = { id = giga_blokkat.5000 days = 30 } #Inquietude stuff

		#MOTHERSHIP REVIVES
		if = {
			limit = { has_global_flag = giga_blokkats_deathmode }
			set_variable = { #40 billion HP
				which = blokkat_mothership_life_count
				value = 100
			}
		}
		else_if = {
			limit = { has_global_flag = giga_blokkats_endtech }
			set_variable = {
				which = blokkat_mothership_life_count
				value = 20
			}
		}
		else_if = {
			limit = { has_global_flag = giga_blokkats_bismuth }
			set_variable = {
				which = blokkat_mothership_life_count
				value = 5
			}
		}
		else_if = {
			limit = { has_global_flag = giga_blokkats_easy }
			set_variable = {
				which = blokkat_mothership_life_count
				value = 1
			}
		}
		else_if = {
			limit = { has_global_flag = giga_blokkats_very_easy }
			set_variable = {
				which = blokkat_mothership_life_count
				value = 1
			}
		}
		else = {
			set_variable = {
				which = blokkat_mothership_life_count
				value = 2
			}
		}

		#Harvester life count
		if = {
			limit = { has_global_flag = giga_blokkats_deathmode }
			set_variable = { #40 billion HP
				which = blokkat_harvester_life_count
				value = 20
			}
		}
		else_if = {
			limit = { has_global_flag = giga_blokkats_endtech }
			set_variable = {
				which = blokkat_harvester_life_count
				value = 6
			}
		}
		else_if = {
			limit = { has_global_flag = giga_blokkats_bismuth }
			set_variable = {
				which = blokkat_harvester_life_count
				value = 3
			}
		}
		else_if = {
			limit = { has_global_flag = giga_blokkats_easy }
			set_variable = {
				which = blokkat_harvester_life_count
				value = 1
			}
		}
		else_if = {
			limit = { has_global_flag = giga_blokkats_very_easy }
			set_variable = {
				which = blokkat_harvester_life_count
				value = 1
			}
		}
		else = {
			set_variable = {
				which = blokkat_harvester_life_count
				value = 2
			}
		}

		#OBLITERATOR REVIVES
		if = {
			limit = { has_global_flag = giga_blokkats_deathmode }
			set_variable = { #100 billion HP (lol?)
				which = blokkat_obliterator_life_count
				value = 200
			}
		}

		#TERMINATOR REVIVES
		if = {
			limit = { has_global_flag = giga_blokkats_deathmode }
			set_variable = {
				which = blokkat_terminator_life_count
				value = 10
			}
		}
		else_if = {
			limit = { has_global_flag = giga_blokkats_endtech }
			set_variable = {
				which = blokkat_terminator_life_count
				value = 5
			}
		}
		else = {
			set_variable = {
				which = blokkat_terminator_life_count
				value = 2
			}
		}

		#SET DIFFICULTY
		if = {
			limit = { has_global_flag = giga_blokkats_deathmode }
			add_modifier = {
				modifier = blokkat_deathmode_country_buff
				days = -1
			}
		}

		if = {
			limit = { has_global_flag = giga_blokkats_endtech }
			add_modifier = {
				modifier = blokkat_endtech_country_buff
				days = -1
			}
		}

		if = {
			limit = { has_global_flag = giga_blokkats_bismuth }
			add_modifier = {
				modifier = blokkat_bismuth_country_buff
				days = -1
			}
		}

		if = {
			limit = { has_global_flag = giga_blokkats_easy }
			add_modifier = {
				modifier = blokkat_easy_country_buff
				days = -1
			}
		}

		if = {
			limit = { has_global_flag = giga_blokkats_very_easy }
			add_modifier = {
				modifier = blokkat_very_easy_country_buff
				days = -1
			}
		}

		add_modifier = {
			modifier = giga_blokkat_balance
			days = -1
		}


		#Counting systems
		set_variable = { #% of systems the blokkats ate
			which = blokkat_stripmined_system_perc_last_month
			value = 0
		}

		set_variable = { #% of systems the blokkats ate
			which = blokkat_stripmined_system_perc
			value = 0
		}

		#Determine the amount of Blokk-Dismantlers
		set_variable = { #total systems
			which = blokkat_galaxy_system_count
			value = 0
		}

		every_system = { #count all systems
			ROOT = {
				change_variable = {
					which = blokkat_galaxy_system_count
					value = 1
				}
			}
		}

		set_variable = {
			which = blokkat_dismantler_max_count
			value = blokkat_galaxy_system_count
		}

		divide_variable = {
			which = blokkat_dismantler_max_count
			value = 125
		}

		if = {
			limit = { has_global_flag = giga_blokkats_deathmode }
			set_variable = {
				which = blokkat_dismantler_max_count
				value = 20
			}
		}

		if = {
			limit = { has_global_flag = giga_blokkats_endtech }
			multiply_variable = {
				which = blokkat_dismantler_max_count
				value = 3
			}
		}

		if = {
			limit = { has_global_flag = giga_blokkats_bismuth }
			multiply_variable = {
				which = blokkat_dismantler_max_count
				value = 2
			}
		}

		if = {
			limit = { has_global_flag = giga_blokkats_easy }
			multiply_variable = {
				which = blokkat_dismantler_max_count
				value = 0.70
			}
		}

		if = {
			limit = { has_global_flag = giga_blokkats_very_easy }
			multiply_variable = {
				which = blokkat_dismantler_max_count
				value = 0.60
			}
		}

		floor_variable = blokkat_dismantler_max_count

		#20 is max, else it breaks :(
		if = {
			limit = {
				check_variable = {
					which = blokkat_dismantler_max_count
					value > 20
				}
			}
			set_variable = {
				which = blokkat_dismantler_max_count
				value = 20
			}
		}

		#TEST
		#set_variable = { which = blokkat_dismantler_max_count value = 40 }

		set_variable = {
			which = blokkat_dismantler_current_count
			value = 0
		}
		
		while = {
			limit = {
				check_variable = {
					which = blokkat_dismantler_current_count
					value < blokkat_dismantler_max_count
				}
			}
			create_blokkat_admiral = yes
			spawn_blokkat_escort_fleet = yes
			spawn_blokkat_harvesting_fleet = yes
			change_variable = {
				which = blokkat_dismantler_current_count
				value = 1
			}
		}

		spawn_blokkat_mothership_fleet = yes

		set_variable = {
			which = blokkat_max_scout_fleet_count
			value = blokkat_dismantler_max_count
		}

		multiply_variable = {
			which = blokkat_max_scout_fleet_count
			value = 3
		}
	}
}

#When a stripmining fleets enters a pristine system with at least 2 hyperlanes, spawn a scout fleet (once every 6 months)
fleet_event = {
	id = giga_blokkat.4000
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		NOT = { has_global_flag = blokkat_scout_fleet_cooldown }
		has_fleet_flag = blokkat_stripmine_fleet
		FROM = {
			NOT = { is_star_class = sc_blokkat_stripmined }
		}
		event_target:blokkat_country = {
			check_variable = {
				which = blokkat_scout_fleet_count
				value < blokkat_max_scout_fleet_count
			}
		}
	}

	immediate = {
		solar_system = { save_global_event_target_as = blokkat_scout_fleet_location }
		set_timed_global_flag = {
			flag = blokkat_scout_fleet_cooldown
			days = 60
		}
		random_list = {
			5 = {
				spawn_blokkat_blokkazoi = yes
				modifier = {
					factor = 0
					any_country = { any_owned_leader = { has_leader_flag = blokkazoi_leader } }
				}
			}
			95 = {
				spawn_blokkat_scout_fleet = yes
			}
		}
	}
}

country_event = {
	id = giga_blokkat.6000
	title = "giga_blokkat.6000.name"
	desc = "giga_blokkat.6000.desc"
	is_triggered_only = yes

	picture = GFX_evt_supernova
	show_sound = event_red_alert

	option = { #kk
		name = "giga_blokkat.6000.a"
		custom_tooltip = "giga_blokkat.6000.a.tooltip"
	}
}

country_event = {
	id = giga_blokkat.6002
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		if = {
			limit = { NOT = { has_global_flag = blokkat_crisis_defeated } }
			every_country = {
				limit = { is_ai = no }
				country_event = { id = giga_blokkat.6001 }
			}
			event_target:blokkat_country = {
				country_event = { id = giga_blokkat.6003 days = 30 } #No cheese
			}
		}
	}
}

country_event = {
	id = giga_blokkat.6001
	title = "giga_blokkat.6001.name"
	desc = "giga_blokkat.6001.desc"
	is_triggered_only = yes

	picture = GFX_evt_black_hole
	show_sound = event_ghost_town

	trigger = { NOT = { has_global_flag = blokkat_crisis_defeated } }

	option = { #kk
		name = "giga_blokkat.6001.a"
		custom_tooltip = "giga_blokkat.6001.a.tooltip"
		hidden_effect = {
			every_galaxy_planet = {
				limit = { NOT = { has_planet_flag = paluushia } }
				clear_deposits = yes
				giga_remove_planet = yes
			}
			every_system = {
				limit = { NOT = { is_star_class = sc_empty_space } }
				set_star_class = sc_empty_space
				set_name = "Empty Void"
				set_asteroid_belt = { radius = 0 }
			}
			every_system = { every_neighbor_system = { remove_hyperlane = { from = prev to = this } } }
			every_country = {
				limit = {
					NOR = {
						is_country = event_target:paluush_portrait
						is_country = event_target:blokkat_country
					}
				}
				destroy_country = yes
			}
			every_megastructure = {
				limit = { NOT = { mega_blokkats_wont_stripmine = yes } }
				remove_megastructure = THIS
			}
			event_target:paluushia = {
				if = {
					limit = { is_colony = yes }
					destroy_colony = yes
				}
				change_pc = pc_continental
				generate_paluush_primitives_on_planet = yes
			}
		}
	}
}

country_event = {
	id = giga_blokkat.6003
	is_triggered_only = yes

	hide_window = yes

	trigger = { NOT = { has_global_flag = blokkat_crisis_defeated } }

	immediate = {
		set_global_flag = blokkat_mothership_killed_legit
		event_target:blokkat_country = {
			every_owned_fleet = { delete_fleet = THIS }
		}
		every_galaxy_planet = {
			limit = { NOT = { has_planet_flag = paluushia } }
			clear_deposits = yes
			giga_remove_planet = yes
		}
		every_system = {
			limit = { NOT = { is_star_class = sc_empty_space } }
			set_star_class = sc_empty_space
			set_name = "Empty Void"
			set_asteroid_belt = { radius = 0 }
		}
		every_system = { every_neighbor_system = { remove_hyperlane = { from = prev to = this } } }
		every_country = {
			limit = {
				NOR = {
					is_country = event_target:paluush_portrait
					is_country = event_target:blokkat_country
				}
			}
			destroy_country = yes
		}
		every_megastructure = {
			limit = { NOT = { mega_blokkats_wont_stripmine = yes } }
			remove_megastructure = THIS
		}
		event_target:paluushia = {
			if = {
				limit = { is_colony = yes }
				destroy_colony = yes
			}
			change_pc = pc_continental
			generate_paluush_primitives_on_planet = yes
		}
	}
}

#Inquietude & others
country_event = {
	id = giga_blokkat.5000
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		if = {
			limit = {
				has_global_flag = blokkat_bureau_popup
				NOT = { has_global_flag = blokkat_crisis_defeated }
			}
			every_country = {
				limit = { is_ai = no }
				if = {
					limit = { NOT = { has_country_flag = blokkat_bureau_unlocked } }
					set_country_flag = blokkat_bureau_unlocked
				}
			}
		}
		if = {
			limit = {
				NOT = { has_global_flag = blokkat_crisis_defeated }
				any_system = {
					is_star_class = sc_blokkat_stripmined
					exists = starbase
				}
			}
			every_system = {
				limit = {
					is_star_class = sc_blokkat_stripmined
					exists = starbase
				}
				starbase = { 
					set_owner = event_target:global_event_country
				}
				every_ship_in_system = {
					limit = { owner = { is_country = event_target:global_event_country } }
					destroy_ship = THIS
				}
			}
		}
		if = {
			limit = {
				NOT = { has_global_flag = blokkat_crisis_defeated }
				OR = {
					NOT = { any_system = { NOT = { systems_blokkats_wont_stripmine = yes } } }
					has_global_flag = blokkats_ate_most_of_galaxy
				}
				NOT = { has_global_flag = blokkat_vester_gonna_destroy_galaxy }
			}
			set_global_flag = blokkat_vester_gonna_destroy_galaxy
			every_country = {
				limit = { is_ai = no }
				country_event = { id = giga_blokkat.6000 }
			}
			event_target:blokkat_country = {
				country_event = { id = giga_blokkat.6002 days = 720 } #CHANGE TO 2 YEARS
			}
		}
		# if = {
		# 	limit = {
		# 		NOT = { has_global_flag = blokkat_crisis_defeated }
		# 	}
		# 	every_country = {
		# 		limit = {
		# 			any_owned_megastructure = {
		# 				is_blokkat_shieldkiller_mega = yes
		# 			}
		# 		}
		# 		set_variable = {
		# 			which = blokkat_shieldkiller_count
		# 			value = 0
		# 		}
		# 		every_owned_megastructure = {
		# 			limit = { is_blokkat_shieldkiller_mega = yes }
		# 			ROOT = {
		# 				change_variable = {
		# 					which = blokkat_shieldkiller_count
		# 					value = 1
		# 				}
		# 			}
		# 		}
		# 		if = {
		# 			limit = {
		# 				ROOT = {
		# 					check_variable = {
		# 						which = blokkat_shieldkiller_count
		# 						value > 1
		# 					}
		# 				}
		# 			}
		# 			ROOT = {
		# 				while = {
		# 					limit = {
		# 						check_variable = {
		# 							which = blokkat_shieldkiller_count
		# 							value > 1
		# 						}
		# 					}
		# 					random_owned_megastructure = {
		# 						limit = { is_blokkat_shieldkiller_mega = yes }
		# 						planet = {
		# 							remove_planet_flag = megastructure
		# 							remove_planet_flag = has_megastructure
		# 						}
		# 						solar_system = { remove_star_flag = has_blokkat_shield_killer }
		# 						remove_megastructure = THIS
		# 					}
		# 					subtract_variable = {
		# 						which = blokkat_shieldkiller_count
		# 						value = 1
		# 					}
		# 				}
		# 			}
		# 		}
		# 	}
		# }
		if = {
			limit = {
				has_global_flag = blokkat_crisis_defeated
				any_country = {
					has_country_flag = paluush_event_chain_ongoing
					has_country_flag = grand_archive_dig_done
				}
			}
			event_target:paluush_event_chain_country = {
				country_event = { id = giga_blokkat.3335 } #Grandbunny retreats
			}
		}
		if = {
			limit = {
				any_country = { has_country_flag = paluush_event_chain_ongoing }
				NOT = { exists = event_target:paluushia }
			}
			every_country = {
				limit = { has_country_flag = paluush_event_chain_ongoing }
				remove_country_flag = paluush_event_chain_ongoing
				country_event = { id = giga_blokkat.3334 }
			}
		}
		every_country = {
			limit = { NOT = { has_country_flag = blokkat_difficulty_modifiers_applied } }
			set_country_flag = blokkat_difficulty_modifiers_applied
			if = {
				limit = { has_global_flag = giga_blokkats_very_easy }
				add_modifier = {
					modifier = blokkat_very_easy_research_penalty
					days = -1
				}
			}
			if = {
				limit = { has_global_flag = giga_blokkats_easy }
				add_modifier = {
					modifier = blokkat_easy_research_penalty
					days = -1
				}
			}
			if = {
				limit = { has_global_flag = giga_blokkats_bismuth }
				add_modifier = {
					modifier = blokkat_bismuth_research_penalty
					days = -1
				}
			}
			if = {
				limit = { has_global_flag = giga_blokkats_endtech }
				add_modifier = {
					modifier = blokkat_endtech_research_penalty
					days = -1
				}
			}
			if = {
				limit = { has_global_flag = giga_blokkats_deathmode }
				add_modifier = {
					modifier = blokkat_deathmode_research_penalty
					days = -1
				}
			}
		}
		if = {
			limit = {
				has_global_flag = blokkat_crisis_defeated
				any_country = {
					has_technology = giga_tech_blokkat_timetravel
					NOT = { has_country_flag = can_research_blokkat_star_repair }
				}
			}
			every_country = {
				limit = {
					has_technology = giga_tech_blokkat_timetravel
					NOT = { has_country_flag = can_research_blokkat_star_repair }
				}
				set_country_flag = can_research_blokkat_star_repair
				country_event = { id = giga_blokkat.3350 days = 180 random = 180 }
			}
		}


		if = {
			limit = {
				any_country = {
					has_technology = giga_tech_blokkat_timetravel
					has_technology = giga_tech_blokkat_mega_stage_3
					NOT = { has_country_flag = unlocked_final_blokkat_mega_stage }
				}
			}
			every_country = {
				limit = {
					has_technology = giga_tech_blokkat_timetravel
					has_technology = giga_tech_blokkat_mega_stage_3
					NOT = { has_country_flag = unlocked_final_blokkat_mega_stage }
				}
				set_country_flag = unlocked_final_blokkat_mega_stage
				country_event = { id = giga_blokkat.3328 days = 5 random = 5 }
			}
		}

		if = {
			limit = {
				has_global_flag = waiting_to_kill_paluushia_manifestation
				NOT = { exists = event_target:paluush_energies_fleet } 
			}
			event_target:paluush_event_chain_country = {
				country_event = { id = giga_blokkat.3305 }
			}
		}

		#checks for the Paluush task
		if = {
			limit = {
				any_system = {
					has_star_flag = Paluush_system
					any_ship_in_system = {
						is_ship_size = science
						owner = { 
							NOT = { has_country_flag = blokkat_sent_science_ship_to_gatzo }
							has_country_flag = blokkat_paluush_analysis_researched
						}
					}
				}
			}
			every_system = {
				limit = {
					has_star_flag = Paluush_system
					any_ship_in_system = {
						is_ship_size = science
						owner = { 
							NOT = { has_country_flag = blokkat_sent_science_ship_to_gatzo }
							has_country_flag = blokkat_paluush_analysis_researched
						}
					}
				}
				random_ship_in_system = {
					limit = {
						is_ship_size = science
						owner = { 
							NOT = { has_country_flag = blokkat_sent_science_ship_to_gatzo }
							has_country_flag = blokkat_paluush_analysis_researched
						}
					}
					owner = {
						country_event = { id = giga_blokkat.3303 }
					}
				}
			}
		}

		if = {
			limit = { has_global_flag = gotta_respawn_blokkat_mothership }
			remove_global_flag = gotta_respawn_blokkat_mothership
			if = {
				limit = { NOT = { has_global_flag = blokkats_respawned_to_unstuck } }
				every_country = { country_event = { id = giga_blokkat.5004 } }
			}
			spawn_blokkat_mothership_fleet = yes
		}
		if = {
			limit = {
				NOT = { has_global_flag = gotta_respawn_blokkat_mothership }
				NOT = { has_global_flag = blokkat_mothership_shield_down }
				NOT = { has_global_flag = blokkat_mothership_killed_legit }
				NOT = { has_global_flag = blokkat_crisis_defeated }
				OR = {
					NOT = { any_owned_fleet = { has_fleet_flag = blokkat_mothership_fleet } }
					event_target:blokkat_mothership_ship = {
						is_disabled = yes
					}
				}
			}
			if = {
				limit = {
					event_target:blokkat_mothership_ship = {
						is_disabled = yes
					}
				}
				event_target:blokkat_mothership_fleet = { destroy_fleet = THIS }
			}
			if = {
				limit = { exists = event_target:blokkat_mothership_escort_fleet }
				event_target:blokkat_mothership_escort_fleet = { destroy_fleet = THIS }
			}
			if = {
				limit = { NOT = { has_global_flag = blokkats_respawned_to_unstuck } }
				every_country = {
					country_event = { id = giga_blokkat.50031 }
				}
			}
			set_global_flag = gotta_respawn_blokkat_mothership
		}
		if = { #delete IF shield is down
			limit = {
				NOT = { has_global_flag = gotta_respawn_blokkat_mothership }
				has_global_flag = blokkat_mothership_shield_down
				NOT = { has_global_flag = blokkat_mothership_killed_legit }
				NOT = { has_global_flag = blokkat_crisis_defeated }
				NOT = { any_owned_fleet = { has_fleet_flag = blokkat_mothership_fleet } }
			}
			#set_global_flag = blokkat_mothership_killed_legit
			if = {
				limit = {
					event_target:blokkat_mothership_ship = { is_disabled = yes }
				}
				event_target:blokkat_mothership_fleet = { destroy_fleet = THIS }
			}
			if = {
				limit = { exists = event_target:blokkat_mothership_escort_fleet }
				event_target:blokkat_mothership_escort_fleet = { destroy_fleet = THIS }
			}
			random_country = {
				limit = { is_ai = no }
				country_event = { id = giga_blokkat.1030 }
			}
		}
		every_megastructure = {
			limit = {
				has_modifier = blokkat_shield_mega_build_speed_bonus
				OR = {
					is_megastructure_type = blokkat_shield_killer_0
					is_megastructure_type = blokkat_shield_killer_1
					is_megastructure_type = blokkat_shield_killer_2
					is_megastructure_type = blokkat_shield_killer_3
				}
			}
			remove_modifier = blokkat_shield_mega_build_speed_bonus
		}
		if = {
			limit = {
				any_country = { has_edict = blokkat_buff_shield_mega }
			}
			every_country = {
				limit = { has_edict = blokkat_buff_shield_mega }
				every_owned_megastructure = {
					limit = {
						OR = {
							is_megastructure_type = blokkat_shield_killer_0
							is_megastructure_type = blokkat_shield_killer_1
							is_megastructure_type = blokkat_shield_killer_2
							is_megastructure_type = blokkat_shield_killer_3
						}
					}
					add_modifier = {
						modifier = blokkat_shield_mega_build_speed_bonus
						days = -1
					}
				}
			}
		}
		event_target:blokkat_country = {
			set_variable = {
				which = blokkat_scout_fleet_count
				value = 0
			}
			every_owned_fleet = { #Clear "stuck" scout fleets
				limit = { 
					has_fleet_flag = blokkat_scout_fleet
					solar_system = { 
						is_star_class = sc_blokkat_stripmined
						NOR = {
							any_fleet_in_system = { has_fleet_flag = blokkat_stripmine_fleet }
							any_fleet_in_system = { has_fleet_flag = blokkat_mothership_fleet }
						} 
					}
				}
				delete_fleet = THIS
			}
			every_owned_fleet = {
				limit = { has_fleet_flag = blokkat_scout_fleet }
				event_target:blokkat_country = {
					change_variable = {
						which = blokkat_scout_fleet_count
						value = 1
					}
				}
			}
			# every_owned_fleet = {
			# 	limit = { has_fleet_flag = blokkat_scout_fleet }
			# 	random = {
			# 		chance = 75
			# 		clear_orders = yes
			# 	}
			# 	random_system = {
			# 		limit = {
			# 			NOT = { is_star_class = sc_blokkat_stripmined }
			# 		}
			# 		save_global_event_target_as = blokkat_scout_fleet_target
			# 	}
			# 	queue_actions = {
			# 		move_to = event_target:blokkat_scout_fleet_target
			# 	}
			# }
		}
		if = {
			limit = { NOT = { has_global_flag = blokkat_mothership_shield_down } }
			event_target:blokkat_mothership_ship = { repair_ship = yes }
		}
		#Readd Shield Modifier if it's somehow missing
		if = {
			limit = {
				NOT = { has_global_flag = blokkat_mothership_shield_down }
				event_target:blokkat_mothership_fleet = {
					solar_system = { NOT = { has_modifier = blokkat_mothership_shield } }
				}
			}
			every_system = {
				limit = { has_modifier = blokkat_mothership_shield }
				remove_modifier = blokkat_mothership_shield
			}
			event_target:blokkat_mothership_fleet = {
				solar_system = { add_modifier = { modifier = blokkat_mothership_shield days = -1 } }
			}
		}
		#check for engines
		if = {
			limit = {
				NOT = { has_global_flag = blokkat_crisis_defeated }
				any_country = {
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = crisis_sphere_0
							is_megastructure_type = crisis_sphere_1
							is_megastructure_type = crisis_sphere_2
							is_megastructure_type = crisis_sphere_3
							is_megastructure_type = crisis_sphere_4
						}
					}
					NOT = { has_country_flag = blokkats_warned_about_crisis_sphere }
				}
			}
			every_country = {
				limit = {
					any_owned_megastructure = {
						OR = {
							is_megastructure_type = crisis_sphere_0
							is_megastructure_type = crisis_sphere_1
							is_megastructure_type = crisis_sphere_2
							is_megastructure_type = crisis_sphere_3
							is_megastructure_type = crisis_sphere_4
						}
					}
					NOT = { has_country_flag = blokkats_warned_about_crisis_sphere }
				}
				set_country_flag = blokkats_warned_about_crisis_sphere
				country_event = { id = giga_blokkat.5001 days = 10 }
			}
		}
	

		#checks for the exploration task
		if = {
			limit = {
				any_system = {
					has_star_flag = blokkat_stripmined_system
					any_ship_in_system = {
						is_ship_size = science
						owner = { 
							NOT = { has_country_flag = blokkat_ship_sent_to_system }
							has_country_flag = blokkat_shield_researched
						}
					}
				}
			}
			every_system = {
				limit = {
					has_star_flag = blokkat_stripmined_system
					any_ship_in_system = {
						is_ship_size = science
						owner = { 
							NOT = { has_country_flag = blokkat_ship_sent_to_system }
							has_country_flag = blokkat_shield_researched
						}
					}
				}
				random_ship_in_system = {
					limit = {
						is_ship_size = science
						owner = { 
							NOT = { has_country_flag = blokkat_ship_sent_to_system }
							has_country_flag = blokkat_shield_researched
						}
					}
					owner = {
						country_event = { id = giga_blokkat.3070 }
					}
				}
			}
		}

		set_variable = {
			which = blokkat_dismantler_current_count
			value = 0
		}
		every_owned_fleet = {
			limit = { has_fleet_flag = blokkat_stripmine_fleet }
			ROOT = {
				change_variable = {
					which = blokkat_dismantler_current_count
					value = 1
				}
			}
		}
		if = {
			limit = {
				check_variable = {
					which = blokkat_dismantler_current_count
					value < blokkat_dismantler_max_count
				}
				NOT = { has_country_flag = hasnt_repaired_stripmine_fleet_yet }
			}
			set_country_flag = blokkat_stripmine_fleet_needs_repairs
			set_country_flag = hasnt_repaired_stripmine_fleet_yet
			set_timed_country_flag = {
				flag = blokkat_stripmine_fleet_repair_cooldown
				days = 90
			}
		}
		country_event = { id = giga_blokkat.5000 days = 30 }
		set_variable = {
			which = blokkat_stripmined_system_perc_last_month #the last time it was done
			value = blokkat_stripmined_system_perc
		}
		set_variable = { #% of systems the blokkats ate
			which = blokkat_stripmined_system_perc
			value = 0
		}
		set_variable = { #total systems
			which = blokkat_galaxy_system_count
			value = 0
		}
		set_variable = { #systems the blokkats ate
			which = blokkat_stripmined_system_count
			value = 0
		}
		every_system = { #count all systems
			ROOT = {
				change_variable = {
					which = blokkat_galaxy_system_count
					value = 1
				}
			}
		}
		every_system = { #count stripmined systems
			limit = {
				OR = {
					has_star_flag = blokkat_stripmined_system
					has_star_flag = blokkat_spawn_system
				}
			}
			ROOT = {
				change_variable = {
					which = blokkat_stripmined_system_count
					value = 1
				}
			}
		}
		set_variable = { #math
			which = blokkat_stripmined_system_perc
			value = blokkat_stripmined_system_count
		}
		divide_variable = { #divide by total systems
			which = blokkat_stripmined_system_perc
			value = blokkat_galaxy_system_count
		}
		multiply_variable = { #multiply by 100 to get %
			which = blokkat_stripmined_system_perc
			value = 100
		}
		round_variable = blokkat_stripmined_system_perc
		round_variable = blokkat_stripmined_system_perc_last_month
		if = {
			limit = {
				check_variable = {
					which = blokkat_stripmined_system_perc
					value > 95
				}
				NOT = { has_global_flag = blokkats_ate_most_of_galaxy }
			}
			set_global_flag = blokkats_ate_most_of_galaxy
		}
		set_variable = { #how much inquietude the last month generated
			which = blokkat_new_inquietude_value
			value = blokkat_stripmined_system_perc
		}
		subtract_variable = {
			which = blokkat_new_inquietude_value
			value = blokkat_stripmined_system_perc_last_month
		}
		multiply_variable = {
			which = blokkat_new_inquietude_value
			value = 2 #doubled
		}
		every_country = { #a cool side effect is that inquietude will actually go *down* if more systems are created through the EHOF
			limit = {
				is_ai = no
				has_country_flag = has_blokkat_inquietude
			}
			change_variable = {
				which = blokkat_inquietude_value
				value = ROOT.blokkat_new_inquietude_value
			}
			#round_variable = blokkat_inquietude_value
			if = {
				limit = {
					check_variable = {
						which = blokkat_inquietude_value
						value < 0
					}
				}
				set_variable = {
					which = blokkat_inquietude_value
					value = 0
				}
			}
			if = {
				limit = {
					check_variable = {
						which = blokkat_inquietude_value
						value > 100
					}
				}
				set_variable = {
					which = blokkat_inquietude_value
					value = 100
				}
			}
			set_variable = {
				which = blokkat_inquietude_research_value
				value = 3
			}
			set_variable = {
				which = blokkat_inquietude_stability_value
				value = 1
			}
			set_variable = {
				which = blokkat_inquietude_happiness_value #crime value (used to impact happiness)
				value = 4
			}
			multiply_variable = {
				which = blokkat_inquietude_research_value
				value = blokkat_inquietude_value
			}
			multiply_variable = {
				which = blokkat_inquietude_stability_value
				value = blokkat_inquietude_value
			}
			multiply_variable = {
				which = blokkat_inquietude_happiness_value
				value = blokkat_inquietude_value
			}
			every_owned_planet = {
				limit = { is_colony = yes }
				if = {
					limit = { has_modifier = blokkat_inquietude_modifier }
					remove_modifier = blokkat_inquietude_modifier
				}
			}
			if = {
				limit = {
					check_variable = {
						which = blokkat_inquietude_value
						value > 0
					}
				}
				every_owned_planet = {
					limit = { is_colony = yes }
					set_variable = {
						which = blokkat_inquietude_value
						value = PREV.blokkat_inquietude_value
					}
					add_modifier = {
						modifier = blokkat_inquietude_modifier
						days = -1
						multiplier = blokkat_inquietude_value
					}	
				}
			}
		}
	}
}

#"stop with your stupid engine"
country_event = {
	id = giga_blokkat.5001
	title = "giga_blokkat.5001.name"
	desc = "giga_blokkat.5001.desc"
	is_triggered_only = yes
	show_sound = event_yellow_alert

	picture = GFX_evt_supernova

	option = { #kk
		name = "giga_blokkat.5001.a"
		hidden_effect = {
			country_event = { id = giga_blokkat.5002 }
		}
	}
}

country_event = {
	id = giga_blokkat.5002
	title = "giga_blokkat.5002.name"
	desc = "giga_blokkat.5002.desc"
	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = event_target:blokkat_country.ruler
		room = blokkat3d_room
	}

	option = { #wtf rude
		name = "giga_blokkat.5002.a"
		response_text = "giga_blokkat.5002.a.response"
	}
}

#doesnt work like that lol
country_event = {
	id = giga_blokkat.50031
	title = "giga_blokkat.50031.name"
	desc = "giga_blokkat.50031.desc"
	is_triggered_only = yes
	show_sound = event_celebration

	picture = GFX_evt_supernova

	option = { #kk
		name = "giga_blokkat.50031.a"
		custom_tooltip = "giga_blokkat.50031.a.tooltip"
	}
}

#doesnt work like that lol
country_event = {
	id = giga_blokkat.5003
	title = "giga_blokkat.5003.name"
	desc = "giga_blokkat.5003.desc"
	is_triggered_only = yes
	show_sound = event_red_alert

	picture = GFX_evt_supernova

	option = { #kk
		name = "giga_blokkat.5003.a"
	}
}

country_event = {
	id = giga_blokkat.5004
	title = "giga_blokkat.5004.name"
	desc = "giga_blokkat.5004.desc"
	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = event_target:blokkat_country.ruler
		room = blokkat3d_room
	}

	option = { #wtf rude
		name = "giga_blokkat.5004.a"
		custom_tooltip = "giga_blokkat.5004.a.tooltip"
		trigger = { NOT = { has_global_flag = blokkat_inquietude_respawn_malus } }
		hidden_effect = {
			country_event = { id = giga_blokkat.5003 }
			set_global_flag = blokkat_inquietude_respawn_malus
			change_variable = {
				which = blokkat_inquietude_value
				value = 10
			}
			update_blokkat_inquietude_display = yes
		}
	}

	option = { #wtf rude
		name = "giga_blokkat.5004.b"
		custom_tooltip = "giga_blokkat.5004.b.tooltip"
		trigger = { has_global_flag = blokkat_inquietude_respawn_malus }
		hidden_effect = {
			country_event = { id = giga_blokkat.5003 }
		}
	}
}

#when they are contacted
country_event = {
	id = giga_blokkat.5010
	title = "giga_blokkat.5010.name"
	desc = {
		text = "giga_blokkat.5010.desc.a"
		trigger = { always = yes }
	}
	desc = {
		text = "giga_blokkat.5010.desc.b"
		trigger = { always = yes }
	}
	desc = {
		text = "giga_blokkat.5010.desc.c"
		trigger = { always = yes }
	}
	desc = {
		text = "giga_blokkat.5010.desc.d"
		trigger = { always = yes }
	}
	desc = {
		text = "giga_blokkat.5010.desc.e"
		trigger = { always = yes }
	}
	desc = {
		text = "giga_blokkat.5010.desc.f"
		trigger = { always = yes }
	}
	desc = {
		text = "giga_blokkat.5010.desc.g"
		trigger = { always = yes }
	}
	desc = {
		text = "giga_blokkat.5010.desc.edgy"
		trigger = { has_country_flag = blokkats_warned_about_crisis_sphere }
	}
	desc = {
		text = "giga_blokkat.5010.desc.acot1"
		trigger = { has_global_flag = acot_activated }
	}
	desc = {
		text = "giga_blokkat.5010.desc.acot2"
		trigger = { has_global_flag = acot_activated }
	}
	desc = {
		text = "giga_blokkat.5010.desc.acot3"
		trigger = { has_global_flag = acot_activated }
	}
	desc = {
		text = "giga_blokkat.5010.desc.acot4"
		trigger = { 
			has_global_flag = acot_activated
			any_owned_planet = { is_planet_class = pc_acot_pmc_vault }
		}
	}
	desc = {
		text = "giga_blokkat.5010.desc.sbtg1"
		trigger = { has_global_flag = active_sofe_crisis }
	}

	desc = {
		text = "giga_blokkat.5010.desc.mods1"
		trigger = { is_country_type = ascended_empire }
	}

	desc = {
		text = "giga_blokkat.5010.desc.mods2"
		trigger = { is_country_type = ascended_empire }
	}

	desc = {
		text = "giga_blokkat.5010.desc.mods3"
		trigger = { is_country_type = ascended_empire }
	}

	desc = {
		text = "giga_blokkat.5010.desc.mods4"
		trigger = { OR = { has_technology = nhsc_tech_arcenciel has_technology = nhsc_tech_wavemotiongun_1 has_technology = nhsc_tech_wavemotiongun_1 has_technology = nhsc_tech_wavemotiongun_3 } }
	}

	desc = {
		text = "giga_blokkat.5010.desc.mods5"
		trigger = { is_country_type = ascended_empire }
	}

	desc = {
		text = "giga_blokkat.5010.desc.mega1"
		trigger = {
			any_owned_planet = { is_planet_class = pc_birch }
		}
	}

	desc = {
		text = "giga_blokkat.5010.desc.mega2"
		trigger = {
			any_owned_planet = { 
				OR = {
					is_planet_class = pc_alderson_slice_ecu
					is_planet_class = pc_alderson_slice_machine
					is_planet_class = pc_alderson_slice_hive
					is_planet_class = pc_alderson_slice_pc
					is_planet_class = pc_alderson_slice_gaia
				}
			}
		}
	}

	desc = {
		text = "giga_blokkat.5010.desc.mega3"
		trigger = {
			any_owned_planet = { 
				OR = {
					is_planet_class = pc_alderson_slice_ecu
					is_planet_class = pc_alderson_slice_machine
					is_planet_class = pc_alderson_slice_hive
					is_planet_class = pc_alderson_slice_pc
					is_planet_class = pc_alderson_slice_gaia
				}
			}
		}
	}

	desc = {
		text = "giga_blokkat.5010.desc.crisis1"
		trigger = {
			has_global_flag = aeternum_awakening_ongoing
		}
	}

	desc = {
		text = "giga_blokkat.5010.desc.mega4"
		trigger = {
			any_owned_megastructure = { is_megastructure_type = nicoll_beam_4 }
		}
	}

	desc = {
		text = "giga_blokkat.5010.desc.mega5"
		trigger = {
			any_owned_megastructure = { is_megastructure_type = asteroid_artillery_1 }
		}
	}

	desc = {
		text = "giga_blokkat.5010.desc.crisis2"
		trigger = { any_country = { is_country_type = swarm} }
	}

	desc = {
		text = "giga_blokkat.5010.desc.crisis3"
		trigger = { any_country = { is_country_type = ai_empire } }
	}

	desc = {
		text = "giga_blokkat.5010.desc.crisis4"
		trigger = { any_country = { is_country_type = extradimensional } }
	}

	desc = {
		text = "giga_blokkat.5010.desc.crisis5"
		trigger = { any_country = { is_country_type = katzenartig_imperium } }
	}

	location = event_target:blokkat_spawn_system
	is_triggered_only = yes
	diplomatic = yes

	trigger = {
		From = { is_country_type = blokkat_stripminers }
		NOT = { has_country_flag = blokkat_diplomacy_engaged }
	}

	picture_event_data = {
		portrait = event_target:blokkat_country.ruler
		room = blokkat3d_room
	}

	immediate = { set_country_flag = blokkat_diplomacy_engaged }

	option = { #Uh oh
		name = "giga_blokkat.5010.butwhy"
		response_text = "giga_blokkat.5010.butwhy.response"
		is_dialog_only = yes
	}

	option = { #Uh oh
		name = "giga_blokkat.5010.coexist"
		response_text = "giga_blokkat.5010.coexist.response"
		trigger = {
			NOT = { has_country_flag = giga_blokk_protokols_initiated }
		}
		
		is_dialog_only = yes
	}

	option = { #Uh oh
		name = "giga_blokkat.5010.nogalaxytravel"
		response_text = "giga_blokkat.5010.nogalaxytravel.response"
		trigger = {
			NOT = { has_country_flag = giga_blokk_protokols_initiated }
		}
		
		is_dialog_only = yes
	}

	# option = { #Uh oh
	# 	name = "giga_blokkat.5010.scourge"
	# 	response_text = "giga_blokkat.5010.scourge.response"
	# 	is_dialog_only = yes
	# 	trigger = {
	# 		OR = {
	# 			any_country = { is_country_type = swarm }
	# 			any_country = { is_country_type = swarm_fleeing_blokkats }
	# 		}
	# 	}
	# }

	#PSIONICS
	option = {
		name = "giga_blokkat.5010.psionics"
		response_text = "giga_blokkat.5010.psionics.response"
		is_dialog_only = yes
		trigger = {
			owner_species = { has_trait = trait_psionic }
		}
	}

	#DEVOURING SWARM
	option = {
		name = "giga_blokkat.5010.devouringswarm"
		response_text = "giga_blokkat.5010.devouringswarm.response"
		is_dialog_only = yes
		trigger = {
			has_valid_civic = civic_hive_devouring_swarm
		}
	}

	#DETERMINED EXTERMINATOR
	option = {
		name = "giga_blokkat.5010.determinedexterminator"
		response_text = "giga_blokkat.5010.determinedexterminator.response"
		is_dialog_only = yes
		trigger = {
			has_valid_civic = civic_machine_terminator
		}
	}

	#FANATIC PURIFIER
	option = {
		name = "giga_blokkat.5010.fanaticpurifier"
		response_text = "giga_blokkat.5010.fanaticpurifier.response"
		is_dialog_only = yes
		trigger = {
			has_valid_civic = civic_fanatic_purifiers
		}
	}

	#PACIFIST
	option = {
		name = "giga_blokkat.5010.pacifist"
		response_text = "giga_blokkat.5010.pacifist.response"
		is_dialog_only = yes
		trigger = {
			NOT = { has_country_flag = giga_blokk_protokols_initiated }
			OR = {
				has_ethic = ethic_pacifist
				has_ethic = ethic_fanatic_pacifist
			}
		}
	}

	#MILITARIST
	option = {
		name = "giga_blokkat.5010.militarist"
		response_text = "giga_blokkat.5010.militarist.response"
		is_dialog_only = yes
		trigger = {
			NOT = { has_country_flag = giga_blokk_protokols_initiated }
			OR = {
				has_ethic = ethic_militarist
				has_ethic = ethic_fanatic_militarist
			}
		}
	}

	#XENOPHOBE
	option = {
		name = "giga_blokkat.5010.xenophobe"
		response_text = "giga_blokkat.5010.xenophobe.response"
		is_dialog_only = yes
		trigger = {
			NOT = { has_country_flag = giga_blokk_protokols_initiated }
			OR = {
				has_ethic = ethic_xenophobe
				has_ethic = ethic_fanatic_xenophobe
			}
		}
	}

	#XENOPHILE
	option = {
		name = "giga_blokkat.5010.xenophile"
		response_text = "giga_blokkat.5010.xenophile.response"
		is_dialog_only = yes
		trigger = {
			OR = {
				has_ethic = ethic_xenophile
				has_ethic = ethic_fanatic_xenophile
			}
		}
	}

	#EGALITARIAN
	option = {
		name = "giga_blokkat.5010.egalitarian"
		response_text = "giga_blokkat.5010.egalitarian.response"
		is_dialog_only = yes
		trigger = {
			NOT = { has_country_flag = giga_blokk_protokols_initiated }
			OR = {
				has_ethic = ethic_egalitarian
				has_ethic = ethic_fanatic_egalitarian
			}
		}
	}

	#AUTHORITARIAN
	option = {
		name = "giga_blokkat.5010.authoritarian"
		response_text = "giga_blokkat.5010.authoritarian.response"
		is_dialog_only = yes
		trigger = {
			NOT = { has_country_flag = giga_blokk_protokols_initiated }
			OR = {
				has_ethic = ethic_authoritarian
				has_ethic = ethic_fanatic_authoritarian
			}
		}
	}

	#SPIRITUALIST
	option = {
		name = "giga_blokkat.5010.spiritualist"
		response_text = "giga_blokkat.5010.spiritualist.response"
		is_dialog_only = yes
		trigger = {
			NOT = { has_country_flag = giga_blokk_protokols_initiated }
			OR = {
				has_ethic = ethic_spiritualist
				has_ethic = ethic_fanatic_spiritualist
			}
			NOT = { owner_species = { has_trait = trait_psionic } }
		}
	}

	#MATERIALIST
	option = {
		name = "giga_blokkat.5010.materialist"
		response_text = "giga_blokkat.5010.materialist.response"
		is_dialog_only = yes
		trigger = {
			OR = {
				has_ethic = ethic_materialist
				has_ethic = ethic_fanatic_materialist
			}
		}
	}

	#GRANDBUNNY
	option = {
		name = "giga_blokkat.5010.grandbunny"
		response_text = "giga_blokkat.5010.grandbunny.response"
		is_dialog_only = yes
		trigger = {
			has_country_flag = paluush_event_chain_ongoing
			has_country_flag = grand_archive_dig_done
		}
		hidden_effect = {
			if = {
				limit = { NOT = { has_global_flag = giga_told_blokkats_about_grandbunny } }
				set_global_flag = giga_told_blokkats_about_grandbunny
				event_target:blokkat_country = {
					create_leader = {
						class = scientist
						set_age = 46546
						immortal = yes
						gender = indeterminable
						skill = 8
						name = "Angry Blokkat"
						species = event_target:diverse_blokkat_species
						effect = {
							set_leader_flag = blokkat_leader_portrait
							set_leader_flag = blokkat_is_angry
							set_leader_flag = unique_blokkat_leader
							save_global_event_target_as = angry_blokkat_leader_portrait
						}
					}
					set_leader = event_target:angry_blokkat_leader_portrait
				}
			}
		}
	}

	option = { #Uh oh
		name = "giga_blokkat.5010.a"
		hidden_effect = {
			remove_country_flag = blokkat_diplomacy_engaged
		}
	}
}


#Event about them
country_event = {
	id = giga_blokkat.1008
	title = "giga_blokkat.1008.name"
	desc = "giga_blokkat.1008.desc"
	location = event_target:blokkat_spawn_system
	is_triggered_only = yes
	show_sound = event_yellow_alert
	picture = GFX_evt_fleet_evil

	immediate = {
		set_variable = {
			which = blokkat_knowledge_value #knowledge
			value = 0
		}
		set_variable = {
			which = blokkat_inquietude_value #inquietude
			value = 0
		}
		set_variable = {
			which = blokkat_scrap_value #scrap
			value = 0
		}
		set_variable = {
			which = blokkat_inquietude_research_value
			value = 0
		}
		set_variable = {
			which = blokkat_inquietude_stability_value
			value = 0
		}
		set_variable = {
			which = blokkat_inquietude_happiness_value
			value = 0
		}
		set_variable = {
			which = blokkat_scrap_research_value
			value = 0
		}
		set_variable = {
			which = blokkat_scrap_damage_value
			value = 0
		}
		set_country_flag = has_blokkat_inquietude
	}

	option = { #Uh oh
		name = "giga_blokkat.1008.a"
		begin_event_chain = {
			event_chain = "blokkat_chain"
			target = ROOT
		}
		create_point_of_interest = {
			id = blokkat_chain.1
			name = "blokkat_chain_1_title"
			desc = "blokkat_chain_1_desc"
			event_chain = blokkat_chain
			location = event_target:current_blokkat_mothership_system
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.1021 days = 180 } #BRB
			event_target:global_event_country = {
				country_event = { id = giga_blokkat.10210 days = 181 }
			}
		}
		custom_tooltip = "giga_blokkat.1008.a.tooltip"
	}
}

#When they stripmine a system
country_event = {
	id = giga_blokkat.1020
	title = "giga_blokkat.1020.name"
	desc = "giga_blokkat.1020.desc"
	location = event_target:blokkat_first_stripmined_system
	is_triggered_only = yes
	show_sound = event_red_alert
	picture = GFX_evt_vortex


	option = { #Uh oh
		name = "giga_blokkat.1020.a"
	}
}

country_event = {
	id = giga_blokkat.10210
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		set_global_flag = blokkat_bureau_fallback
		every_country = {
			limit = { is_ai = no }
			if = {
				limit = { NOT = { has_country_flag = blokkat_bureau_unlocked } }
				set_country_flag = blokkat_bureau_unlocked
			}
		}
	}
}

#Blokkat Research Bureau
country_event = {
	id = giga_blokkat.1021
	title = "giga_blokkat.1021.name"
	desc = "giga_blokkat.1021.desc"
	is_triggered_only = yes
	show_sound = event_sensor_ping
	picture = GFX_evt_physics_research

	immediate = {
		set_global_flag = blokkat_bureau_popup
		set_country_flag = blokkat_bureau_unlocked
		set_variable = {
			which = blokkat_knowledge_earned_by_general_study
			value = 0
		}
		set_variable = {
			which = blokkat_knowledge_earned_by_repeatables
			value = 0
		}
		set_variable = {
			which = blokkat_knowledge_earned_by_sacrifice
			value = 0
		}
		set_variable = {
			which = blokkat_knowledge_earned_by_system
			value = 0
		}
		set_variable = {
			which = blokkat_knowledge_earned_by_destroy
			value = 0
		}
	}

	option = { #kk
		name = "giga_blokkat.1021.a"
		custom_tooltip = "giga_blokkat.1021.a.tooltip"
		hidden_effect = {
			country_event = { id = giga_blokkat.1022 days = 30 } #Inquietude
		}
	}
}

#inquietude popup
country_event = {
	id = giga_blokkat.1022
	title = "giga_blokkat.1022.name"
	desc = {
		text = "giga_blokkat.1022.desc.normal"
		trigger = { is_gestalt = no }
	}
	desc = {
		text = "giga_blokkat.1022.desc.gestalt"
		trigger = { is_gestalt = yes }
	}
	is_triggered_only = yes
	show_sound = event_activating_unknown_technology
	picture = GFX_evt_worrying_signal

	immediate = {
		set_country_flag = blokkat_inquietude_taught
	}

	option = { #kk
		name = "giga_blokkat.1022.a"
		custom_tooltip = "giga_blokkat.1022.a.tooltip"
	}
}

#the blokkats just ate your world lmao have inquietude (wheeze)
planet_event = {
	id = giga_blokkat.1023
	title = "giga_blokkat.1023.name"
	desc = {
		text = "giga_blokkat.1023.desc"
		trigger = { exists = owner owner = { NOT = { has_country_flag = blokkat_willingness_active } } }
	}
	desc = {
		text = "giga_blokkat.1023.desc.willingness"
		trigger = { exists = owner owner = { has_country_flag = blokkat_willingness_active } }
	}
	is_triggered_only = yes
	show_sound = event_screams
	picture = GFX_evt_exploding_planet

	immediate = {
		owner = { save_event_target_as = blokkat_planet_owner }
		set_variable = {
			which = blokkat_planet_pop_count
			value = 0
		}
		every_owned_pop = {
			ROOT = {
				change_variable = {
					which = blokkat_planet_pop_count
					value = 1
				}
			}
		}
		set_variable = {
			which = blokkat_pop_inquietude
			value = blokkat_planet_pop_count
		}

		#Willingness
		set_variable = {
			which = blokkat_pop_willingness
			value = blokkat_planet_pop_count
		}

		#1 pop eaten --> 0.05 willingness so 20 pops --> -1% willingness. Simple.
		multiply_variable = { #This is how much willingness will be acquired (ungood)
			which = blokkat_pop_willingness
			value = 0.05
		}

		set_variable = { #the effects can be halved provided enough influence. Each pop adds 2 influence to the cost.
			which = blokkat_pop_willingness_halved
			value = blokkat_pop_willingness
		}
		
		multiply_variable = { #This is how much inquietude will be acquired (ungood)
			which = blokkat_pop_willingness_halved
			value = 0.5
		}

		#1 pop eaten --> 0.02 inquietude so 50 pops --> 1 inquietude. Simple.
		multiply_variable = { #This is how much inquietude will be acquired (ungood)
			which = blokkat_pop_inquietude
			value = 0.02
		}


		set_variable = { #the effects can be halved provided enough influence. Each pop adds 1 influence to the cost.
			which = blokkat_pop_influence_cost
			value = blokkat_planet_pop_count
		}
		multiply_variable = {
			which = blokkat_pop_influence_cost
			value = 1
		}
		
		event_target:blokkat_planet_owner = {
			export_resource_stockpile_to_variable = {
				resource = influence
				variable = blokkat_pop_influence_cost_country
			}
		}

		set_variable = {
			which = blokkat_pop_influence_cost_current
			value = ROOT.owner.blokkat_pop_influence_cost_country
		}

		set_variable = { #the effects can be halved provided enough influence. Each pop adds 2 influence to the cost.
			which = blokkat_pop_inquietude_halved
			value = blokkat_pop_inquietude
		}
		multiply_variable = { #This is how much inquietude will be acquired (ungood)
			which = blokkat_pop_inquietude_halved
			value = 0.5
		}
	}

	option = { #SHIT SHIT SHIT
		name = "giga_blokkat.1023.a"
		hidden_effect = {
			event_target:blokkat_planet_owner = {
				change_variable = {
					which = blokkat_inquietude_value
					value = ROOT.blokkat_pop_inquietude
				}
				update_blokkat_inquietude_display = yes
				if = {
					limit = { has_country_flag = blokkat_willingness_active }
					subtract_variable = {
						which = blokkat_willingness_government_value
						value = ROOT.blokkat_pop_willingness
					}
					subtract_variable = {
						which = blokkat_willingness_population_value
						value = ROOT.blokkat_pop_willingness
					}
					update_blokkat_willingness_value = yes
				}
			}
			ROOT = { giga_remove_planet = yes }
		}
	}

	option = { #SUPPRESS IT
		name = "giga_blokkat.1023.b"
		allow = {
			custom_tooltip = {
				fail_text = "blokkat_not_enough_influence"
				check_variable = {
					which = blokkat_pop_influence_cost_current
					value > blokkat_pop_influence_cost
				}
			}
		}
		hidden_effect = {
			event_target:blokkat_planet_owner = {
				change_variable = {
					which = blokkat_inquietude_value
					value = ROOT.blokkat_pop_inquietude_halved
				}
				set_variable = {
					which = blokkat_pop_influence_cost_active
					value = ROOT.blokkat_pop_influence_cost
				}
				add_resource = {
					influence = -1
					mult = blokkat_pop_influence_cost_active
				}
				update_blokkat_inquietude_display = yes
				if = {
					limit = { has_country_flag = blokkat_willingness_active }
					subtract_variable = {
						which = blokkat_willingness_government_value
						value = ROOT.blokkat_pop_willingness_halved
					}
					subtract_variable = {
						which = blokkat_willingness_population_value
						value = ROOT.blokkat_pop_willingness_halved
					}
					update_blokkat_willingness_value = yes
				}
			}
			ROOT = { giga_remove_planet = yes }
		}
	}
}

planet_event = {
	id = giga_blokkat.1024
	title = "giga_blokkat.1024.name"
	desc = "giga_blokkat.1024.desc"
	is_triggered_only = yes
	show_sound = event_ship_thrusters
	picture = GFX_evt_big_landing_ship

	option = { #SHIT SHIT SHIT
		name = "giga_blokkat.1024.a"
		hidden_effect = {
			every_owned_pop = {
				ROOT.owner = {
					random_owned_planet = {
						limit = {
							NOT = { has_planet_flag = blokkat_evacuation_planet_blacklisted }
							NOT = { is_planet = ROOT }
							is_colony = yes
						}
						save_event_target_as = blokkat_pop_resettle_target
					}
				}
				resettle_pop = {
					pop = THIS
					planet = event_target:blokkat_pop_resettle_target
				}
			}
			remove_planet_flag = blokkat_evacuation_ongoing
		}
	}

	option = { #SHIT SHIT SHIT
		name = "giga_blokkat.1024.b"
		hidden_effect = {
			remove_planet_flag = blokkat_evacuation_ongoing
		}
	}
}

country_event = {
	id = giga_blokkat.1025
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_edict = blokkat_combat_inquietude
		check_variable = {
			which = blokkat_inquietude_value
			value > 10
		}
	}
	
	immediate = {
		subtract_variable = {
			which = blokkat_inquietude_value
			value = 1
		}
	}
}

#country destroyed
country_event = {
	id = giga_blokkat.1026
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_country_flag = destroyed_by_blokkats
	}
	
	immediate = {
		save_global_event_target_as = country_killed_by_blokkats
		if = {
			limit = { is_country_type = default }
			every_country = {
				limit = {
					is_ai = no
					NOT = {
						is_in_federation_with = ROOT
					}
				}
				country_event = { id = giga_blokkat.1027 }
			}
		}
	}
}

#regular country destroyed
country_event = {
	id = giga_blokkat.1027
	title = "giga_blokkat.1027.name"
	desc = "giga_blokkat.1027.desc"
	is_triggered_only = yes
	show_sound = event_screams
	picture = GFX_evt_worrying_signal

	option = { #kk
		name = "giga_blokkat.1027.a"
		hidden_effect = {
			change_variable = {
				which = blokkat_inquietude_value
				value = 1
			}
		}
	}

	option = { #kk
		name = "giga_blokkat.1027.b"
		allow = {
			resource_stockpile_compare = {
				resource = influence
				value >= 50
			}
		}
		hidden_effect = {
			add_resource = { influence = -50 }
			change_variable = {
				which = blokkat_inquietude_value
				value = 0.5
			}
		}
	}
}

#Harvesters & Terminators life count
ship_event = {
	id = giga_blokkat.10310
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		OR = {
			is_ship_size = giga_blokkat_harvester
			is_ship_size = giga_blokkat_terminator
			is_ship_size = giga_blokkat_obliterator
		}
	}

	immediate = {
		if = {
			limit = {
				check_variable = {
					which = blokkat_ship_life_count
					value <= 1
				}
				is_ship_size = giga_blokkat_terminator
			}
			From.controller = {
				if = {
					limit = { exists = THIS has_country_flag = blokkat_willingness_active }
					change_variable = {
						which = blokkat_willingness_military_value
						value = 20
					}
					update_blokkat_willingness_value = yes
				}
			}
			destroy_ship = ROOT
		}
		else_if = {
			limit = {
				check_variable = {
					which = blokkat_ship_life_count
					value <= 1
				}
				is_ship_size = giga_blokkat_obliterator
			}
			destroy_ship = ROOT
		}
		else_if = {
			limit = {
				check_variable = {
					which = blokkat_ship_life_count
					value <= 1
				}
				is_ship_size = giga_blokkat_harvester
				fleet = { solar_system = { NOT = { any_system_ambient_object = { has_ambient_object_flag = blokkat_star_collapse } } } }
			}
			save_event_target_as = recently_destroyed_blokkat_harvester
			From.controller = {
				country_event = { id = giga_blokkat.1040 }
			}
		}
		if = {
			limit = {
				check_variable = {
					which = blokkat_ship_life_count
					value > 1
				}
				fleet = { solar_system = { NOT = { any_system_ambient_object = { has_ambient_object_flag = blokkat_star_collapse } } } }
			}
			subtract_variable = {
				which = blokkat_ship_life_count
				value = 1
			}
			repair_ship = yes
			set_disabled = no
		}
		if = {
			limit = { fleet = { solar_system = { any_system_ambient_object = { has_ambient_object_flag = blokkat_star_collapse } } } }
			repair_ship = yes
			set_disabled = no
		}
	}
}

###MOTHERSHIP FALLS###
ship_event = {
	id = giga_blokkat.10302
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_global_flag = blokkat_crisis_ongoing
		has_global_flag = blokkat_mothership_shield_down
		is_ship_size = giga_blokkat_mothership
		event_target:blokkat_country = {
			check_variable = {
				which = blokkat_mothership_life_count
				value > 1
			}
		}
	}

	immediate = {
		repair_ship = yes
		set_disabled = no
		event_target:blokkat_country = {
			subtract_variable = {
				which = blokkat_mothership_life_count
				value = 1
			}
		}
	}
}


ship_event = {
	id = giga_blokkat.10303
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_global_flag = blokkat_crisis_ongoing
		has_global_flag = blokkat_mothership_shield_down
		is_ship_size = giga_blokkat_mothership
		event_target:blokkat_country = {
			check_variable = {
				which = blokkat_mothership_life_count
				value = 1
			}
		}
	}

	immediate = {
		ROOT.solar_system = {
			create_ambient_object = {
				type = "star_explosion"
				play_animation_once = yes
				location = ROOT
			}
		}
		destroy_ship = ROOT
		FROM.controller = {
			country_event = { id = giga_blokkat.1030 }
		}
	}
}

ship_event = {
	id = giga_blokkat.10304
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_global_flag = blokkat_crisis_ongoing
		NOT = { has_global_flag = blokkat_mothership_shield_down }
		is_ship_size = giga_blokkat_mothership
	}

	immediate = {
		repair_ship = yes
		set_disabled = no
	}
}


country_event = {
	id = giga_blokkat.1030
	title = "giga_blokkat.1030.name"
	desc = "giga_blokkat.1030.desc"
	location = event_target:current_blokkat_mothership_system
	is_triggered_only = yes
	show_sound = event_super_explosion
	picture = GFX_evt_supernova

	immediate = {
		set_global_flag = blokkat_mothership_killed_legit
		remove_global_flag = sbtg_blokkat_light_block
		save_global_event_target_as = blokkat_vanquisher
		remove_global_flag = blokkat_crisis_ongoing
		set_global_flag = blokkat_crisis_defeated
		event_target:blokkat_country = {
			every_owned_fleet = { destroy_fleet = THIS }
			every_owned_megastructure = { remove_megastructure = THIS }
			set_country_type = blokkat_stripminers_defeated #They're still there but no contact list
			country_event = { id = giga_blokkat.5000 days = 30 }
		}
		every_system = {
			limit = { has_star_flag = blokkat_system_being_stripmined }
			remove_star_flag = blokkat_system_being_stripmined
		}
		every_country = {
			limit = {
				any_owned_megastructure = {
					OR = {
						is_megastructure_type = blokkat_shield_killer_activate
						is_megastructure_type = blokkat_shield_killer_activate_chrono
						is_megastructure_type = blokkat_shield_killer_3
						is_megastructure_type = blokkat_shield_killer_4
					}
				}
			}
			country_event = { id = giga_blokkat.1032 days = 60 }
		}
		every_country = {
			limit = {
				any_owned_megastructure = {
					OR = {
						is_megastructure_type = blokkat_shield_killer_0
						is_megastructure_type = blokkat_shield_killer_1
						is_megastructure_type = blokkat_shield_killer_2
					}
				}
			}
			country_event = { id = giga_blokkat.1033 days = 60 }
		}
	}

	option = { #YAY
		name = "giga_blokkat.1030.a"
		add_monthly_resource_mult = {
			resource = unity
			value = 120
		}
		add_resource = {
			influence = 1000
		}
		hidden_effect = {
			every_galaxy_planet = {
				limit = { has_modifier = blokkat_inquietude_modifier }
				remove_modifier = blokkat_inquietude_modifier
			}
			every_country = {
				country_event = { id = giga_blokkat.1031 } #they dead
			}
		}
	}
}

country_event = {
	id = giga_blokkat.1031
	title = "giga_blokkat.1031.name"
	desc = "giga_blokkat.1031.desc"
	location = event_target:current_blokkat_mothership_system
	is_triggered_only = yes
	show_sound = event_celebration
	picture = GFX_evt_crisis_defeated

	option = { #YAY
		name = "giga_blokkat.1031.a"
		custom_tooltip = "giga_blokkat.1031.tooltip"
		add_monthly_resource_mult = {
			resource = unity
			value = 12
		}
		if = {
			limit = { has_event_chain = blokkat_chain }
			end_event_chain = blokkat_chain
		}
		hidden_effect = {
			set_variable = {
				which = blokkat_inquietude_value
				value = 0
			}
			update_blokkat_inquietude_display = yes
			remove_country_flag = blokkat_inquietude_taught
			if = {
				limit = {
					NOT = { has_global_flag = giga_achievements_disabled }
					NOT = {
						has_country_flag = giga_achievement_blokkats1
					}
					OR = {
						has_global_flag = giga_blokkats_easy
						has_global_flag = giga_blokkats_very_easy
					}
				}
				set_country_flag = giga_achievement_blokkats1
				set_timed_country_flag = { flag = giga_achievement_blokkats1_notification days = 30 }
				giga_achievement_sound = yes
			}
			if = {
				limit = {
					NOT = { has_global_flag = giga_achievements_disabled }
					NOT = {
						has_country_flag = giga_achievement_blokkats2
					}
					has_global_flag = giga_blokkats_normal
				}
				set_country_flag = giga_achievement_blokkats1
				set_country_flag = giga_achievement_blokkats2
				set_timed_country_flag = { flag = giga_achievement_blokkats2_notification days = 30 }
				giga_achievement_sound = yes
			}
			if = {
				limit = {
					NOT = { has_global_flag = giga_achievements_disabled }
					NOT = {
						has_country_flag = giga_achievement_blokkats3
					}
					has_global_flag = giga_blokkats_bismuth
				}
				set_country_flag = giga_achievement_blokkats1
				set_country_flag = giga_achievement_blokkats2
				set_country_flag = giga_achievement_blokkats3
				set_timed_country_flag = { flag = giga_achievement_blokkats3_notification days = 30 }
				giga_achievement_sound = yes
			}
			if = {
				limit = {
					NOT = { has_global_flag = giga_achievements_disabled }
					NOT = {
						has_country_flag = giga_achievement_blokkats4
					}
					OR = {
						has_global_flag = giga_blokkats_endtech
						has_global_flag = giga_blokkats_deathmode
					}
				}
				set_country_flag = giga_achievement_blokkats1
				set_country_flag = giga_achievement_blokkats2
				set_country_flag = giga_achievement_blokkats3
				set_country_flag = giga_achievement_blokkats4
				set_timed_country_flag = { flag = giga_achievement_blokkats4_notification days = 30 }
				giga_achievement_sound = yes
			}
			if = {
				limit = {
					NOT = { has_global_flag = giga_achievements_disabled }
					NOR = { 
						has_country_flag = giga_blokkat_inquietude_above_10
						has_country_flag = giga_achievement_blokkats7
					}
				}
				set_country_flag = giga_achievement_blokkats7
				set_timed_country_flag = { flag = giga_achievement_blokkats7_notification days = 30 }
				giga_achievement_sound = yes
			}
		}
	}
}

country_event = {
	id = giga_blokkat.1032
	title = "giga_blokkat.1032.name"
	desc = "giga_blokkat.1032.desc"
	is_triggered_only = yes
	show_sound = event_machinery
	picture = GFX_evt_megastructure_construction

	immediate = {
		country_event = { id = giga_blokkat.1034 days = 30} #CHANGE
	}

	option = { #make energy/research
		name = "giga_blokkat.1032.a"
		custom_tooltip = "giga_blokkat.1032.a.tooltip"
		hidden_effect = {
			every_owned_megastructure = {
				limit = {
					OR = {
						is_megastructure_type = blokkat_shield_killer_activate
						is_megastructure_type = blokkat_shield_killer_activate_chrono
						is_megastructure_type = blokkat_shield_killer_3
						is_megastructure_type = blokkat_shield_killer_4
					}
				}
				solar_system = {
					spawn_megastructure = {
						type = blokkat_shield_killer_energy
						planet = THIS.star
						owner = space_owner
					}
				}
				remove_megastructure = THIS
			}
		}
	}

	option = { #make unity/influence
		name = "giga_blokkat.1032.b"
		custom_tooltip = "giga_blokkat.1032.b.tooltip"
		hidden_effect = {
			every_owned_megastructure = {
				limit = {
					OR = {
						is_megastructure_type = blokkat_shield_killer_activate
						is_megastructure_type = blokkat_shield_killer_activate_chrono
						is_megastructure_type = blokkat_shield_killer_3
						is_megastructure_type = blokkat_shield_killer_4
					}
				}
				solar_system = {
					spawn_megastructure = {
						type = blokkat_shield_killer_influence
						planet = THIS.star
						owner = space_owner
					}
				}
				remove_megastructure = THIS
			}
		}
	}
}


country_event = {
	id = giga_blokkat.1033
	title = "giga_blokkat.1033.name"
	desc = "giga_blokkat.1033.desc"
	is_triggered_only = yes
	show_sound = event_machinery
	picture = GFX_evt_megastructure_construction

	option = {
		name = "giga_blokkat.1033.a"
		custom_tooltip = "giga_blokkat.1033.a.tooltip"
		if = {
			limit = { any_owned_megastructure = { is_megastructure_type = blokkat_shield_killer_0 } }
			add_resource = {
				alloys = 50000
			}
		}
		if = {
			limit = { any_owned_megastructure = { is_megastructure_type = blokkat_shield_killer_1 } }
			add_resource = {
				alloys = 200000
			}
		}
		if = {
			limit = { any_owned_megastructure = { is_megastructure_type = blokkat_shield_killer_2 } }
			add_resource = {
				alloys = 600000
			}
		}
		hidden_effect = {
			every_owned_megastructure = {
				limit = {
					OR = {
						is_megastructure_type = blokkat_shield_killer_0
						is_megastructure_type = blokkat_shield_killer_1
						is_megastructure_type = blokkat_shield_killer_2
					}
				}
				remove_megastructure = THIS
				solar_system = {
					star = {
						giga_clear_has_mega_flag = yes
					}
				}
			}
		}
	}
}


country_event = {
	id = giga_blokkat.1034
	title = "giga_blokkat.1034.name"
	desc = "giga_blokkat.1034.desc"
	is_triggered_only = yes
	show_sound = event_mystic_reveal_light
	picture = GFX_evt_surreal_visions

	immediate = {
		set_country_flag = giga_knows_about_destabilizer_scrap
	}

	option = {
		name = "giga_blokkat.1034.a"
		custom_tooltip = "giga_blokkat.1034.a.tooltip"
	}
}

country_event = {
	id = giga_blokkat.1035
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_country_flag = giga_knows_about_destabilizer_scrap
		any_owned_megastructure = {
			OR = {
				is_megastructure_type = blokkat_shield_killer_3
				is_megastructure_type = blokkat_shield_killer_4
				is_megastructure_type = blokkat_shield_killer_energy
				is_megastructure_type = blokkat_shield_killer_influence
			}
		}
	}

	immediate = {
		change_variable = {
			which = blokkat_scrap_value
			value = 10
		}
	}
}

#Dismantler down
country_event = {
	id = giga_blokkat.1040
	title = "giga_blokkat.1040.name"
	desc = {
		text = "giga_blokkat.1040.desc.a"
		trigger = {
			check_variable = {
				which = blokkat_knowledge_earned_by_destroy
				value < 9
			}
		}
	}
	desc = {
		text = "giga_blokkat.1040.desc.b"
		trigger = {
			OR = {
				NOT = {
					has_country_flag = blokkat_shield_researched
				}
				check_variable = {
					which = blokkat_knowledge_earned_by_destroy
					value >= 9
				}
			}
		}
	}
	location = event_target:recently_destroyed_blokkat_harvester.solar_system
	is_triggered_only = yes
	show_sound = event_structural_collapse
	picture = GFX_evt_large_explosion

	immediate = {
		subtract_variable = {
			which = blokkat_inquietude_value
			value = 3
		}
		if = {
			limit = { check_variable = { which = blokkat_inquietude_value value < 0 } }
			set_variable = { which = blokkat_inquietude_value value = 0 }
		}
		update_blokkat_inquietude_display = yes
		save_global_event_target_as = destroyed_blokkat_dismantler_destroyer
		event_target:recently_destroyed_blokkat_harvester.solar_system = {
			create_ambient_object = {
				type = "blokkat_dismantler_death_explosion_effect"
				play_animation_once = yes
				location = event_target:recently_destroyed_blokkat_harvester
			}
			last_created_ambient_object = {
				set_location = {
					target = event_target:recently_destroyed_blokkat_harvester
					distance = 0
					angle = random
				}
			}
			save_global_event_target_as = destroyed_blokkat_dismantler_location
			remove_star_flag = blokkat_system_being_stripmined
			every_system_megastructure = {
				limit = { is_megastructure_type = blokkat_harvester_charging_up }
				remove_megastructure = THIS
			}
		}
		every_country = {
			limit = {
				NOT = { is_country = ROOT }
			}
			country_event = { id = giga_blokkat.1041 }
		}
		destroy_ship = event_target:recently_destroyed_blokkat_harvester
		if = {
			limit = { has_country_flag = blokkat_willingness_active }
			change_variable = {
				which = blokkat_willingness_military_value
				value = 10
			}
			update_blokkat_willingness_value = yes
		}
	}

	option = { #YAY
		name = "giga_blokkat.1040.a"
		custom_tooltip = "giga_blokkat.1040.a.tooltip"
		add_monthly_resource_mult = {
			resource = unity
			value = 6
		}
		add_resource = {
			influence = 100
			alloys = 50000
		}
		trigger = {
			has_country_flag = blokkat_shield_researched
			check_variable = {
				which = blokkat_knowledge_earned_by_destroy
				value < 9
			}
		}
		hidden_effect = {
			change_variable = {
				which = blokkat_knowledge_earned_by_destroy
				value = 3
			}
			change_variable = {
				which = blokkat_knowledge_value
				value = 3
			}
			if = {
				limit = {
					check_variable = {
						which = blokkat_knowledge_earned_by_destroy
						value >= 9
					}
				}
				set_country_flag = blokkat_ship_sent_to_destroy
			}
		}
	}

	option = { #YAY
		name = "giga_blokkat.1040.b"
		custom_tooltip = "giga_blokkat.1040.b.tooltip"
		add_monthly_resource_mult = {
			resource = unity
			value = 6
		}
		add_resource = {
			influence = 100
			alloys = 50000
		}
		trigger = {
			OR = {
				NOT = { has_country_flag = blokkat_shield_researched }
				check_variable = {
					which = blokkat_knowledge_earned_by_destroy
					value >= 9
				}
			}
		}
	}
}

#Dismantler down (broadcast)
country_event = {
	id = giga_blokkat.1041
	title = "giga_blokkat.1041.name"
	desc = "giga_blokkat.1041.desc"
	

	location = event_target:destroyed_blokkat_dismantler_location
	is_triggered_only = yes
	show_sound = event_structural_collapse
	picture = GFX_evt_large_explosion

	option = { #YAY
		name = "giga_blokkat.1041.a"
		custom_tooltip = "giga_blokkat.1041.a.tooltip"
		hidden_effect = {
			subtract_variable = {
				which = blokkat_inquietude_value
				value = 1.5
			}
			if = {
				limit = { check_variable = { which = blokkat_inquietude_value value < 0 } }
				set_variable = { which = blokkat_inquietude_value value = 0 }
			}
			update_blokkat_inquietude_display = yes
		}
	}
}

#Dismantler rebuild (broadcast)
country_event = {
	id = giga_blokkat.1044
	title = "giga_blokkat.1044.name"
	desc = "giga_blokkat.1044.desc"
	is_triggered_only = yes

	
	show_sound = event_machinery
	picture = GFX_evt_ship_travel

	option = { #YAY
		name = "giga_blokkat.1044.a"
	}
}


country_event = {
	id = giga_blokkat.1042
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		From = { is_country_type = blokkat_stripminers }
	}

	immediate = {
		every_country = {
			limit = { has_event_chain = blokkat_chain }
			add_event_chain_counter = {
				event_chain = blokkat_chain
				counter = ships_lost_to_blokkats
				amount = 1
			}
		}
		if = {
			limit = { ROOT = { has_country_flag = blokkat_willingness_active } }
			if = {
				limit = { FromFrom = { is_ship_size = giga_massive_planet } }
				ROOT = {
					subtract_variable = {
						which = blokkat_willingness_military_value
						value = 0.1
					}
					update_blokkat_willingness_value = yes
				}
			}
			if = {
				limit = { 
					FromFrom = { 
						OR = { 
							is_ship_size = giga_planet_behemoth
							is_ship_size = giga_aeternum_planetcraft
						}
					 }
				}
				ROOT = {
					subtract_variable = {
						which = blokkat_willingness_military_value
						value = 0.5
					}
					update_blokkat_willingness_value = yes
				}
			}
			if = {
				limit = { FromFrom = { is_ship_size = giga_systemcraft } }
				ROOT = {
					subtract_variable = {
						which = blokkat_willingness_military_value
						value = 2
					}
					update_blokkat_willingness_value = yes
				}
			}
			if = {
				limit = { FromFrom = { is_ship_size = precursor_colossus } }
				ROOT = {
					subtract_variable = {
						which = blokkat_willingness_military_value
						value = 5
					}
					update_blokkat_willingness_value = yes
				}
			}
		}
	}
}

#ship sacrificed
country_event = {
	id = giga_blokkat.1043
	title = "giga_blokkat.1043.name"
	desc = "giga_blokkat.1043.desc"
	is_triggered_only = yes
	show_sound = event_mystic_reveal
	picture = GFX_evt_supernova

	trigger = {
		NOT = { has_country_flag = blokkat_ship_sacrificed }
	}

	immediate = {
		set_country_flag = blokkat_ship_sacrificed
	}

	option = { #YAY
		name = "giga_blokkat.1043.a"
		custom_tooltip = "giga_blokkat.1043.a.tooltip"
		add_monthly_resource_mult = {
			resource = unity
			value = 6
		}
		add_resource = {
			influence = 50
		}
		hidden_effect = {
			change_variable = {
				which = blokkat_knowledge_value
				value = 3
			}
			change_variable = {
				which = blokkat_knowledge_earned_by_sacrifice
				value = 3
			}
		}
	}
}

#Achievements
country_event = {
	id = giga_blokkat.3400
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_ai = no
		OR = {
			any_country = { is_country_type = blokkat_stripminers }
			any_country = { is_country_type = blokkat_stripminers_defeated }
		}
	}

	immediate = {
		if = {
			limit = {
				check_variable = {
					which = blokkat_inquietude_value
					value >= 10
				}
				NOT = { has_global_flag = giga_achievements_disabled }
				NOT = { has_country_flag = giga_blokkat_inquietude_above_10 }
			}
			set_country_flag = giga_blokkat_inquietude_above_10
		}
		if = {
			limit = {
				NOT = { has_global_flag = giga_achievements_disabled }
				NOT = {
					has_country_flag = giga_achievement_blokkats5
				}
				check_variable = {
					which = blokkat_knowledge_value
					value >= 60
				}
			}
			set_country_flag = giga_achievement_blokkats5
			set_timed_country_flag = { flag = giga_achievement_blokkats5_notification days = 30 }
			giga_achievement_sound = yes
		}
		if = {
			limit = {
				NOT = { has_global_flag = giga_achievements_disabled }
				NOT = {
					has_country_flag = giga_achievement_blokkats6
				}
				check_variable = {
					which = captured_blokkat_count
					value >= 10
				}
			}
			set_country_flag = giga_achievement_blokkats6
			set_timed_country_flag = { flag = giga_achievement_blokkats6_notification days = 30 }
			giga_achievement_sound = yes
		}
		if = {
			limit = {
				NOT = { has_global_flag = giga_achievements_disabled }
				NOT = {
					has_country_flag = giga_achievement_blokkats8
				}
				has_technology = giga_tech_blokkat_afterburner
				has_technology = giga_tech_blokkat_laser
				has_technology = giga_tech_blokkat_plasma
				has_technology = giga_tech_blokkat_hullrepair
				has_technology = giga_tech_blokkat_strikecraft
				has_technology = giga_tech_blokkat_reactor
				has_technology = giga_tech_blokkat_shield
				has_technology = giga_tech_blokkat_sensors
				has_technology = giga_tech_blokkat_armor
				has_technology = giga_tech_blokkat_emitter
				has_technology = giga_tech_blokkat_obliterator
				has_technology = giga_tech_blokkat_missile
				has_technology = giga_tech_blokkat_computer
				has_technology = giga_tech_blokkat_pd
				has_technology = giga_tech_blokkat_ftl
				has_technology = giga_tech_blokkat_booster
			}
			set_country_flag = giga_achievement_blokkats8
			set_timed_country_flag = { flag = giga_achievement_blokkats8_notification days = 30 }
			giga_achievement_sound = yes
		}
	}
}

#Terminator enters system and deletes it
country_event = {
	id = giga_blokkat.3500
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		FromFrom = {
			is_ship_size = giga_blokkat_terminator
			solar_system = {
				NOT = { any_ship_in_system = { controller = { NOT = { is_country = event_target:blokkat_country } } } }
				any_system_planet = { is_colony = yes }
			}
		}
	}

	immediate = {
		FromFrom = {
			solar_system = {
				create_ambient_object = {
					type = blokk_terminator_explosion_object
					location = ROOT.fromfrom
					duration = 10
					use_3d_location = yes
					entity_offset = 0
					scale = 1
				}
				every_system_planet = {
					limit = {
						is_colony = yes
						NOR = {
							has_planet_flag = paluushia
							has_planet_flag = gigaflusion
							is_planet_class = pc_birch 
						}
					}
					destroy_colony = yes
					if = {
						limit = { giga_habitable_structure = no }
						change_pc = pc_shattered
					}
					else = { giga_remove_planet = yes }
				}
			}
		}
	}
}

fleet_event = {
	id = giga_blokkat.3501
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_ship_size = giga_blokkat_terminator
		solar_system = {
			solar_system = {
				NOT = { any_ship_in_system = { controller = { is_hostile_to = event_target:blokkat_country } } } 
				any_system_planet = { is_colony = yes }
			}
		}
	}

	immediate = {
		solar_system = {
			create_ambient_object = {
				type = blokk_terminator_explosion_object
				location = ROOT.fromfrom
				duration = 10
				use_3d_location = yes
				entity_offset = 0
				scale = 1
			}
			every_system_planet = {
				limit = {
					is_colony = yes
					NOR = {
						has_planet_flag = paluushia
						has_planet_flag = gigaflusion
						is_planet_class = pc_birch 
					}
				}
				destroy_colony = yes
				if = {
					limit = { giga_habitable_structure = no }
					change_pc = pc_shattered
				}
				else = { giga_remove_planet = yes }
			}
		}
	}
}

###THE BLOKKAT RESEARCH BUREAU###
country_event = {
	id = giga_blokkat.3000
	title = "giga_blokkat.3000.name"

	desc = {
		text = "giga_blokkat.3000.desc.a"
		trigger = {
			always = yes
		}
	}

	is_triggered_only = yes

	diplomatic = yes

	custom_gui = blokkat_bureau_window

	picture_event_data = {
		portrait = ROOT.species
		room = blokkat_monitor_room
	}

	immediate = {
		set_country_flag = monitoring_blokkats
		ROOT = { save_global_event_target_as = country_checking_blokkat_country }
	}

	option = { #bye
		name = "giga_blokkat.3000.bye"
		custom_gui = blokkat_bureau_option_leave
		default_hide_option = yes
		hidden_effect = {
			remove_country_flag = monitoring_blokkats 
		}
	}

	option = { #general study
		name = "giga_blokkat.3000.generalstudy"
		custom_tooltip = "giga_blokkat.3000.generalstudy.tooltip"
		custom_gui = blokkat_bureau_option_clickless
		hidden_effect = {
			country_event = { id = giga_blokkat.3000 }
			remove_country_flag = monitoring_blokkats
		}
		allow = {
			custom_tooltip = {
				fail_text = "blokkats_are_already_gone"
				hidden_trigger = {
					NOT = { has_global_flag = blokkat_crisis_defeated }
				}
			}
		}
	}

	option = { #repeatables
		name = "giga_blokkat.3000.repeatables"
		custom_tooltip = "giga_blokkat.3000.repeatables.tooltip"
		custom_gui = blokkat_bureau_option_clickless_1
		hidden_effect = {
			country_event = { id = giga_blokkat.3000 }
			remove_country_flag = monitoring_blokkats
		}
		allow = {
			custom_tooltip = {
				fail_text = "blokkats_are_already_gone"
				hidden_trigger = {
					NOT = { has_global_flag = blokkat_crisis_defeated }
				}
			}
		}
		trigger = { has_country_flag = blokkat_shield_researched }
	}

	option = { #sacrifice ship
		name = "giga_blokkat.3000.sacrifice"
		custom_tooltip = "giga_blokkat.3000.sacrifice.tooltip"
		custom_gui = blokkat_bureau_option_clickless_2
		hidden_effect = {
			country_event = { id = giga_blokkat.3000 }
			remove_country_flag = monitoring_blokkats
		}
		trigger = { has_country_flag = blokkat_shield_researched }
		allow = {
			custom_tooltip = {
				fail_text = "blokkat_task_already_done"
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_ship_sacrificed }
				}
			}
			custom_tooltip = {
				fail_text = "blokkats_are_already_gone"
				hidden_trigger = {
					NOT = { has_global_flag = blokkat_crisis_defeated }
				}
			}
		}
	}

	option = { #go to system
		name = "giga_blokkat.3000.system"
		custom_tooltip = "giga_blokkat.3000.system.tooltip"
		custom_gui = blokkat_bureau_option_clickless_3
		hidden_effect = {
			country_event = { id = giga_blokkat.3000 }
			remove_country_flag = monitoring_blokkats
		}
		trigger = { has_country_flag = blokkat_shield_researched }
		allow = {
			custom_tooltip = {
				fail_text = "blokkat_task_already_done"
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_ship_sent_to_system }
				}
			}
			custom_tooltip = {
				fail_text = "blokkats_are_already_gone"
				hidden_trigger = {
					NOT = { has_global_flag = blokkat_crisis_defeated }
				}
			}
		}
	}

	option = { #blow up dismantlers
		name = "giga_blokkat.3000.destroy"
		custom_tooltip = "giga_blokkat.3000.destroy.tooltip"
		custom_gui = blokkat_bureau_option_clickless_4
		hidden_effect = {
			country_event = { id = giga_blokkat.3000 }
			remove_country_flag = monitoring_blokkats
		}
		trigger = { has_country_flag = blokkat_shield_researched }
		allow = {
			custom_tooltip = {
				fail_text = "blokkat_task_already_done"
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_ship_sent_to_destroy }
				}
			}
			custom_tooltip = {
				fail_text = "blokkats_are_already_gone"
				hidden_trigger = {
					NOT = { has_global_flag = blokkat_crisis_defeated }
				}
			}
		}
	}

	option = { #capture blokkats
		name = "giga_blokkat.3000.capture"
		custom_tooltip = "giga_blokkat.3000.capture.tooltip"
		custom_gui = blokkat_bureau_option_clickless_5
		hidden_effect = {
			country_event = { id = giga_blokkat.3000 }
			remove_country_flag = monitoring_blokkats
		}
		trigger = { has_country_flag = 	blokkat_capture_project_researched }
	}

	option = { #do paluushia stuff
		name = "giga_blokkat.3000.paluushia"
		custom_tooltip = "giga_blokkat.3000.paluushia.tooltip"
		custom_gui = blokkat_bureau_option_clickless_6
		hidden_effect = {
			country_event = { id = giga_blokkat.3000 }
			remove_country_flag = monitoring_blokkats
		}
		trigger = { has_country_flag = paluush_event_chain_ongoing }
	}

	option = { #scrap count
		name = "giga_blokkat.3000.scrap"
		custom_gui = blokkat_bureau_option_scrap
		trigger = { has_country_flag = blokkat_scrap_popup }
		allow = {
			always = no
		}
	}

	option = { #knowledge count
		name = "giga_blokkat.3000.knowledge"
		custom_gui = blokkat_bureau_option_knowledge
		allow = {
			always = no
		}
	}

	option = { #inquietude count
		name = "giga_blokkat.3000.inquietude"
		custom_gui = blokkat_bureau_option_inquietude
		trigger = { has_country_flag = blokkat_inquietude_taught }
		allow = {
			always = no
		}
	}

	option = { #inquietude modifiers
		name = "blokkat_inquietude_tracker"
		custom_gui = blokkat_bureau_option_inquietude_modifiers
		trigger = { has_country_flag = blokkat_inquietude_taught }
		allow = {
			always = no
		}
	}

	option = { #inquietude modifiers 2
		name = "blokkat_inquietude_tracker_2"
		custom_gui = blokkat_bureau_option_inquietude_modifiers_2
		trigger = { has_country_flag = blokkat_inquietude_taught }
		allow = {
			always = no
		}
	}

	option = { #scrap: research boost
		name = "giga_blokkat.3000.scrapresearch"
		custom_tooltip = "giga_blokkat.3000.scrapresearch.tooltip"
		custom_gui = blokkat_bureau_option_scrap_research
		trigger = { has_country_flag = blokkat_scrap_popup }
		allow = {
			fail_text = {
				text = "must_finish_blokkat_scrap_research_first"
				has_country_flag = researched_blokkat_scrap
			}
			custom_tooltip = {
				fail_text = "needs_enough_blokkat_scrap"
				hidden_trigger = {
					check_variable = {
						which = blokkat_scrap_value
						value >= 50
					}
				}
			}
			fail_text = {
				text = "already_researching_blokkat_scrap"
				NOT = { has_country_flag = researching_blokkat_scrap_research }
			}
		}
		hidden_effect = {
			set_country_flag = researching_blokkat_scrap_research
			country_event = { id = giga_blokkat.3000 }
			subtract_variable = {
				which = blokkat_scrap_value
				value = 50
			}
		}
	}

	option = { #scrap: damage tech
		name = "giga_blokkat.3000.scrapdamage"
		custom_tooltip = "giga_blokkat.3000.scrapdamage.tooltip"
		custom_gui = blokkat_bureau_option_scrap_damage
		trigger = { has_country_flag = blokkat_scrap_popup }
		allow = {
			fail_text = {
				text = "must_finish_blokkat_scrap_research_first"
				has_country_flag = researched_blokkat_scrap
			}
			custom_tooltip = {
				fail_text = "needs_enough_blokkat_scrap"
				hidden_trigger = {
					check_variable = {
						which = blokkat_scrap_value
						value >= 50
					}
				}
			}
			fail_text = {
				text = "already_researching_blokkat_scrap"
				NOT = { has_country_flag = researching_blokkat_scrap_damage }
			}
		}
		hidden_effect = {
			set_country_flag = researching_blokkat_scrap_damage
			country_event = { id = giga_blokkat.3000 }
			subtract_variable = {
				which = blokkat_scrap_value
				value = 50
			}
		}
	}

	option = { #scrap research boost count
		name = "blokkat_scrap_research_boost"
		custom_gui = blokkat_bureau_option_scrap_research_boost
		trigger = { has_country_flag = blokkat_scrap_popup }
		allow = {
			always = no
		}
	}

	option = { #scrap damage boost count
		name = "blokkat_scrap_damage_boost"
		custom_gui = blokkat_bureau_option_scrap_damage_boost
		trigger = { has_country_flag = blokkat_scrap_popup }
		allow = {
			always = no
		}
	}


	option = { #scrap: research boost temporary
		name = "giga_blokkat.3000.scrapresearchtemp"
		custom_tooltip = "giga_blokkat.3000.scrapresearchtemp.tooltip"
		custom_gui = blokkat_bureau_option_scrap_research_temp
		trigger = { has_country_flag = blokkat_scrap_popup }
		allow = {
			fail_text = {
				text = "blokkat_can_only_do_every_year"
				NOT = { has_country_flag = recently_buffed_blokkat_research }
			}
			fail_text = {
				text = "must_finish_blokkat_scrap_research_first"
				has_country_flag = researched_blokkat_scrap
			}
			custom_tooltip = {
				fail_text = "needs_enough_blokkat_scrap"
				hidden_trigger = {
					check_variable = {
						which = blokkat_scrap_value
						value >= 40
					}
				}
			}
			NOT = { has_modifier = blokkat_scrap_research_buff }
		}
		add_modifier = {
			modifier = blokkat_scrap_research_buff
			days = 180
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3000 }
			country_event = { id = giga_blokkat.3084 days = 180 }
			set_timed_country_flag = {
				flag = recently_buffed_blokkat_research
				days = 360
			}
			subtract_variable = {
				which = blokkat_scrap_value
				value = 40
			}
			change_variable = {
				which = blokkat_scrap_research_value
				value = 100
			}
		}
	}

	option = { #scrap: damage tech temporary
		name = "giga_blokkat.3000.scrapdamagetemp"
		custom_tooltip = "giga_blokkat.3000.scrapdamagetemp.tooltip"
		custom_gui = blokkat_bureau_option_scrap_damage_temp
		trigger = { has_country_flag = blokkat_scrap_popup }
		allow = {
			fail_text = {
				text = "blokkat_can_only_do_every_year"
				NOT = { has_country_flag = recently_buffed_blokkat_damage }
			}
			fail_text = {
				text = "must_finish_blokkat_scrap_research_first"
				has_country_flag = researched_blokkat_scrap
			}
			custom_tooltip = {
				fail_text = "needs_enough_blokkat_scrap"
				hidden_trigger = {
					check_variable = {
						which = blokkat_scrap_value
						value >= 40
					}
				}
			}
			NOT = { has_modifier = blokkat_scrap_damage_buff }
		}
		add_modifier = {
			modifier = blokkat_scrap_damage_buff
			days = 180
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3000 }
			country_event = { id = giga_blokkat.3085 days = 180 }
			set_timed_country_flag = {
				flag = recently_buffed_blokkat_damage
				days = 360
			}
			subtract_variable = {
				which = blokkat_scrap_value
				value = 40
			}
			change_variable = {
				which = blokkat_scrap_damage_value
				value = 75
			}
		}
	}

	option = { #talk to big bunny
		name = "giga_blokkat.3000.talkgrandbunny"
		custom_tooltip = "giga_blokkat.3000.talkgrandbunny.tooltip"
		custom_gui = blokkat_bureau_option_paluushia
		allow = {
			fail_text = {
				text = "already_talking_to_grandbunny"
				NOT = { has_country_flag = talking_to_grandbunny }
			}
		}
		trigger = {
			has_country_flag = established_contact_with_grandbunny
		}
		hidden_effect = {
			set_country_flag = talking_to_grandbunny
			if = {
				limit = { has_country_flag = grand_archive_dig_done }
				country_event = { id = giga_blokkat.3331 }
			}
			else_if = {
				limit = { has_country_flag = grand_archive_dig_ongoing }
				country_event = { id = giga_blokkat.3312 }
			}
			else_if = {
				limit = { has_country_flag = grandbunny_waiting_for_answer }
				country_event = { id = giga_blokkat.3310 }
			}
		}
	}

	option = { #increase inquietude
		name = "giga_blokkat.3000.upinquietude"
		custom_tooltip = "giga_blokkat.3000.upinquietude.tooltip"
		custom_gui = blokkat_bureau_option_inquietude_up
		trigger = { has_country_flag = blokkat_inquietude_taught }
		allow = { 
			resource_stockpile_compare = { resource = influence value >= 100 }
			custom_tooltip = {
				fail_text = "already_dealt_with_blokkat_inquietude"
				hidden_trigger = { NOR = { has_modifier = suppressed_blokkat_inquietude has_modifier = bolstered_blokkat_inquietude } }
			}
			custom_tooltip = {
				fail_text = "blokkat_inquietude_too_high"
				hidden_trigger = {
					check_variable = {
						which = blokkat_inquietude_value
						value < 98
					}
				}
			}
		}
		add_modifier = {
			modifier = bolstered_blokkat_inquietude
			days = 180
		}
		hidden_effect = {
			add_resource = { influence = -100 }
			country_event = { id = giga_blokkat.3000 }
			remove_country_flag = monitoring_blokkats
			change_variable = {
				which = blokkat_inquietude_value
				value = 2
			}
			change_variable = {
				which = blokkat_inquietude_research_value
				value = 6
			}
			change_variable = {
				which = blokkat_inquietude_stability_value
				value = 2
			}
			change_variable = {
				which = blokkat_inquietude_happiness_value
				value = 8
			}
		}
	}

	option = { #decrease inquietude
		name = "giga_blokkat.3000.downinquietude"
		custom_tooltip = "giga_blokkat.3000.downinquietude.tooltip"
		custom_gui = blokkat_bureau_option_inquietude_down
		trigger = { has_country_flag = blokkat_inquietude_taught }
		allow = { 
			resource_stockpile_compare = { resource = influence value >= 200 }
			custom_tooltip = {
				fail_text = "already_dealt_with_blokkat_inquietude"
				hidden_trigger = { NOR = { has_modifier = suppressed_blokkat_inquietude has_modifier = bolstered_blokkat_inquietude } }
			}
			custom_tooltip = {
				fail_text = "blokkat_inquietude_too_low"
				hidden_trigger = {
					check_variable = {
						which = blokkat_inquietude_value
						value > 2
					}
				}
			}
		}
		add_modifier = {
			modifier = suppressed_blokkat_inquietude
			days = 180
		}
		hidden_effect = {
			add_resource = { influence = -200 }
			country_event = { id = giga_blokkat.3000 }
			remove_country_flag = monitoring_blokkats
			subtract_variable = {
				which = blokkat_inquietude_value
				value = 2
			}
			subtract_variable = {
				which = blokkat_inquietude_research_value
				value = 6
			}
			subtract_variable = {
				which = blokkat_inquietude_stability_value
				value = 2
			}
			subtract_variable = {
				which = blokkat_inquietude_happiness_value
				value = 8
			}
		}
	}

	option = { #new mega stage 4
		name = "giga_blokkat.3000.mega4"
		custom_tooltip = "giga_blokkat.3000.mega4.tooltip"
		custom_gui = blokkat_bureau_option
		trigger = {
			has_country_flag = blokkat_mega_stage_2_researched
			NOT = { has_country_flag = blokkat_mega_stage_3_researched }
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3066 }
		}
		allow = {
			custom_tooltip = {
				fail_text = "blokkat_requires_40_knowledge"
				hidden_trigger = {
					check_variable = {
						which = blokkat_knowledge_value
						value >= 40
					}
				}
			}
			custom_tooltip = {
				fail_text = blokkat_project_already_underway
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_project_underway }
				}
			}
		}
	}

	option = { #new mega stage 5
		name = "giga_blokkat.3000.mega5"
		custom_tooltip = "giga_blokkat.3000.mega5.tooltip"
		custom_gui = blokkat_bureau_option
		trigger = {
			has_country_flag = blokkat_mega_stage_3_researched
			has_country_flag = unlocked_final_blokkat_mega_stage
			NOT = { has_country_flag = blokkat_mega_stage_4_researched }
			NOT = { has_global_flag = blokkat_crisis_defeated }
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3329 }
		}
		allow = {
			custom_tooltip = {
				fail_text = "blokkat_requires_50_knowledge"
				hidden_trigger = {
					check_variable = {
						which = blokkat_knowledge_value
						value >= 50
					}
				}
			}
			custom_tooltip = {
				fail_text = blokkat_project_already_underway
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_project_underway }
				}
			}
		}
	}

	option = { #nothing to do
		name = "giga_blokkat.3000.megano"
		custom_gui = blokkat_bureau_option
		trigger = {
			has_country_flag = blokkat_mega_stage_3_researched
			NOR = { 
				has_global_flag = blokkat_crisis_defeated
				AND = {
					has_country_flag = unlocked_final_blokkat_mega_stage
					NOT = { has_country_flag = blokkat_mega_stage_4_researched }
				} 
			}
		}
		allow = {
			custom_tooltip = {
				fail_text = blokkat_cant_click_this
				hidden_trigger = {
					always = no
				}
			}
		}
	}

	option = { #theyre gone
		name = "giga_blokkat.3000.blokkatsgone"
		custom_gui = blokkat_bureau_option
		trigger = {
			has_global_flag = blokkat_crisis_defeated
		}
		allow = {
			custom_tooltip = {
				fail_text = blokkat_cant_click_this
				hidden_trigger = {
					always = no
				}
			}
		}
	}

	option = { #new mega stage 3
		name = "giga_blokkat.3000.mega3"
		custom_tooltip = "giga_blokkat.3000.mega3.tooltip"
		custom_gui = blokkat_bureau_option
		trigger = {
			has_country_flag = blokkat_mega_stage_1_researched
			NOT = { has_country_flag = blokkat_mega_stage_2_researched }
			NOT = { has_global_flag = blokkat_crisis_defeated }
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3064 }
		}
		allow = {
			custom_tooltip = {
				fail_text = "blokkat_requires_30_knowledge"
				hidden_trigger = {
					check_variable = {
						which = blokkat_knowledge_value
						value >= 30
					}
				}
			}
			custom_tooltip = {
				fail_text = blokkat_project_already_underway
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_project_underway }
				}
			}
		}
	}

	option = { #new mega stage 2
		name = "giga_blokkat.3000.mega2"
		custom_tooltip = "giga_blokkat.3000.mega2.tooltip"
		custom_gui = blokkat_bureau_option
		trigger = {
			has_country_flag = blokkat_mega_stage_0_researched
			NOT = { has_country_flag = blokkat_mega_stage_1_researched }
			NOT = { has_global_flag = blokkat_crisis_defeated }
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3062 }
		}
		allow = {
			custom_tooltip = {
				fail_text = "needs_society_blokkat_project"
				hidden_trigger = {
					has_country_flag = blokkat_society_researched
				}
			}
			custom_tooltip = {
				fail_text = "blokkat_requires_20_knowledge"
				hidden_trigger = {
					check_variable = {
						which = blokkat_knowledge_value
						value >= 20
					}
				}
			}
			custom_tooltip = {
				fail_text = blokkat_project_already_underway
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_project_underway }
				}
			}
		}
	}

	option = { #new mega
		name = "giga_blokkat.3000.mega1"
		custom_tooltip = "giga_blokkat.3000.mega1.tooltip"
		custom_gui = blokkat_bureau_option
		trigger = {
			has_country_flag = blokkat_shield_researched
			has_country_flag = giga_decided_to_fight_blokkats
			NOT = { has_country_flag = blokkat_mega_stage_0_researched }
			NOT = { has_global_flag = blokkat_crisis_defeated }
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3060 }
		}
		allow = {
			custom_tooltip = {
				fail_text = "needs_physics_blokkat_project"
				hidden_trigger = {
					has_country_flag = blokkat_physics_researched
				}
			}
			custom_tooltip = {
				fail_text = "blokkat_requires_10_knowledge"
				hidden_trigger = {
					check_variable = {
						which = blokkat_knowledge_value
						value >= 10
					}
				}
			}
			custom_tooltip = {
				fail_text = blokkat_project_already_underway
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_project_underway }
				}
			}
		}
	}

	option = { #ASCEND
		name = "giga_blokkat.3000.joinblokkats6"
		custom_tooltip = "giga_blokkat.3000.joinblokkats6.tooltip"
		custom_gui = blokkat_bureau_option
		trigger = {
			has_country_flag = giga_decided_to_join_blokkats
			has_country_flag = blokkat_joinblokkats_stage_5_researched
			NOT = { has_country_flag = blokkat_joinblokkats_stage_6_researched }
			NOT = { has_global_flag = blokkat_crisis_defeated }
		}
		hidden_effect = {
			country_event = { id = giga_blokkat_join.2999 }
			add_resource = {
				energy = -1
				mult = blokkat_ascension_cost
			}
		}
		allow = {
			resource_stockpile_compare = {
				resource = energy
				value > 1
				mult = blokkat_ascension_cost
			}
			custom_tooltip = {
				fail_text = "blokkat_requires_70_willingness"
				hidden_trigger = {
					check_variable = {
						which = blokkat_willingness_global_value
						value >= 70
					}
				}
			}
			custom_tooltip = {
				fail_text = "blokkat_requires_60_knowledge"
				hidden_trigger = {
					check_variable = {
						which = blokkat_knowledge_value
						value >= 60
					}
				}
			}
			custom_tooltip = {
				fail_text = blokkat_project_already_underway
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_project_underway }
				}
			}
		}
	}

	option = { #build gigarelay
		name = "giga_blokkat.3000.joinblokkats5"
		custom_tooltip = "giga_blokkat.3000.joinblokkats5.tooltip"
		custom_gui = blokkat_bureau_option
		trigger = {
			has_country_flag = giga_decided_to_join_blokkats
			has_country_flag = blokkat_joinblokkats_stage_4_researched
			NOT = { has_country_flag = blokkat_joinblokkats_stage_5_researched }
			NOT = { has_global_flag = blokkat_crisis_defeated }
		}
		hidden_effect = {
			country_event = { id = giga_blokkat_join.2040 }
		}
		allow = {
			custom_tooltip = {
				fail_text = "blokkat_requires_50_knowledge"
				hidden_trigger = {
					check_variable = {
						which = blokkat_knowledge_value
						value >= 50
					}
				}
			}
			custom_tooltip = {
				fail_text = blokkat_project_already_underway
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_project_underway }
				}
			}
		}
	}

	option = { #build network
		name = "giga_blokkat.3000.joinblokkats4"
		custom_tooltip = "giga_blokkat.3000.joinblokkats4.tooltip"
		custom_gui = blokkat_bureau_option
		trigger = {
			has_country_flag = giga_decided_to_join_blokkats
			has_country_flag = blokkat_joinblokkats_stage_3_researched
			NOT = { has_country_flag = blokkat_joinblokkats_stage_4_researched }
			NOT = { has_global_flag = blokkat_crisis_defeated }
		}
		hidden_effect = {
			country_event = { id = giga_blokkat_join.2030 }
		}
		allow = {
			custom_tooltip = {
				fail_text = "blokkat_requires_40_knowledge"
				hidden_trigger = {
					check_variable = {
						which = blokkat_knowledge_value
						value >= 40
					}
				}
			}
			custom_tooltip = {
				fail_text = blokkat_project_already_underway
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_project_underway }
				}
			}
		}
	}

	option = { #do math
		name = "giga_blokkat.3000.joinblokkats3"
		custom_tooltip = "giga_blokkat.3000.joinblokkats3.tooltip"
		custom_gui = blokkat_bureau_option
		trigger = {
			has_country_flag = giga_decided_to_join_blokkats
			has_country_flag = blokkat_joinblokkats_stage_2_researched
			NOT = { has_country_flag = blokkat_joinblokkats_stage_3_researched }
			NOT = { has_global_flag = blokkat_crisis_defeated }
		}
		hidden_effect = {
			country_event = { id = giga_blokkat_join.2020 }
		}
		allow = {
			custom_tooltip = {
				fail_text = "needs_engineering_blokkat_project"
				hidden_trigger = {
					has_country_flag = blokkat_engineering_researched
				}
			}
			custom_tooltip = {
				fail_text = "blokkat_requires_30_knowledge"
				hidden_trigger = {
					check_variable = {
						which = blokkat_knowledge_value
						value >= 30
					}
				}
			}
			custom_tooltip = {
				fail_text = blokkat_project_already_underway
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_project_underway }
				}
			}
		}
	}

	option = { #text the blokkats
		name = "giga_blokkat.3000.joinblokkats2"
		custom_tooltip = "giga_blokkat.3000.joinblokkats2.tooltip"
		custom_gui = blokkat_bureau_option
		trigger = {
			has_country_flag = giga_decided_to_join_blokkats
			has_country_flag = blokkat_joinblokkats_stage_1_researched
			NOT = { has_country_flag = blokkat_joinblokkats_stage_2_researched }
			NOT = { has_global_flag = blokkat_crisis_defeated }
		}
		hidden_effect = {
			country_event = { id = giga_blokkat_join.2010 }
			add_resource = {
				energy = -200000
			}
		}
		allow = {
			resource_stockpile_compare = {
				resource = energy
				value > 200000
			}
			custom_tooltip = {
				fail_text = "needs_physics_blokkat_project"
				hidden_trigger = {
					has_country_flag = blokkat_physics_researched
				}
			}
			custom_tooltip = {
				fail_text = "blokkat_requires_20_knowledge"
				hidden_trigger = {
					check_variable = {
						which = blokkat_knowledge_value
						value >= 20
					}
				}
			}
			custom_tooltip = {
				fail_text = blokkat_project_already_underway
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_project_underway }
				}
			}
		}
	}
	
	option = { #translate blokkat language
		name = "giga_blokkat.3000.joinblokkats1"
		custom_tooltip = "giga_blokkat.3000.joinblokkats1.tooltip"
		custom_gui = blokkat_bureau_option
		trigger = {
			has_country_flag = blokkat_shield_researched
			has_country_flag = giga_decided_to_join_blokkats
			NOT = { has_country_flag = blokkat_joinblokkats_stage_1_researched }
			NOT = { has_global_flag = blokkat_crisis_defeated }
		}
		hidden_effect = {
			country_event = { id = giga_blokkat_join.2000 }
		}
		allow = {
			custom_tooltip = {
				fail_text = "needs_society_blokkat_project"
				hidden_trigger = {
					has_country_flag = blokkat_society_researched
				}
			}
			custom_tooltip = {
				fail_text = "blokkat_requires_10_knowledge"
				hidden_trigger = {
					check_variable = {
						which = blokkat_knowledge_value
						value >= 10
					}
				}
			}
			custom_tooltip = {
				fail_text = blokkat_project_already_underway
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_project_underway }
				}
			}
		}
	}

	option = { #fix stuff
		name = "giga_blokkat.3000.fixblokkatstars"
		custom_tooltip = "giga_blokkat.3000.fixblokkatstars.tooltip"
		custom_gui = blokkat_bureau_option
		trigger = {
			has_country_flag = can_research_blokkat_star_repair
			NOT = { has_country_flag = blokkat_star_repair_researched }
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3351 }
		}
		allow = {
			custom_tooltip = {
				fail_text = blokkat_project_already_underway
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_project_underway }
				}
			}
		}
	}


	option = { #shield
		name = "giga_blokkat.3000.shield"
		custom_tooltip = "giga_blokkat.3000.shield.tooltip"
		custom_gui = blokkat_bureau_option
		trigger = {
			NOT = {
				has_country_flag = blokkat_shield_researched
			}
			NOT = { has_global_flag = blokkat_crisis_defeated }
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3010 }
			set_country_flag = blokkat_shield_being_researched
		}
		allow = {
			custom_tooltip = {
				fail_text = "blokkat_project_already_being_done"
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_shield_being_researched }
				}
			}
			custom_tooltip = {
				fail_text = "blokkat_project_already_done"
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_shield_researched }
				}
			}
		}
	}

	option = { #physics
		name = "giga_blokkat.3000.blokkphysics"
		custom_tooltip = "giga_blokkat.3000.blokkphysics.tooltip"
		custom_gui = blokkat_bureau_option
		trigger = {
			has_country_flag = blokkat_shield_researched
			NOT = { has_country_flag = blokkat_physics_researched }
			NOT = { has_global_flag = blokkat_crisis_defeated }
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3030 }
		}
		allow = {
			has_technology = giga_tech_tetradimensional_engineering
			custom_tooltip = {
				fail_text = blokkat_project_already_underway
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_project_underway }
				}
			}
		}
	}

	option = { #engineering
		name = "giga_blokkat.3000.blokkengineering"
		custom_tooltip = "giga_blokkat.3000.blokkengineering.tooltip"
		custom_gui = blokkat_bureau_option
		trigger = {
			has_country_flag = blokkat_shield_researched
			NOT = { has_country_flag = blokkat_engineering_researched }
			NOT = { has_global_flag = blokkat_crisis_defeated }
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3050 }
		}
		allow = {
			has_technology = tech_ship_armor_5
			custom_tooltip = {
				fail_text = blokkat_project_already_underway
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_project_underway }
				}
			}
		}
	}

	option = { #society
		name = "giga_blokkat.3000.blokksociety"
		custom_tooltip = "giga_blokkat.3000.blokksociety.tooltip"
		custom_gui = blokkat_bureau_option
		trigger = {
			has_country_flag = blokkat_shield_researched
			NOT = { has_country_flag = blokkat_society_researched }
			NOT = { has_global_flag = blokkat_crisis_defeated }
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3020 }
		}
		allow = {
			custom_tooltip = {
				fail_text = blokkat_project_already_underway
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_project_underway }
				}
			}
		}
	}

	option = { #paluush project
		name = "giga_blokkat.3000.blokkpaluush"
		custom_tooltip = "giga_blokkat.3000.blokkpaluush.tooltip"
		custom_gui = blokkat_bureau_option
		trigger = {
			has_country_flag = blokkat_paluush_analysis_started
			NOT = { has_country_flag = blokkat_paluush_analysis_researched }
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3301 }
		}
		allow = {
			custom_tooltip = {
				fail_text = blokkat_project_already_underway
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_project_underway }
				}
			}
		}
	}

	option = { #paluush project 2
		name = "giga_blokkat.3000.paluushshield"
		custom_tooltip = "giga_blokkat.3000.paluushshield.tooltip"
		custom_gui = blokkat_bureau_option
		trigger = {
			NOT = { has_country_flag = paluushia_shield_breached }
			has_country_flag = can_breach_paluushia_shield
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3304 }
			add_resource = {
				energy = -800000
			}
		}
		allow = {
			resource_stockpile_compare = {
				resource = energy
				value > 800000
			}
			custom_tooltip = {
				fail_text = blokkat_project_already_underway
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_project_underway }
				}
			}
		}
	}

	option = { #paluush project 3
		name = "giga_blokkat.3000.paluushtime"
		custom_tooltip = "giga_blokkat.3000.paluushtime.tooltip"
		custom_gui = blokkat_bureau_option
		trigger = {
			has_country_flag = can_do_blokkat_timetravel_project
			NOT = { has_country_flag = blokkat_temporal_discrepancy_solved }
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3325 }
		}
		allow = {
			custom_tooltip = {
				fail_text = not_enough_scrap_knowledge
				hidden_trigger = {
					check_variable = {
						which = blokkat_knowledge_value
						value >= 30
					}
					check_variable = {
						which = blokkat_scrap_value
						value >= 150
					}
				}
			}
			custom_tooltip = {
				fail_text = blokkat_project_already_underway
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_project_underway }
				}
			}
		}
	}
	
	option = { #capture project
		name = "giga_blokkat.3000.blokkcapture"
		custom_tooltip = "giga_blokkat.3000.blokkcapture.tooltip"
		custom_gui = blokkat_bureau_option
		trigger = {
			has_country_flag = blokkat_capture_project_started
			NOT = { has_country_flag = blokkat_capture_project_researched }
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3201 }
		}
		allow = {
			custom_tooltip = {
				fail_text = "blokkat_requires_10_knowledge"
				hidden_trigger = {
					check_variable = {
						which = blokkat_knowledge_value
						value >= 10
					}
				}
			}
			custom_tooltip = {
				fail_text = blokkat_project_already_underway
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_project_underway }
				}
			}
		}
	}

	option = { #reprogram project
		name = "giga_blokkat.3000.blokkreprogram"
		custom_tooltip = "giga_blokkat.3000.blokkreprogram.tooltip"
		custom_gui = blokkat_bureau_option
		trigger = {
			has_country_flag = blokkat_reprogram_project_unlocked
			NOT = { has_country_flag = blokkat_reprogram_project_researched }
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3231 }
		}
		allow = {
			custom_tooltip = {
				fail_text = "blokkat_requires_35_knowledge"
				hidden_trigger = {
					check_variable = {
						which = blokkat_knowledge_value
						value >= 35
					}
				}
			}
			custom_tooltip = {
				fail_text = "must_have_conducted_3_experiments_on_blokkat"
				hidden_trigger = {
					check_variable = {
						which = blokkat_knowledge_earned_by_capture
						value >= 3
					}
				}
			}
			custom_tooltip = {
				fail_text = blokkat_project_already_underway
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_project_underway }
				}
			}
		}
	}

	option = { #scrap
		name = "giga_blokkat.3000.blokkscrap"
		custom_tooltip = "giga_blokkat.3000.blokkscrap.tooltip"
		custom_gui = blokkat_bureau_option
		trigger = {
			has_country_flag = blokkat_scrap_popup
			NOT = { has_country_flag = researched_blokkat_scrap }
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3082 }
		}
		allow = {
			custom_tooltip = {
				fail_text = "needs_all_3_blokkat_project"
				hidden_trigger = {
					has_country_flag = blokkat_physics_researched
					has_country_flag = blokkat_engineering_researched
					has_country_flag = blokkat_society_researched
				}
			}
			custom_tooltip = {
				fail_text = blokkat_project_already_underway
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_project_underway }
				}
			}
		}
	}

	option = { #reverse engineer
		name = "giga_blokkat.3000.blokkreversengineer"
		custom_tooltip = "giga_blokkat.3000.blokkreversengineer.tooltip"
		custom_gui = blokkat_bureau_option
		trigger = {
			has_country_flag = researched_blokkat_scrap
			NOT = {
				AND = {
					has_technology = giga_tech_blokkat_afterburner
					has_technology = giga_tech_blokkat_laser
					has_technology = giga_tech_blokkat_plasma
					has_technology = giga_tech_blokkat_hullrepair
					has_technology = giga_tech_blokkat_strikecraft
					has_technology = giga_tech_blokkat_reactor
					has_technology = giga_tech_blokkat_shield
					has_technology = giga_tech_blokkat_sensors
					has_technology = giga_tech_blokkat_armor
					has_technology = giga_tech_blokkat_emitter
					has_technology = giga_tech_blokkat_obliterator
					has_technology = giga_tech_blokkat_missile
					has_technology = giga_tech_blokkat_computer
					has_technology = giga_tech_blokkat_pd
					has_technology = giga_tech_blokkat_ftl
					has_technology = giga_tech_blokkat_booster
				}
			}
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3090 }
		}
		allow = {
			custom_tooltip = {
				fail_text = "needs_enough_blokkat_scrap"
				hidden_trigger = {
					check_variable = {
						which = blokkat_scrap_value
						value >= 50
					}
				}
			}
			custom_tooltip = {
				fail_text = "blokkat_requires_20_knowledge"
				hidden_trigger = {
					check_variable = {
						which = blokkat_knowledge_value
						value >= 20
					}
				}
			}
			custom_tooltip = {
				fail_text = blokkat_project_already_underway
				hidden_trigger = {
					NOT = { has_country_flag = blokkat_project_underway }
				}
			}
		}
	}
}

fleet_event = {
	id = giga_blokkat.6500
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		OR = {
			has_fleet_flag = blokkat_stripmine_fleet
			has_fleet_flag = blokkat_mothership_fleet
		}
		from = {
			any_system_megastructure = {
				OR = {
					is_megastructure_type = gateway_final
					is_megastructure_type = gateway_restored
					is_megastructure_type = lgate_base
					is_megastructure_type = ehof_pgate_gateway
				}
			}
		}
	}
	
	immediate = {
		from = {
			every_system_megastructure = {
				limit = {
					is_megastructure_type = ehof_pgate_gateway
				}
				upgrade_megastructure_to = blokkat_dummy_pillar
				remove_megastructure = THIS
			}
			every_system_megastructure = {
				limit = {
					is_megastructure_type = gateway_final
				}
				upgrade_megastructure_to = blokkat_dummy_gateway
				remove_megastructure = THIS
			}
			every_system_megastructure = {
				limit = {
					is_megastructure_type = gateway_restored
				}
				upgrade_megastructure_to = blokkat_dummy_gateway_repair
				remove_megastructure = THIS
			}
			every_system_megastructure = {
				limit = {
					is_megastructure_type = lgate_base
				}
				upgrade_megastructure_to = blokkat_dummy_lgate
				remove_megastructure = THIS
			}
		}
	}
}

#when a blokkat vessel is destroyed
country_event = {
	id = giga_blokkat.3080
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		FromFromFrom = { owner = { is_country_type = blokkat_stripminers } }
	}

	immediate = {
		every_country = {
			limit = { has_event_chain = blokkat_chain }
			add_event_chain_counter = {
				event_chain = blokkat_chain
				counter = blokkat_ships_destroyed
				amount = 1
			}
		}
		if = {
			limit = {
				FromFromFrom = {  
					is_ship_size = giga_blokkat_evictor
					owner = { is_country_type = blokkat_stripminers }
				}
			}
			change_variable = {
				which = blokkat_scrap_value
				value = 1
			}
			if = {
				limit = { has_country_flag = blokkat_willingness_active }
				change_variable = {
					which = blokkat_willingness_military_value
					value = 0.02
				}
				update_blokkat_willingness_value = yes
			}
		}
		if = {
			limit = {
				FromFromFrom = {  
					is_ship_size = giga_blokkat_custodian
					owner = { is_country_type = blokkat_stripminers }
				}
			}
			change_variable = {
				which = blokkat_scrap_value
				value = 7
			}
			if = {
				limit = { has_country_flag = blokkat_willingness_active }
				change_variable = {
					which = blokkat_willingness_military_value
					value = 0.06
				}
				update_blokkat_willingness_value = yes
			}
		}
		if = {
			limit = {
				FromFromFrom = {  
					is_ship_size = giga_blokkat_harvester
					owner = { is_country_type = blokkat_stripminers }
				}
			}
			change_variable = {
				which = blokkat_scrap_value
				value = 40
			}
		}
		if = {
			limit = {
				FromFromFrom = {  
					is_ship_size = giga_blokkat_terminator
					owner = { is_country_type = blokkat_stripminers }
				}
			}
			change_variable = {
				which = blokkat_scrap_value
				value = 75
			}
		}
		if = {
			limit = {
				FromFromFrom = {  
					is_ship_size = giga_blokkat_mothership
					owner = { is_country_type = blokkat_stripminers }
				}
			}
			change_variable = {
				which = blokkat_scrap_value
				value = 300
			}
		}
		if = {
			limit = { NOT = { has_country_flag = blokkat_scrap_popup } }
			set_country_flag = blokkat_scrap_popup
			country_event = { id = giga_blokkat.3081 days = 10 }
		}
	}
}

#Blokkat scrap info
country_event = {
	id = giga_blokkat.3081
	title = "giga_blokkat.3081.name"
	desc = "giga_blokkat.3081.desc"

	is_triggered_only = yes
	show_sound = event_ancient_drone

	picture = GFX_evt_analyzing_artifacts

	option = { #kk
		name = "giga_blokkat.3081.a"
		custom_tooltip = "giga_blokkat.3081.a.tooltip"
	}
}


#blokkat scrap uses
country_event = {
	id = giga_blokkat.3082
	title = "giga_blokkat.3082.name"
	desc = "giga_blokkat.3082.desc"
	is_triggered_only = yes
	show_sound = event_sensor_ping
	picture = GFX_evt_analyzing_artifacts
	immediate = {
		set_country_flag = blokkat_scrap_possible
	}
	option = { #kk
		name = "giga_blokkat.3082.a"
		custom_tooltip = cant_do_another_blokkat_project_tech_tooltip
		add_research_option = giga_tech_blokkat_scrap_uses
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
			set_country_flag = blokkat_project_underway
		}
	}

	option = { #nvm
		name = "giga_blokkat.3020.b"
		hidden_effect = {
			country_event = { id = giga_blokkat.3000 }
			remove_country_flag = blokkat_scrap_possible
		}
	}
}

country_event = {
	id = giga_blokkat.3083
	title = "giga_blokkat.3083.name"
	desc = "giga_blokkat.3083.desc"
	show_sound = event_laboratory_sound
	picture = GFX_evt_analyzing_artifacts
	is_triggered_only = yes

	trigger = {	
		last_increased_tech = giga_tech_blokkat_scrap_uses
	}

	option = { #kk
		name = "giga_blokkat.3083.a"
		custom_tooltip = "giga_blokkat.3083.a.tooltip"
		hidden_effect = {
			set_country_flag = researched_blokkat_scrap
			remove_country_flag = blokkat_project_underway
			change_variable = {
				which = blokkat_knowledge_value
				value = 1
			}
			change_variable = {
				which = blokkat_knowledge_earned_by_general_study
				value = 1
			}
		}
	}
}

country_event = {
	id = giga_blokkat.3084
	is_triggered_only = yes

	hide_window = yes

	immediate = {
		subtract_variable = {
			which = blokkat_scrap_research_value
			value = 100
		}
	}
}


country_event = {
	id = giga_blokkat.3085
	is_triggered_only = yes

	hide_window = yes

	immediate = {
		subtract_variable = {
			which = blokkat_scrap_damage_value
			value = 75
		}
	}
}

#research repeatable unlocked
country_event = {
	id = giga_blokkat.3086
	is_triggered_only = yes

	hide_window = yes

	trigger = {
		last_increased_tech = giga_tech_blokkat_scrap_research
	}

	immediate = {
		remove_country_flag = researching_blokkat_scrap_research
		change_variable = {
			which = blokkat_scrap_research_value
			value = 15
		}
		change_variable = {
			which = blokkat_knowledge_value
			value = 0.5
		}
		change_variable = {
			which = blokkat_knowledge_earned_by_repeatables
			value = 0.5
		}
	}
}

#damage repeatable unlocked
country_event = {
	id = giga_blokkat.3087
	is_triggered_only = yes

	hide_window = yes

	trigger = {
		last_increased_tech = giga_tech_blokkat_scrap_damage
	}

	immediate = {
		remove_country_flag = researching_blokkat_scrap_damage
		change_variable = {
			which = blokkat_scrap_damage_value
			value = 15
		}
		change_variable = {
			which = blokkat_knowledge_value
			value = 0.5
		}
		change_variable = {
			which = blokkat_knowledge_earned_by_repeatables
			value = 0.5
		}
	}
}

#PALUUSH
country_event = {
	id = giga_blokkat.3300
	title = "giga_blokkat.3300.name"
	desc = "giga_blokkat.3300.desc"

	is_triggered_only = yes

	show_sound = event_radio_chatter
	picture = GFX_evt_mysterious_signal

	immediate = {
		set_country_flag = blokkat_paluush_analysis_started
	}

	option = { #kk
		name = "giga_blokkat.3300.a"
		custom_tooltip = "giga_blokkat.3300.a.tooltip"
	}
}

#investigate the signal
country_event = {
	id = giga_blokkat.3301
	title = "giga_blokkat.3301.name"
	desc = {
		trigger = { is_multiplayer = no }
		text = "giga_blokkat.3301.desc"
	}
	desc = {
		trigger = { is_multiplayer = yes }
		text = "giga_blokkat.3301.descmp"
	}
	is_triggered_only = yes

	show_sound = event_radio_chatter
	picture = GFX_evt_mysterious_signal

	option = { #kk
		name = "giga_blokkat.3301.a"
		custom_tooltip = "giga_blokkat.3301.a.tooltip"
		enable_special_project = {
			name = ANALYZE_PALUUSH_SIGNAL
			owner = ROOT
		}
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
			set_country_flag = blokkat_project_underway
		}
	}

	option = { #nvm
		name = "giga_blokkat.3301.b"
		hidden_effect = {
			country_event = { id = giga_blokkat.3000 }
		}
	}
}

#PALUUSHIA
country_event = {
	id = giga_blokkat.3302
	title = "giga_blokkat.3302.name"
	desc = "giga_blokkat.3302.desc"
	is_triggered_only = yes

	show_sound = event_mystic_reveal_light
	picture = GFX_evt_medieval_alien_civilization

	immediate = {
		set_variable = {
			which = blokkat_knowledge_earned_by_paluush
			value = 0
		}
		every_country = {
			limit = { has_special_project = ANALYZE_PALUUSH_SIGNAL }
			abort_special_project = { type = ANALYZE_PALUUSH_SIGNAL }
		}
		event_target:paluushia = {
			set_planet_flag = paluushia_scaring_blokkats
			destroy_colony = yes
			change_pc = pc_shrouded
			create_ambient_object = {
				type = "paluushia_psi_storm_effect"
				entity_offset_height = -14
				location = this
			}
			last_created_ambient_object = {
				set_location = {
					target = event_target:paluushia
					distance = 0
					angle = random
				}
				set_ambient_object_flag = paluushia_psi_storm_entity
			}
		}
		save_global_event_target_as = paluush_event_chain_country
		set_country_flag = paluush_event_chain_ongoing
	}

	option = { #kk
		name = "giga_blokkat.3302.a"
		custom_tooltip = "giga_blokkat.3302.a.tooltip"
		hidden_effect = {
			remove_country_flag = blokkat_project_underway
			set_country_flag = blokkat_paluush_analysis_researched
		}
	}
}

country_event = {
	id = giga_blokkat.3303
	title = "giga_blokkat.3303.name"
	desc = "giga_blokkat.3303.desc"
	is_triggered_only = yes

	show_sound = event_activating_unknown_technology
	picture = GFX_evt_shrouded_planet

	immediate = {
		set_country_flag = blokkat_sent_science_ship_to_gatzo
	}

	option = { #kk
		name = "giga_blokkat.3303.a"
		custom_tooltip = "giga_blokkat.3303.a.tooltip"
		hidden_effect = {
			set_country_flag = can_breach_paluushia_shield
		}
	}
}

#Paluushia shield breached!
country_event = {
	id = giga_blokkat.3304
	title = "giga_blokkat.3304.name"
	desc = "giga_blokkat.3304.desc"
	is_triggered_only = yes

	show_sound = event_activating_unknown_technology
	picture = GFX_evt_zro_3

	immediate = {
		set_global_flag = waiting_to_kill_paluushia_manifestation
		set_country_flag = paluushia_shield_breached
		remove_country_flag = can_breach_paluushia_shield
		event_target:paluushia = {
			create_country = {
				name = "Paluushian Civilization"
				type = shroud_spirits
				flag = {
					icon = {
						category = "special"
						file = "the_shroud.dds"
					}
					background= {
						category = "backgrounds"
						file = "00_solid.dds"
					}
					colors = {
						"dark_purple"
						"black"
						"null"
						"null"
					}
				}
				effect = {
					save_global_event_target_as = shroud_paluushia_country
				}
			}
			create_fleet = { #Oh no!
				name = "Paluushian Energies"
				settings = {
					spawn_debris = no
					can_upgrade = no
					uses_naval_capacity = no
					can_change_composition = yes
					is_boss = yes
				}
				effect = {
					set_owner = event_target:shroud_paluushia_country
					while = {
						count = 1
						create_ship = {
							name = "Paluushian Energies"
							design = NAME_Shroud_Manifestation
							prefix = no
							effect = {
								add_modifier = {
									modifier = paluush_energies_buff
									days = -1
								}
							}
						}
					}
					set_location = {
						target = event_target:paluushia
						distance = 0
						angle = random
					}
					set_formation_scale = 0
					set_fleet_flag = paluush_energies_fleet
					save_global_event_target_as = paluush_energies_fleet
				}
			}
		}
	}

	option = { #kk
		name = "giga_blokkat.3304.a"
		custom_tooltip = "giga_blokkat.3304.a.tooltip"
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
			set_country_flag = can_breach_paluushia_shield
		}
	}
}

#Paluushia entity destroyed
country_event = {
	id = giga_blokkat.3305
	title = "giga_blokkat.3305.name"
	desc = "giga_blokkat.3305.desc"
	is_triggered_only = yes

	show_sound = event_space_battle
	picture = GFX_evt_large_explosion

	immediate = {
		remove_global_flag = waiting_to_kill_paluushia_manifestation
	}

	option = { #kk
		name = "giga_blokkat.3305.a"
		custom_tooltip = "giga_blokkat.3305.a.tooltip"
		event_target:paluushia = {
			enable_special_project = {
				name = GO_INTO_PALUUSHIA
				owner = ROOT
				location = event_target:paluushia
			}
		}
	}
}

#Hello Grandbunny
country_event = {
	id = giga_blokkat.3306
	title = "giga_blokkat.3306.name"
	desc = "giga_blokkat.3306.desc"
	is_triggered_only = yes

	show_sound = event_mystic_reveal_light
	picture = GFX_evt_shrouded_planet

	immediate = {
		event_target:paluushia = {
			create_species = {
				name = "Grandbunny"
				plural = "Grandbunnies"
				class = GIGAPALUUSH
				portrait = gigagrandbunny
				homeworld = THIS
				traits = {
					trait = trait_pc_continental_preference
				}
				effect = {
					save_global_event_target_as = grandbunnyportrait_species
				}
			}
		}
		event_target:global_event_country = {
			create_leader = {
				class = governor
				immortal = yes
				gender = female
				skill = 10
				name = "The Grandbunny"
				species = event_target:grandbunnyportrait_species
				traits = {
					trait = leader_trait_governor_psionic
				}
				effect = {
					set_leader_flag = grandbunnyportrait
					save_global_event_target_as = grandbunnyportrait
				}
			}
		}
	}

	option = { #kk
		name = "giga_blokkat.3306.a"
		hidden_effect = {
			country_event = { id = giga_blokkat.3307 }
		}
	}
}

country_event = {
	id = giga_blokkat.3307
	title = "giga_blokkat.3307.name"
	desc = "giga_blokkat.3307.desc"
	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = event_target:grandbunnyportrait
		room = paluush_grandbunny_room
	}

	option = { #kk
		name = "giga_blokkat.3307.a"
		hidden_effect = {
			country_event = { id = giga_blokkat.3308 }
		}
	}
}

country_event = {
	id = giga_blokkat.3308
	title = "giga_blokkat.3308.name"
	desc = "giga_blokkat.3308.desc"
	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = event_target:grandbunnyportrait
		room = paluush_grandbunny_room
	}

	option = { #what are you??
		name = "giga_blokkat.3308.e"
		response_text = "giga_blokkat.3308.e.response"
		is_dialog_only = yes
	}

	option = { #the conflict?
		name = "giga_blokkat.3308.a"
		response_text = "giga_blokkat.3308.a.response"
		is_dialog_only = yes
	}

	option = { #you know about them?
		name = "giga_blokkat.3308.b"
		response_text = "giga_blokkat.3308.b.response"
		is_dialog_only = yes
	}

	option = { #why shield?
		name = "giga_blokkat.3308.c"
		response_text = "giga_blokkat.3308.c.response"
		is_dialog_only = yes
	}

	option = { #help us plz
		name = "giga_blokkat.3308.d"
		response_text = "giga_blokkat.3308.d.response"
		default_hide_option = yes
		hidden_effect = {
			country_event = { id = giga_blokkat.3309 days = 1 }
		}
	}
}

#A deal
country_event = {
	id = giga_blokkat.3309
	title = "giga_blokkat.3309.name"
	desc = {
		trigger = {
			NOR = {
				has_valid_civic = civic_machine_terminator
				has_valid_civic = civic_fanatic_purifiers
				has_valid_civic = civic_hive_devouring_swarm
			}
		}
		text = "giga_blokkat.3309.desc"
	}
	desc = {
		trigger = {
			OR = {
				has_valid_civic = civic_machine_terminator
				has_valid_civic = civic_fanatic_purifiers
				has_valid_civic = civic_hive_devouring_swarm
			}
		}
		text = "giga_blokkat.3309.descgeno"
	}
	is_triggered_only = yes

	show_sound = event_mystic_reveal_light
	picture = GFX_evt_surreal_visions

	immediate = {
		set_country_flag = established_contact_with_grandbunny
		set_country_flag = grandbunny_waiting_for_answer
	}

	option = { #kk
		name = "giga_blokkat.3309.a"
	}
}

#CONTACTING GRANDBUNNY BEFORE DEAL
country_event = {
	id = giga_blokkat.3310
	title = "giga_blokkat.3310.name"
	desc = "giga_blokkat.3310.desc"
	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = event_target:grandbunnyportrait
		room = paluush_grandbunny_room
	}

	option = { #kk
		name = "giga_blokkat.3310.a"
		trigger = {
			NOR = {
				has_valid_civic = civic_machine_terminator
				has_valid_civic = civic_fanatic_purifiers
				has_valid_civic = civic_hive_devouring_swarm
			}
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3311 }
		}
	}

	option = { #kk
		name = "giga_blokkat.3310.ageno"
		custom_tooltip = "giga_blokkat.3310.ageno.tooltip"
		trigger = {
			OR = {
				has_valid_civic = civic_machine_terminator
				has_valid_civic = civic_fanatic_purifiers
				has_valid_civic = civic_hive_devouring_swarm
			}
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3311 }
		}
	}

	option = { #wait
		name = "giga_blokkat.3310.b"
		default_hide_option = yes
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
			remove_country_flag = talking_to_grandbunny
		}
	}

	option = { #no
		name = "giga_blokkat.3310.c"
		custom_tooltip = "giga_blokkat.3310.c.tooltip"
		response_text = "giga_blokkat.3310.c.response"
		hidden_effect = {
			remove_country_flag = paluush_event_chain_ongoing
			remove_country_flag = established_contact_with_grandbunny
			remove_country_flag = monitoring_blokkats
			remove_country_flag = talking_to_grandbunny
		}
	}
}

country_event = {
	id = giga_blokkat.3311
	title = "giga_blokkat.3311.name"
	desc = "giga_blokkat.3311.desc"
	is_triggered_only = yes

	picture = GFX_evt_surreal_visions
	show_sound = event_big_door_opening

	option = { #kk
		name = "giga_blokkat.3311.a"
		add_modifier = {
			modifier = paluush_grandarchives_payment
			days = -1
		}
		event_target:paluushia = {
			create_archaeological_site = site_paluushia
			solar_system = {
				if = {
					limit = {
						exists = starbase
						starbase = { owner = { NOT = { is_country = ROOT } } }
					}
					starbase = { set_owner = ROOT }
				}
				if = {
					limit = {
						NOT = { exists = starbase }
					}
					create_starbase = {
						size = starbase_outpost
						owner = root
					}				
				}
			}
		}
		hidden_effect = {
			remove_country_flag = grandbunny_waiting_for_answer
			set_country_flag = grand_archive_dig_ongoing
			remove_country_flag = monitoring_blokkats
			remove_country_flag = talking_to_grandbunny
		}
	}
}

#CONTACTING GRANDBUNNY DURING DIG
country_event = {
	id = giga_blokkat.3312
	title = "giga_blokkat.3312.name"
	desc = "giga_blokkat.3312.desc"
	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = event_target:grandbunnyportrait
		room = paluush_grandbunny_room
	}

	option = { #we want to talk
		name = "giga_blokkat.3312.a"
		hidden_effect = {
			country_event = { id = giga_blokkat.3313 }
		}
	}

	option = { #bye
		name = "giga_blokkat.3312.b"
		default_hide_option = yes
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
			remove_country_flag = talking_to_grandbunny
		}
	}
}

#Talk
country_event = {
	id = giga_blokkat.3313
	title = "giga_blokkat.3313.name"
	desc = "giga_blokkat.3313.desc"
	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = event_target:grandbunnyportrait
		room = paluush_grandbunny_room
	}

	option = { #what are you??
		name = "giga_blokkat.3308.e"
		response_text = "giga_blokkat.3308.e.response"
		is_dialog_only = yes
	}

	option = { #the conflict?
		name = "giga_blokkat.3308.a"
		response_text = "giga_blokkat.3308.a.response"
		is_dialog_only = yes
	}

	option = { #you know about them?
		name = "giga_blokkat.3308.b"
		response_text = "giga_blokkat.3308.b.response"
		is_dialog_only = yes
	}

	option = { #why shield?
		name = "giga_blokkat.3308.c"
		response_text = "giga_blokkat.3308.c.response"
		is_dialog_only = yes
	}

	option = { #bye
		name = "giga_blokkat.3312.b"
		default_hide_option = yes
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
			remove_country_flag = talking_to_grandbunny
		}
	}
}

#PART 1
fleet_event = {
	id = giga_blokkat.3314
	title = "giga_blokkat.3314.name"
	desc = "giga_blokkat.3314.desc"

	picture = GFX_evt_alien_cavemen
	archaeology = yes
	show_sound = event_dig_site

	is_triggered_only = yes

	immediate = { fromfrom = { set_site_progress_locked = yes } }

	option = { #what!
		name = "giga_blokkat.3314.a"
		owner = { small_artifact_reward = yes }
		hidden_effect = {
			fromfrom = { set_site_progress_locked = no }
		}
	}
}

#PART 2
fleet_event = {
	id = giga_blokkat.3315
	title = "giga_blokkat.3315.name"
	desc = "giga_blokkat.3315.desc"

	picture = GFX_evt_medieval_alien_civilization
	archaeology = yes
	show_sound = event_dig_site

	is_triggered_only = yes

	immediate = {	fromfrom = { set_site_progress_locked = yes } }

	option = { #what!
		name = "giga_blokkat.3315.a"
		custom_tooltip = "giga_blokkat.3315.a.tooltip"
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = 6
			}
		}
		hidden_effect = {
			owner = {
				change_variable = {
					which = blokkat_knowledge_value
					value = 1
				}
				change_variable = {
					which = blokkat_knowledge_earned_by_paluush
					value = 1
				}
			}
			fromfrom = { set_site_progress_locked = no }
		}
	}
}

#PART 3
fleet_event = {
	id = giga_blokkat.3316
	title = "giga_blokkat.3316.name"
	desc = "giga_blokkat.3316.desc"

	picture = GFX_evt_ground_combat
	archaeology = yes
	show_sound = event_dig_site

	is_triggered_only = yes

	immediate = { fromfrom = { set_site_progress_locked = yes } }

	option = { #what!
		name = "giga_blokkat.3316.a"
		owner = { 
			small_artifact_reward = yes
			add_modifier = {
				modifier = old_blokkat_plasma_gun
				days = -1
			} 
		}
		hidden_effect = {
			fromfrom = { set_site_progress_locked = no }
		}
	}
}

#PART 3.5
fleet_event = {
	id = giga_blokkat.33161
	title = "giga_blokkat.33161.name"
	desc = "giga_blokkat.33161.desc"

	picture = GFX_evt_assembly_fight
	archaeology = yes
	show_sound = event_dig_site

	is_triggered_only = yes

	immediate = { fromfrom = { set_site_progress_locked = yes } }

	option = { #what!
		name = "giga_blokkat.33161.a"
		owner = { 
			small_artifact_reward = yes
		}
		hidden_effect = {
			fromfrom = { set_site_progress_locked = no }
		}
	}
}

#PART 4
fleet_event = {
	id = giga_blokkat.3317
	title = "giga_blokkat.3317.name"
	desc = {
		text = "giga_blokkat.3317.desc"
		trigger = { NOT = { has_global_flag = meopa_spawned_as_fe } }
	}
	desc = { #Something is missing...
		text = "giga_blokkat.3317.nokatzens.desc"
		trigger = {
			OR = { 
				has_global_flag = nice_gatzo_fe 
				has_global_flag = pouchkinn_gatzo_fe 
			} 
		}
	}
	desc = { #Something is missing...
		text = "giga_blokkat.3317.evilmeopa.desc"
		trigger = { has_global_flag = evil_gatzo_fe }
	}

	picture = GFX_evt_colony_settlement
	archaeology = yes
	show_sound = event_dig_site

	is_triggered_only = yes

	immediate = { fromfrom = { set_site_progress_locked = yes } }

	option = { #what!
		name = "giga_blokkat.3317.a"
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = 12
			}
		}
		hidden_effect = {
			fromfrom = { set_site_progress_locked = no }
		}
	}
}

#PART 5
fleet_event = {
	id = giga_blokkat.3318
	title = "giga_blokkat.3318.name"
	desc = "giga_blokkat.3318.desc"

	picture = GFX_evt_city_planet
	archaeology = yes
	show_sound = event_dig_site

	is_triggered_only = yes

	immediate = { fromfrom = { set_site_progress_locked = yes } }

	option = { #what!
		name = "giga_blokkat.3318.a"
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = 12
			}
		}
		hidden_effect = {
			fromfrom = { set_site_progress_locked = no }
		}
	}
}

#PART 6
fleet_event = {
	id = giga_blokkat.3319
	title = "giga_blokkat.3319.name"
	desc = "giga_blokkat.3319.desc"

	picture = GFX_evt_supernova
	archaeology = yes
	show_sound = event_dig_site

	is_triggered_only = yes

	immediate = { fromfrom = { set_site_progress_locked = yes } }

	option = { #what!
		name = "giga_blokkat.3319.a"
		custom_tooltip = "giga_blokkat.3315.a.tooltip"
		owner = { 
			medium_artifact_reward = yes
		}
		hidden_effect = {
			owner = {
				change_variable = {
					which = blokkat_knowledge_value
					value = 1
				}
				change_variable = {
					which = blokkat_knowledge_earned_by_paluush
					value = 1
				}
			}
			fromfrom = { set_site_progress_locked = no }
		}
	}
}

#PART 7
fleet_event = {
	id = giga_blokkat.3320
	title = "giga_blokkat.3320.name"
	desc = "giga_blokkat.3320.desc"

	picture = GFX_evt_ringworld
	archaeology = yes
	show_sound = event_dig_site

	is_triggered_only = yes

	immediate = { fromfrom = { set_site_progress_locked = yes } }

	option = { #what!
		name = "giga_blokkat.3320.a"
		custom_tooltip = "giga_blokkat.3320.a.tooltip"
		hidden_effect = {
			owner = {
				change_variable = {
					which = blokkat_knowledge_value
					value = 1
				}
				change_variable = {
					which = blokkat_knowledge_earned_by_paluush
					value = 1
				}
				change_variable = {
					which = blokkat_scrap_value
					value = 50
				}
			}
			fromfrom = { set_site_progress_locked = no }
		}
	}
}

#PART 8
fleet_event = {
	id = giga_blokkat.3321
	title = "giga_blokkat.3321.name"
	desc = {
		text = "giga_blokkat.3321.desc"
		trigger = { NOT = { has_global_flag = meopa_spawned_as_fe } }
	}
	desc = { #Something is missing...
		text = "giga_blokkat.3321.nokatzens.desc"
		trigger = { has_global_flag = meopa_spawned_as_fe }
	}

	picture = GFX_evt_planet_beam
	archaeology = yes
	show_sound = event_dig_site

	is_triggered_only = yes

	immediate = { fromfrom = { set_site_progress_locked = yes } }

	option = { #what!
		name = "giga_blokkat.3321.a"
		owner = { 
			add_resource = {
				influence = 250
			}
			add_monthly_resource_mult = {
				resource = unity
				value = 24
			}
			add_monthly_resource_mult = {
				resource = engineering_research
				value = 12
			}
			add_monthly_resource_mult = {
				resource = society_research
				value = 12
			}
			add_monthly_resource_mult = {
				resource = physics_research
				value = 12
			}
		}
		hidden_effect = {
			owner = {
				set_country_flag = monitoring_blokkats
				set_country_flag = talking_to_grandbunny
				country_event = { id = giga_blokkat.3322 }
			}
			fromfrom = { set_site_progress_locked = no }
		}
	}
}

country_event = {
	id = giga_blokkat.3322
	title = "giga_blokkat.3322.name"
	desc = "giga_blokkat.3322.desc"
	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = event_target:grandbunnyportrait
		room = paluush_grandbunny_room
	}

	after = { country_event = { id = giga_blokkat.3323 } }

	option = { #bye
		name = "giga_blokkat.3322.a"
		default_hide_option = yes
		remove_modifier = paluush_grandarchives_payment
		hidden_effect = {
			remove_country_flag = grand_archive_dig_ongoing
			set_country_flag = grand_archive_dig_done
			remove_country_flag = monitoring_blokkats
			remove_country_flag = talking_to_grandbunny
		}
	}

	option = { #bye
		name = "giga_blokkat.3322.b"
		custom_tooltip = "giga_blokkat.3322.b.tooltip"
		default_hide_option = yes
		remove_modifier = paluush_grandarchives_payment
		remove_modifier = the_paluushian_exception
		trigger = {
			OR = {
				has_valid_civic = civic_machine_terminator
				has_valid_civic = civic_fanatic_purifiers
				has_valid_civic = civic_hive_devouring_swarm
			}
		}
		hidden_effect = {
			remove_country_flag = grand_archive_dig_ongoing
			remove_country_flag = paluush_event_chain_ongoing
			remove_country_flag = monitoring_blokkats
			remove_country_flag = talking_to_grandbunny
		}
	}
}

country_event = {
	id = giga_blokkat.3323
	title = "giga_blokkat.3323.name"
	desc = "giga_blokkat.3323.desc"
	is_triggered_only = yes

	picture = GFX_evt_surreal_visions
	show_sound = event_laboratory_sound
	immediate = {
		set_country_flag = blokkat_history_possible
	}
	option = { #kk
		name = "giga_blokkat.3323.a"
		add_research_option = giga_tech_blokkat_history
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
			remove_country_flag = talking_to_grandbunny
		}
	}
}

country_event = {
	id = giga_blokkat.3324
	title = "giga_blokkat.3324.name"
	desc = "giga_blokkat.3324.desc"
	is_triggered_only = yes

	picture = GFX_evt_decryption
	show_sound = event_yellow_alert

	trigger = {
		last_increased_tech = giga_tech_blokkat_history
	}

	immediate = {
		change_variable = {
			which = blokkat_knowledge_value
			value = 4
		}
		change_variable = {
			which = blokkat_knowledge_earned_by_paluush
			value = 4
		}
	}

	option = { #heck??
		name = "giga_blokkat.3324.a"
		custom_tooltip = "giga_blokkat.3324.a.tooltip"
		hidden_effect = {
			set_country_flag = can_do_blokkat_timetravel_project
		}
	}
}

country_event = {
	id = giga_blokkat.3325
	title = "giga_blokkat.3325.name"
	desc = "giga_blokkat.3325.desc"
	is_triggered_only = yes

	picture = GFX_evt_clocks
	show_sound = event_laboratory_sound

	option = { #heck??
		name = "giga_blokkat.3325.a"
		custom_tooltip = "giga_blokkat.3325.a.tooltip"
		enable_special_project = {
			name = INVESTIGATE_BLOKKAT_DISCREPANCY
			owner = ROOT
		}
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
			set_country_flag = blokkat_project_underway
			subtract_variable = {
				which = blokkat_scrap_value
				value = 150
			}
		}
	}

	option = { #nvm
		name = "giga_blokkat.3020.b"
		hidden_effect = {
			country_event = { id = giga_blokkat.3000 }
		}
	}
}

country_event = {
	id = giga_blokkat.3326
	title = "giga_blokkat.3326.name"
	desc = "giga_blokkat.3326.desc"
	is_triggered_only = yes

	picture = GFX_evt_clocks
	show_sound = event_mystic_reveal_light

	immediate = {
		remove_country_flag = blokkat_project_underway
		set_country_flag = blokkat_temporal_discrepancy_solved
	}

	option = { #wtf
		name = "giga_blokkat.3326.a"
		custom_tooltip = "giga_blokkat.3326.a.tooltip"
		add_research_option = giga_tech_blokkat_timetravel
	}
}


country_event = {
	id = giga_blokkat.3327
	is_triggered_only = yes

	hide_window = yes

	trigger = {
		last_increased_tech = giga_tech_blokkat_timetravel
	}

	immediate = {
		change_variable = {
			which = blokkat_knowledge_value
			value = 4
		}
		change_variable = {
			which = blokkat_knowledge_earned_by_paluush
			value = 4
		}
	}
}

country_event = {
	id = giga_blokkat.3328
	title = "giga_blokkat.3328.name"
	desc = "giga_blokkat.3328.desc"
	is_triggered_only = yes

	picture = GFX_evt_clocks
	show_sound = event_sensor_ping

	option = { #wtf
		name = "giga_blokkat.3328.a"
		custom_tooltip = "giga_blokkat.3328.a.tooltip"
		hidden_effect = {
			set_country_flag = unlocked_final_blokkat_mega_stage
		}
	}
}


#stage 5 of mega
country_event = {
	id = giga_blokkat.3329
	title = "giga_blokkat.3329.name"
	desc = "giga_blokkat.3329.desc"
	is_triggered_only = yes
	show_sound = event_sensor_ping
	picture = GFX_evt_clocks
	immediate = {
		set_country_flag = destabiliser_stage_4_possible
	}
	option = { #kk
		name = "giga_blokkat.3329.a"
		custom_tooltip = "giga_blokkat.3329.a.tooltip"
		add_research_option = giga_tech_blokkat_mega_stage_4
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
			set_country_flag = blokkat_project_underway
		}
	}

	option = { #nvm
		name = "giga_blokkat.3020.b"
		hidden_effect = {
			country_event = { id = giga_blokkat.3000 }
			remove_country_flag = destabiliser_stage_4_possible
		}
	}
}

country_event = {
	id = giga_blokkat.3330
	is_triggered_only = yes

	hide_window = yes

	trigger = {	
		last_increased_tech = giga_tech_blokkat_mega_stage_4
	}

	immediate = {
		remove_country_flag = blokkat_project_underway
		set_country_flag = blokkat_mega_stage_4_researched
	}
}

#CONTACTING GRANDBUNNY AFTER DIG
country_event = {
	id = giga_blokkat.3331
	title = "giga_blokkat.3312.name"
	desc = "giga_blokkat.3331.desc"
	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = event_target:grandbunnyportrait
		room = paluush_grandbunny_room
	}

	option = { #what power do you have??
		name = "giga_blokkat.3331.power"
		response_text = "giga_blokkat.3331.power.response"
		is_dialog_only = yes
	}

	option = { #we want to talk
		name = "giga_blokkat.3312.a"
		hidden_effect = {
			country_event = { id = giga_blokkat.3313 }
		}
	}

	option = { #bye
		name = "giga_blokkat.3312.b"
		default_hide_option = yes
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
			remove_country_flag = talking_to_grandbunny
		}
	}
}

country_event = {
	id = giga_blokkat.3332
	title = "giga_blokkat.3332.name"
	desc = "giga_blokkat.3332.desc"
	is_triggered_only = yes

	picture = GFX_evt_surreal_visions
	show_sound = event_mystic_reveal

	immediate = {
		event_target:grandbunny_shielded_system = {
			every_ambient_object = {
				limit = { has_ambient_object_flag = grandbunny_shielding_system }
				destroy_ambient_object = THIS
			}
			remove_star_flag = forbid_blokkat_stripmine
		}
	}

	option = { #bye
		name = "giga_blokkat.3332.a"
		hidden_effect = {
			country_event = { id = giga_blokkat.3333 days = 180 }
		}
	}
}


country_event = {
	id = giga_blokkat.3333
	title = "giga_blokkat.3333.name"
	desc = "giga_blokkat.3333.desc"
	is_triggered_only = yes

	picture = GFX_evt_surreal_visions
	show_sound = event_mystic_reveal

	option = { #bye
		name = "giga_blokkat.3333.a"
		hidden_effect = {
			remove_global_flag = grandbunny_shielding_system
		}
	}
}

#Paluushia is gone :(

country_event = {
	id = giga_blokkat.3334
	title = "giga_blokkat.3334.name"
	desc = "giga_blokkat.3334.desc"
	is_triggered_only = yes

	picture = GFX_evt_exploding_planet
	show_sound = event_structural_collapse

	option = { #bye
		name = "giga_blokkat.3334.a"
		hidden_effect = {
			if = {
				limit = { has_modifier = the_paluushian_exception }
				remove_modifier = the_paluushian_exception
			}
			if = {
				limit = { has_modifier = paluush_grandarchives_payment }
				remove_modifier = paluush_grandarchives_payment
			}
			if = {
				limit = { has_country_flag = established_contact_with_grandbunny }
				remove_country_flag = established_contact_with_grandbunny
			}
			if = {
				limit = { has_country_flag = grandbunny_waiting_for_answer }
				remove_country_flag = grandbunny_waiting_for_answer
			}
			if = {
				limit = { has_country_flag = grand_archive_dig_ongoing }
				remove_country_flag = grand_archive_dig_ongoing
			}
			if = {
				limit = { has_country_flag = grand_archive_dig_done }
				remove_country_flag = grand_archive_dig_done
			}
			if = {
				limit = { has_country_flag = paluush_event_chain_ongoing }
				remove_country_flag = paluush_event_chain_ongoing
			}
			if = {
				limit = { has_global_flag = waiting_to_kill_paluushia_manifestation }
				remove_global_flag = waiting_to_kill_paluushia_manifestation
			}
		}
	}
}

country_event = {
	id = giga_blokkat.3335
	title = "giga_blokkat.3335.name"
	desc = "giga_blokkat.3335.desc"
	is_triggered_only = yes

	picture = GFX_evt_medieval_alien_civilization
	show_sound = event_mystic_reveal

	immediate = {
		remove_country_flag = established_contact_with_grandbunny
		remove_country_flag = paluush_event_chain_ongoing
	}

	option = { #bye
		name = "giga_blokkat.3335.a"
		custom_tooltip = "giga_blokkat.3335.a.tooltip"
		hidden_effect = {
			if = {
				limit = { has_modifier = the_paluushian_exception }
				remove_modifier = the_paluushian_exception
			}
			event_target:paluushia = {
				change_pc = pc_continental
				generate_paluush_primitives_on_planet = yes
			}
			event_target:paluush_portrait = {
				add_modifier = {
					modifier = post_blokkat_paluush_buff
					days = -1
				}
			}
		}
	}
}

##FIX##

country_event = {
	id = giga_blokkat.3350
	title = "giga_blokkat.3350.name"
	desc = "giga_blokkat.3350.desc"
	is_triggered_only = yes

	picture = GFX_evt_decryption
	show_sound = event_mystic_reveal

	immediate = {
		set_country_flag = can_research_blokkat_star_repair
	}

	option = { #bye
		name = "giga_blokkat.3350.a"
		custom_tooltip = "giga_blokkat.3350.a.tooltip"
	}
}


country_event = {
	id = giga_blokkat.3351
	title = "giga_blokkat.3351.name"
	desc = "giga_blokkat.3351.desc"
	is_triggered_only = yes

	picture = GFX_evt_vortex
	show_sound = event_ai_started

	immediate = {
		set_country_flag = can_research_blokkat_star_repair
		set_country_flag = blokkat_system_repair_possible
	}

	option = { #bye
		name = "giga_blokkat.3351.a"
		custom_tooltip = "giga_blokkat.3351.a.tooltip"
		custom_tooltip = cant_do_another_blokkat_project_tech_tooltip
		add_research_option = giga_tech_blokkat_fix_systems
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
			set_country_flag = blokkat_project_underway
		}
	}

	option = { #nvm
		name = "giga_blokkat.3020.b"
		hidden_effect = {
			country_event = { id = giga_blokkat.3000 }
			remove_country_flag = blokkat_system_repair_possible
		}
	}
}

country_event = {
	id = giga_blokkat.3352
	title = "giga_blokkat.3352.name"
	desc = "giga_blokkat.3352.desc"
	show_sound = event_laboratory_sound
	picture = GFX_evt_vortex
	is_triggered_only = yes

	trigger = {	
		last_increased_tech = giga_tech_blokkat_fix_systems
	}

	option = { #kk
		name = "giga_blokkat.3352.a"
		custom_tooltip = can_do_another_blokkat_project_tooltip
		hidden_effect = {
			set_country_flag = blokkat_star_repair_researched
			remove_country_flag = blokkat_project_underway
		}
	}
}

country_event = {
	id = giga_blokkat.3353
	title = "giga_blokkat.3353.name"
	desc = "giga_blokkat.3353.desc"
	show_sound = event_dyson_sphere_build_start
	picture = GFX_evt_vortex
	is_triggered_only = yes
	location = event_target:giga_system

	option = { #kk
		name = "giga_blokkat.3353.a"
	}
}

country_event = {
	id = giga_blokkat.3354
	title = "giga_blokkat.3354.name"
	desc = "giga_blokkat.3354.desc"
	show_sound = event_dyson_sphere_build_upgrade_panel
	picture = GFX_evt_vortex
	is_triggered_only = yes
	location = event_target:giga_system

	option = { #kk
		name = "giga_blokkat.3353.a"
	}
}

country_event = {
	id = giga_blokkat.3355
	title = "giga_blokkat.3355.name"
	desc = "giga_blokkat.3355.desc"
	show_sound = event_activating_unknown_technology
	picture = GFX_evt_vortex
	is_triggered_only = yes
	location = event_target:giga_system

	option = { #kk
		name = "giga_blokkat.3355.a"
	}
}

#REVERSE ENGINEER
country_event = {
	id = giga_blokkat.3090
	title = "giga_blokkat.3090.name"
	desc = "giga_blokkat.3090.desc"

	is_triggered_only = yes
	show_sound = event_activating_unknown_technology

	picture = GFX_evt_analyzing_artifacts

	option = { #Weapons!
		name = "giga_blokkat.3090.a"
		custom_tooltip = "giga_blokkat.3090.a.tooltip"
		trigger = {
			NAND = {
				has_technology = giga_tech_blokkat_laser
				has_technology = giga_tech_blokkat_missile
				has_technology = giga_tech_blokkat_strikecraft
			}
		}
		allow = {
			custom_tooltip = {
				fail_text = "needs_enough_blokkat_scrap"
				hidden_trigger = {
					check_variable = {
						which = blokkat_scrap_value
						value >= 100
					}
				}
			}
		}
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
			set_country_flag = blokkat_project_underway
			subtract_variable = {
				which = blokkat_scrap_value
				value = 100
			}
			random_list = {
				20 = {
					country_event = { id = giga_blokkat.3091 }
					modifier = {
						add = -20
						has_technology = giga_tech_blokkat_laser
					}
				}
				20 = {
					country_event = { id = giga_blokkat.3092 }
					modifier = {
						add = -20
						has_technology = giga_tech_blokkat_missile
					}
				}
				20 = {
					country_event = { id = giga_blokkat.3093 }
					modifier = {
						add = -20
						has_technology = giga_tech_blokkat_strikecraft
					}
				}
			}
		}
	}

	option = { #OP Weapons!
		name = "giga_blokkat.3090.b"
		custom_tooltip = "giga_blokkat.3090.b.tooltip"
		trigger = {
			NAND = {
				has_technology = giga_tech_blokkat_plasma
				has_technology = giga_tech_blokkat_emitter
				has_technology = giga_tech_blokkat_obliterator
			}
		}
		allow = {
			custom_tooltip = {
				fail_text = "needs_enough_blokkat_scrap"
				hidden_trigger = {
					check_variable = {
						which = blokkat_scrap_value
						value >= 150
					}
				}
			}
		}
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
			set_country_flag = blokkat_project_underway
			subtract_variable = {
				which = blokkat_scrap_value
				value = 150
			}
			random_list = {
				20 = {
					country_event = { id = giga_blokkat.3097 }
					modifier = {
						add = -20
						has_technology = giga_tech_blokkat_plasma
					}
				}
				20 = {
					country_event = { id = giga_blokkat.3098 }
					modifier = {
						add = -20
						has_technology = giga_tech_blokkat_emitter
					}
				}
				20 = {
					country_event = { id = giga_blokkat.3099 }
					modifier = {
						add = -20
						has_technology = giga_tech_blokkat_obliterator
					}
				}
			}
		}
	}

	option = { #Defence!
		name = "giga_blokkat.3090.c"
		custom_tooltip = "giga_blokkat.3090.c.tooltip"
		trigger = {
			NAND = {
				has_technology = giga_tech_blokkat_armor
				has_technology = giga_tech_blokkat_shield
				has_technology = giga_tech_blokkat_pd
			}
		}
		allow = {
			custom_tooltip = {
				fail_text = "needs_enough_blokkat_scrap"
				hidden_trigger = {
					check_variable = {
						which = blokkat_scrap_value
						value >= 80
					}
				}
			}
		}
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
			set_country_flag = blokkat_project_underway
			subtract_variable = {
				which = blokkat_scrap_value
				value = 80
			}
			random_list = {
				20 = {
					country_event = { id = giga_blokkat.3094 }
					modifier = {
						add = -20
						has_technology = giga_tech_blokkat_armor
					}
				}
				20 = {
					country_event = { id = giga_blokkat.3095 }
					modifier = {
						add = -20
						has_technology = giga_tech_blokkat_shield
					}
				}
				20 = {
					country_event = { id = giga_blokkat.3096 }
					modifier = {
						add = -20
						has_technology = giga_tech_blokkat_pd
					}
				}
			}
		}
	}

	option = { #Support!
		name = "giga_blokkat.3090.d"
		custom_tooltip = "giga_blokkat.3090.d.tooltip"
		trigger = {
			NAND = {
				has_technology = giga_tech_blokkat_booster
				has_technology = giga_tech_blokkat_afterburner
				has_technology = giga_tech_blokkat_hullrepair
			}
		}
		allow = {
			custom_tooltip = {
				fail_text = "needs_enough_blokkat_scrap"
				hidden_trigger = {
					check_variable = {
						which = blokkat_scrap_value
						value >= 70
					}
				}
			}
		}
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
			set_country_flag = blokkat_project_underway
			subtract_variable = {
				which = blokkat_scrap_value
				value = 70
			}
			random_list = {
				20 = {
					country_event = { id = giga_blokkat.3100 }
					modifier = {
						add = -20
						has_technology = giga_tech_blokkat_booster
					}
				}
				20 = {
					country_event = { id = giga_blokkat.3101 }
					modifier = {
						add = -20
						has_technology = giga_tech_blokkat_afterburner
					}
				}
				20 = {
					country_event = { id = giga_blokkat.3102 }
					modifier = {
						add = -20
						has_technology = giga_tech_blokkat_hullrepair
					}
				}
			}
		}
	}

	option = { #Core Comps!
		name = "giga_blokkat.3090.e"
		custom_tooltip = "giga_blokkat.3090.e.tooltip"
		trigger = {
			NAND = {
				has_technology = giga_tech_blokkat_ftl
				has_technology = giga_tech_blokkat_reactor
				has_technology = giga_tech_blokkat_computer
				has_technology = giga_tech_blokkat_sensors
			}
		}
		allow = {
			custom_tooltip = {
				fail_text = "needs_enough_blokkat_scrap"
				hidden_trigger = {
					check_variable = {
						which = blokkat_scrap_value
						value >= 50
					}
				}
			}
		}
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
			set_country_flag = blokkat_project_underway
			subtract_variable = {
				which = blokkat_scrap_value
				value = 50
			}
			random_list = {
				20 = {
					country_event = { id = giga_blokkat.3103 }
					modifier = {
						add = -20
						has_technology = giga_tech_blokkat_ftl
					}
				}
				20 = {
					country_event = { id = giga_blokkat.3104 }
					modifier = {
						add = -20
						has_technology = giga_tech_blokkat_reactor
					}
				}
				20 = {
					country_event = { id = giga_blokkat.3105 }
					modifier = {
						add = -20
						has_technology = giga_tech_blokkat_computer
					}
				}
				20 = {
					country_event = { id = giga_blokkat.3106 }
					modifier = {
						add = -20
						has_technology = giga_tech_blokkat_sensors
					}
				}
			}
		}
	}

	option = { #nvm
		name = "giga_blokkat.3020.b"
		hidden_effect = {
			country_event = { id = giga_blokkat.3000 }
		}
	}
}

#Lasers
country_event = {
	id = giga_blokkat.3091
	title = "giga_blokkat.3091.name"
	desc = "giga_blokkat.3091.desc"

	is_triggered_only = yes
	show_sound = event_mystic_reveal

	picture = GFX_evt_ship_travel
	immediate = {
		set_country_flag = blokkat_laser_possible
	}
	option = { #kk
		name = "giga_blokkat.3091.a"
		add_research_option = giga_tech_blokkat_laser
	}
}

#Missile
country_event = {
	id = giga_blokkat.3092
	title = "giga_blokkat.3092.name"
	desc = "giga_blokkat.3092.desc"

	is_triggered_only = yes
	show_sound = event_mystic_reveal

	picture = GFX_evt_black_hole
	immediate = {
		set_country_flag = blokkat_missile_possible
	}
	option = { #kk
		name = "giga_blokkat.3091.a"
		add_research_option = giga_tech_blokkat_missile
	}
}

#HANGAR
country_event = {
	id = giga_blokkat.3093
	title = "giga_blokkat.3093.name"
	desc = "giga_blokkat.3093.desc"

	is_triggered_only = yes
	show_sound = event_mystic_reveal

	picture = GFX_evt_machine_space_battle
	immediate = {
		set_country_flag = blokkat_strikecraft_possible
	}
	option = { #kk
		name = "giga_blokkat.3091.a"
		add_research_option = giga_tech_blokkat_strikecraft
	}
}

#Armor
country_event = {
	id = giga_blokkat.3094
	title = "giga_blokkat.3094.name"
	desc = "giga_blokkat.3094.desc"

	is_triggered_only = yes
	show_sound = event_mystic_reveal

	picture = GFX_evt_megastructure_construction
	immediate = {
		set_country_flag = blokkat_armor_possible
	}
	option = { #kk
		name = "giga_blokkat.3094.a"
		add_research_option = giga_tech_blokkat_armor
	}
}

#Shield
country_event = {
	id = giga_blokkat.3095
	title = "giga_blokkat.3095.name"
	desc = "giga_blokkat.3095.desc"

	is_triggered_only = yes
	show_sound = event_mystic_reveal

	picture = GFX_evt_physics_research
	immediate = {
		set_country_flag = blokkat_shield_possible
	}
	option = { #kk
		name = "giga_blokkat.3095.a"
		add_research_option = giga_tech_blokkat_shield
	}
}

#PD
country_event = {
	id = giga_blokkat.3096
	title = "giga_blokkat.3096.name"
	desc = "giga_blokkat.3096.desc"

	is_triggered_only = yes
	show_sound = event_mystic_reveal

	picture = GFX_evt_sentry_guns
	immediate = {
		set_country_flag = blokkat_pd_possible
	}
	option = { #kk
		name = "giga_blokkat.3096.a"
		add_research_option = giga_tech_blokkat_pd
	}
}

#Plasma
country_event = {
	id = giga_blokkat.3097
	title = "giga_blokkat.3097.name"
	desc = "giga_blokkat.3097.desc"

	is_triggered_only = yes
	show_sound = event_mystic_reveal

	picture = GFX_evt_planet_beam
	immediate = {
		set_country_flag = blokkat_plasma_possible
	}
	option = { #kk
		name = "giga_blokkat.3097.a"
		add_research_option = giga_tech_blokkat_plasma
	}
}

#Emitter
country_event = {
	id = giga_blokkat.3098
	title = "giga_blokkat.3098.name"
	desc = "giga_blokkat.3098.desc"

	is_triggered_only = yes
	show_sound = event_mystic_reveal

	picture = GFX_evt_physics_research
	immediate = {
		set_country_flag = blokkat_emitter_possible
	}
	option = { #kk
		name = "giga_blokkat.3098.a"
		add_research_option = giga_tech_blokkat_emitter
	}
}

#Obliterator
country_event = {
	id = giga_blokkat.3099
	title = "giga_blokkat.3099.name"
	desc = "giga_blokkat.3099.desc"

	is_triggered_only = yes
	show_sound = event_mystic_reveal

	picture = GFX_evt_supernova
	immediate = {
		set_country_flag = blokkat_obliterator_possible
	}
	option = { #kk
		name = "giga_blokkat.3099.a"
		add_research_option = giga_tech_blokkat_obliterator
	}
}

#Booster
country_event = {
	id = giga_blokkat.3100
	title = "giga_blokkat.3100.name"
	desc = "giga_blokkat.3100.desc"

	is_triggered_only = yes
	show_sound = event_mystic_reveal

	picture = GFX_evt_laser_grid
	immediate = {
		set_country_flag = blokkat_booster_possible
	}
	option = { #kk
		name = "giga_blokkat.3100.a"
		add_research_option = giga_tech_blokkat_booster
	}
}

#Afterburner
country_event = {
	id = giga_blokkat.3101
	title = "giga_blokkat.3101.name"
	desc = "giga_blokkat.3101.desc"

	is_triggered_only = yes
	show_sound = event_mystic_reveal

	picture = GFX_evt_machine_space_battle
	immediate = {
		set_country_flag = blokkat_afterburner_possible
	}
	option = { #kk
		name = "giga_blokkat.3101.a"
		add_research_option = giga_tech_blokkat_afterburner
	}
}

#Hull repair
country_event = {
	id = giga_blokkat.3102
	title = "giga_blokkat.3102.name"
	desc = "giga_blokkat.3102.desc"

	is_triggered_only = yes
	show_sound = event_mystic_reveal

	picture = GFX_evt_robot_assembly_plant
	immediate = {
		set_country_flag = blokkat_hull_repair_possible
	}
	option = { #kk
		name = "giga_blokkat.3102.a"
		add_research_option = giga_tech_blokkat_hullrepair
	}
}

#FTL
country_event = {
	id = giga_blokkat.3103
	title = "giga_blokkat.3103.name"
	desc = "giga_blokkat.3103.desc"

	is_triggered_only = yes
	show_sound = event_mystic_reveal

	picture = GFX_evt_binary_stars
	immediate = {
		set_country_flag = blokkat_ftl_possible
	}
	option = { #kk
		name = "giga_blokkat.3103.a"
		add_research_option = giga_tech_blokkat_ftl
	}
}

#Reactor
country_event = {
	id = giga_blokkat.3104
	title = "giga_blokkat.3104.name"
	desc = "giga_blokkat.3104.desc"

	is_triggered_only = yes
	show_sound = event_mystic_reveal

	picture = GFX_evt_physics_research
	immediate = {
		set_country_flag = blokkat_reactor_possible
	}
	option = { #kk
		name = "giga_blokkat.3104.a"
		add_research_option = giga_tech_blokkat_reactor
	}
}

#Computer
country_event = {
	id = giga_blokkat.3105
	title = "giga_blokkat.3105.name"
	desc = "giga_blokkat.3105.desc"

	is_triggered_only = yes
	show_sound = event_mystic_reveal

	picture = GFX_evt_sapient_AI
	immediate = {
		set_country_flag = blokkat_computer_possible
	}
	option = { #kk
		name = "giga_blokkat.3105.a"
		add_research_option = giga_tech_blokkat_computer
	}
}

#Sensors
country_event = {
	id = giga_blokkat.3106
	title = "giga_blokkat.3106.name"
	desc = "giga_blokkat.3106.desc"

	is_triggered_only = yes
	show_sound = event_mystic_reveal

	picture = GFX_evt_mysterious_signal
	immediate = {
		set_country_flag = blokkat_sensors_possible
	}
	option = { #kk
		name = "giga_blokkat.3106.a"
		add_research_option = giga_tech_blokkat_sensors
	}
}


#Component reverse-engineered
country_event = {
	id = giga_blokkat.30900
	is_triggered_only = yes

	hide_window = yes

	trigger = {
		OR = {
			last_increased_tech = giga_tech_blokkat_laser
			last_increased_tech = giga_tech_blokkat_missile
			last_increased_tech = giga_tech_blokkat_strikecraft
			last_increased_tech = giga_tech_blokkat_armor
			last_increased_tech = giga_tech_blokkat_shield
			last_increased_tech = giga_tech_blokkat_pd
			last_increased_tech = giga_tech_blokkat_plasma
			last_increased_tech = giga_tech_blokkat_emitter
			last_increased_tech = giga_tech_blokkat_obliterator
			last_increased_tech = giga_tech_blokkat_hullrepair
			last_increased_tech = giga_tech_blokkat_booster
			last_increased_tech = giga_tech_blokkat_afterburner
			last_increased_tech = giga_tech_blokkat_ftl
			last_increased_tech = giga_tech_blokkat_reactor
			last_increased_tech = giga_tech_blokkat_computer
			last_increased_tech = giga_tech_blokkat_sensors
		}
	}

	immediate = {
		remove_country_flag = blokkat_project_underway
		change_variable = {
			which = blokkat_knowledge_value
			value = 0.5
		}
		change_variable = {
			which = blokkat_knowledge_earned_by_repeatables
			value = 0.5
		}
		if = {
			limit = { has_country_flag = blokkat_willingness_active }
			change_variable = {
				which = blokkat_willingness_military_value
				value = 2.5
			}
			update_blokkat_willingness_value = yes
		}
	}
}

#when ship is sent to empty system
country_event = {
	id = giga_blokkat.3070
	is_triggered_only = yes
	show_sound = event_radio_chatter
	title = "giga_blokkat.3070.name"
	desc = "giga_blokkat.3070.desc"

	picture = GFX_evt_space_debris

	immediate = {
		set_country_flag = blokkat_ship_sent_to_system
	}

	option = { #kk
		name = "giga_blokkat.3070.a"
		custom_tooltip = "giga_blokkat.3070.a.tooltip"
		hidden_effect = {
			change_variable = {
				which = blokkat_knowledge_value
				value = 1
			}
			change_variable = {
				which = blokkat_knowledge_earned_by_system
				value = 1
			}
		}
	}
}

#BLOKKAT CAPTURE
country_event = {
	id = giga_blokkat.3200
	title = "giga_blokkat.3200.name"
	desc = "giga_blokkat.3200.desc"

	is_triggered_only = yes

	show_sound = event_radio_chatter
	picture = GFX_evt_analyzing_artifacts

	immediate = {
		set_country_flag = blokkat_capture_project_started
	}

	option = { #kk
		name = "giga_blokkat.3200.a"
		custom_tooltip = "giga_blokkat.3200.a.tooltip"
	}
}

country_event = {
	id = giga_blokkat.3201
	title = "giga_blokkat.3201.name"
	desc = "giga_blokkat.3201.desc"

	is_triggered_only = yes

	show_sound = event_mystic_reveal_light
	picture = GFX_evt_alien_abduction
	immediate = {
		set_country_flag = blokkat_snare_possible
	}
	option = { #kk
		name = "giga_blokkat.3201.a"
		custom_tooltip = "giga_blokkat.3201.a.tooltip"
		add_research_option = giga_tech_blokkat_snare
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
			set_country_flag = blokkat_project_underway
		}
	}

	option = { #nvm
		name = "giga_blokkat.3201.b"
		hidden_effect = {
			country_event = { id = giga_blokkat.3000 }
			remove_country_flag = blokkat_snare_possible
		}
	}
}

country_event = {
	id = giga_blokkat.3202
	title = "giga_blokkat.3202.name"
	desc = "giga_blokkat.3202.desc"

	is_triggered_only = yes

	show_sound = event_machinery
	picture = GFX_evt_binary_stars

	trigger = {
		last_increased_tech = giga_tech_blokkat_snare
	}

	immediate = {
		set_variable = {
			which = captured_blokkat_count
			value = 0
		}
		set_variable = {
			which = blokkat_knowledge_earned_by_capture
			value = 0
		}
		set_variable = {
			which = blokkat_containment_ec_cost_base
			value = 100000
		}
		set_country_flag = blokkat_capture_project_researched
	}

	option = { #kk
		name = "giga_blokkat.3202.a"
		custom_tooltip = "giga_blokkat.3202.a.tooltip"
		hidden_effect = {
			remove_country_flag = blokkat_project_underway
		}
	}
}

#YEARLY EVENT: VISITING BLOKKAT & BREACHES#
country_event = {
	id = giga_blokkat.3203
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		is_ai = no
		has_country_flag = blokkat_capture_project_researched
	}

	immediate = {
		if = {
			limit = { 
				any_owned_megastructure = { is_megastructure_type = blokkat_prison_1_empty }
				NOT = { has_country_flag = currently_fighting_blokkat }
				NOT = { has_country_flag = recent_blokkat_sighting }
				NOT = { has_global_flag = blokkat_crisis_defeated }
			}
			every_owned_planet = {
				limit = { 
					is_colony = yes
					has_ground_combat = no
					NOT = { has_planet_flag = recent_blokkat_sighting }
				}
				random_list = {
					95 = {}
					5 = {
						planet_event = { id = giga_blokkat.3204 days = 20 random = 20 } #BLOKKAT SPOTTED
						set_timed_planet_flag = {
							flag = recent_blokkat_sighting
							days = 420
						}
						ROOT = {
							set_timed_country_flag = {
								flag = recent_blokkat_sighting
								days = 240
							}
						}
						modifier = {
							factor = 0
							ROOT = { has_country_flag = recent_blokkat_sighting }
						}
					}
				}
			}
		}
		#BREACHES (wheres nexon when u need him)
		if = {
			limit = {
				any_owned_megastructure = { 
					OR = { 
						is_megastructure_type = blokkat_prison_1_filled 
						is_megastructure_type = blokkat_prison_1_manage 
					}
					NOR = {
						has_megastructure_flag = blokkat_prison_has_breach
						has_megastructure_flag = blokkat_prison_recent_breach
						has_megastructure_flag = blokkat_being_reprogramed
					}
				}
			}
			every_owned_megastructure = {
				limit = {
					OR = { 
						is_megastructure_type = blokkat_prison_1_filled 
						is_megastructure_type = blokkat_prison_1_manage 
					}
					NOR = {
						has_megastructure_flag = blokkat_prison_has_breach
						has_megastructure_flag = blokkat_prison_recent_breach
						has_megastructure_flag = blokkat_being_reprogramed
					}
				}
				random_list = {
					#Nothing
					98 = {}
					#Small Breach: Spend energy & alloys to fix
					2 = {
						modifier = {
							factor = 4
							has_megastructure_flag = catastrophic_blokkat
						}
						modifier = {
							factor = 1.5
							has_megastructure_flag = speed_freak_blokkat
						}
						modifier = {
							factor = 2
							has_megastructure_flag = angry_blokkat
						}
						modifier = {
							factor = 0.5
							has_megastructure_flag = cooperative_blokkat
						}
						save_global_event_target_as = blokkat_prison_with_breach
						set_megastructure_flag = blokkat_prison_has_breach
						set_timed_megastructure_flag = {
							flag = blokkat_prison_recent_breach
							days = 3600
						}
						ROOT = {
							set_variable = {
								which = blokkat_breach_ec_cost
								value = 100000
							}
							random_list = {
								1 = { multiply_variable = { which = blokkat_breach_ec_cost value = 1.25 } }
								1 = { multiply_variable = { which = blokkat_breach_ec_cost value = 1.10 } }
								1 = { multiply_variable = { which = blokkat_breach_ec_cost value = 1 } }
								1 = { multiply_variable = { which = blokkat_breach_ec_cost value = 0.90 } }
								1 = { multiply_variable = { which = blokkat_breach_ec_cost value = 0.75 } }
							}
							set_variable = {
								which = blokkat_breach_alloy_cost
								value = blokkat_breach_ec_cost
							}
							multiply_variable = {
								which = blokkat_breach_alloy_cost
								value = 0.33
							}
							round_variable = blokkat_breach_alloy_cost
							round_variable = blokkat_breach_ec_cost
							country_event = { id = giga_blokkat.3220 days = 2 }
						}
					}
				}
			}
		}
	}
}

country_event = {
	id = giga_blokkat.3220
	title = "giga_blokkat.3220.name"
	desc = {
		trigger = { event_target:blokkat_prison_with_breach = { has_megastructure_flag = cooperative_blokkat } }
		text = "giga_blokkat.3220.desc.cooperative"
	}

	desc = {
		trigger = { event_target:blokkat_prison_with_breach = { has_megastructure_flag = indifferent_blokkat } }
		text = "giga_blokkat.3220.desc.indifferent"
	}

	desc = {
		trigger = {
			event_target:blokkat_prison_with_breach = {
				OR = { has_megastructure_flag = angry_blokkat has_megastructure_flag = catastrophic_blokkat }
			}
		}
		text = "giga_blokkat.3220.desc.displeased"
	}

	picture = GFX_evt_sabotaged_ship

	show_sound = event_red_alert

	is_triggered_only = yes

	location = event_target:blokkat_prison_with_breach

	trigger = {
		NOT = { has_global_flag = blokkat_breach_occurring }
	}

	immediate = {
		set_global_flag = blokkat_breach_occurring
		event_target:global_event_country = {
			random_owned_leader = {
				limit = {
					check_variable = {
						which = blokkat_prison_id
						value = event_target:blokkat_prison_with_breach.blokkat_prison_id
					}
				}
				save_global_event_target_as = blokkat_prison_breacher
			}
		}
	}

	option = { #kk
		name = "giga_blokkat.3220.a"
		custom_tooltip = "giga_blokkat.3220.a.tooltip"
		hidden_effect = {
			event_target:blokkat_prison_with_breach = { remove_megastructure_flag = blokkat_prison_has_breach }
			remove_global_flag = blokkat_breach_occurring
		}
		allow = {
			resource_stockpile_compare = {
				resource = alloys
				value >= 1
				mult = blokkat_breach_alloy_cost
			}
			resource_stockpile_compare = {
				resource = energy
				value >= 1
				mult = blokkat_breach_ec_cost
			}
		}
		add_resource = {
			energy = -1
			mult = blokkat_breach_ec_cost
		}
		add_resource = {
			alloys = -1
			mult = blokkat_breach_alloy_cost
		}
	}

	option = { #cooperative
		name = "giga_blokkat.3220.b"
		custom_tooltip = "giga_blokkat.3220.b.tooltip"
		trigger = { event_target:blokkat_prison_with_breach = { has_megastructure_flag = cooperative_blokkat } }
		hidden_effect = { country_event = { id = giga_blokkat.3221 } } #They fly off into space
	}

	option = { #indifferent
		name = "giga_blokkat.3220.c"
		custom_tooltip = "giga_blokkat.3220.c.tooltip"
		trigger = { event_target:blokkat_prison_with_breach = { has_megastructure_flag = indifferent_blokkat } }
		hidden_effect = {
			random_list = {
				2 = { country_event = { id = giga_blokkat.3225 } } #they become hostile
				1 = { country_event = { id = giga_blokkat.3221 } } #They fly off into space
			}
		}
	}

	option = { #hostile
		name = "giga_blokkat.3220.d"
		custom_tooltip = "giga_blokkat.3220.d.tooltip"
		trigger = { event_target:blokkat_prison_with_breach = { has_megastructure_flag = angry_blokkat has_megastructure_flag = catastrophic_blokkat } }
		hidden_effect = {
			random_list = {
				1 = { country_event = { id = giga_blokkat.3225 } } #They become hostile
				3 = { #They become VERY hostile
					country_event = { id = giga_blokkat.3223 } 
					modifier = {
						add = 10
						event_target:blokkat_prison_with_breach = { has_megastructure_flag = catastrophic_blokkat }
					}
				}
			}
		}
	}
}

#Cooperative Breach
country_event = {
	id = giga_blokkat.3221
	title = "giga_blokkat.3221.name"
	desc = "giga_blokkat.3221.desc"

	is_triggered_only = yes

	picture = GFX_evt_ship_travel

	show_sound = event_ship_thrusters

	immediate = {
		remove_global_flag = blokkat_breach_occurring
		set_country_flag = just_released_blokkat
		event_target:blokkat_prison_with_breach = {
			remove_megastructure_flag = blokkat_prison_has_breach
			solar_system = {
				spawn_megastructure = {
					type = blokkat_prison_1_empty
					planet = event_target:blokkat_prison_with_breach.planet
					owner = space_owner
				}
			}
			remove_megastructure = THIS
		}
	}

	option = { #cooperative
		name = "giga_blokkat.3221.a"
		custom_tooltip = "giga_blokkat.3221.a.tooltip"
		hidden_effect = {
			if = {
				limit = { has_country_flag = blokkat_inquietude_taught }
				change_variable = {
					which = blokkat_inquietude_value
					value = 0.25
				}
				update_blokkat_inquietude_display = yes
			}
		}
	}
}

planet_event = { #colossus
	id = giga_blokkat.3222
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		destroy_colony = yes
		solar_system = {
			while = {
				count = 1
				create_fleet = { #Spawn some Escort ships
					name = "Rogue Blokkat"
					settings = {
						spawn_debris = no
						can_upgrade = no
						uses_naval_capacity = no
						can_change_composition = no
						is_boss = no
						garrison = yes
					}
					effect = {
						set_owner = event_target:blokkat_country
						while = {
							count = 1
							create_ship = {
								name = "Blokkat"
								design = "Blokkat"
								prefix = no
							}
						}
						set_location = {
							target = ROOT
							distance = 5
							angle = random
						}
						set_formation_scale = 1
						set_fleet_flag = breach_blokkat_fleet
						fleet_event = { id = giga_blokkat.3224 }
					}
				}
			}
		}
		giga_remove_planet = yes
	}
}

#Displeased Breach
country_event = {
	id = giga_blokkat.3223
	title = "giga_blokkat.3223.name"
	desc = "giga_blokkat.3223.desc"

	is_triggered_only = yes

	picture = GFX_evt_large_explosion

	show_sound = event_air_raid_siren

	immediate = {
		remove_global_flag = blokkat_breach_occurring
		set_country_flag = just_released_blokkat
		event_target:blokkat_prison_with_breach = {
			remove_megastructure_flag = blokkat_prison_has_breach
			planet = {
				giga_clear_has_mega_flag = { MEGA = prev }
			}
			solar_system = {
				create_fleet = { #Spawn some Escort ships
					name = "???"
					settings = {
						spawn_debris = no
						can_upgrade = no
						uses_naval_capacity = no
						can_change_composition = no
						is_boss = no
						garrison = yes
					}
					effect = {
						set_name = {
							key = "NAME_Giga_Blokkat_Prison_Breacher"
							variable_string = "[blokkat_prison_breacher.GetName]"
						}
						set_owner = event_target:blokkat_country
						while = {
							count = 1
							create_ship = {
								name = "Blokkat"
								design = "Blokkat"
								prefix = no
							}
						}
						set_location = {
							target = event_target:blokkat_prison_with_breach.planet
							distance = 0
							angle = random
						}
						set_formation_scale = 1
						set_fleet_flag = breach_blokkat_fleet
						set_fleet_flag = original_breach_blokkat_fleet
						set_variable = {
							which = blokkat_prison_id
							value = event_target:blokkat_prison_with_breach.blokkat_prison_id
						}
						fleet_event = { id = giga_blokkat.3224 }
					}
				}
				create_fleet = { #Spawn some Escort ships
					name = "Fabricated Blokkats"
					settings = {
						spawn_debris = no
						can_upgrade = no
						uses_naval_capacity = no
						can_change_composition = no
						is_boss = no
						garrison = yes
					}
					effect = {
						set_owner = event_target:blokkat_country
						while = {
							count = 2
							create_ship = {
								name = "Blokkat"
								design = "Blokkat"
								prefix = no
							}
						}
						set_location = {
							target = event_target:blokkat_prison_with_breach.planet
							distance = 0
							angle = random
						}
						set_formation_scale = 1
						set_fleet_flag = breach_blokkat_fleet
						fleet_event = { id = giga_blokkat.3224 }
					}
				}
			}
			remove_megastructure = THIS
		}
	}

	option = { #AAAAA
		name = "giga_blokkat.3223.a"
		custom_tooltip = "giga_blokkat.3223.a.tooltip"
		hidden_effect = {
			if = {
				limit = { has_country_flag = blokkat_inquietude_taught }
				change_variable = {
					which = blokkat_inquietude_value
					value = 2
				}
				update_blokkat_inquietude_display = yes
			}
		}
	}
}

fleet_event = {
	id = giga_blokkat.3224
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		fleet_event = { id = giga_blokkat.3224 days = 10 }
		queue_actions = {
			find_closest_system = {
				trigger = {
					id = "giga_blokkat.30"
					any_system_planet = {
						can_destroy_planet_with_PLANET_KILLER_BLOKKAT_GENERATOR = yes
						NOT = { has_planet_flag = breached_blokkat_colossus_target }
					}
				}
				found_system = {
					move_to = this
					find_closest_planet = {
						trigger = {
							id = "giga_blokkat.20"
							can_destroy_planet_with_PLANET_KILLER_BLOKKAT_GENERATOR = yes
							NOT = { has_planet_flag = breached_blokkat_colossus_target }
						}
						found_planet = {
							effect = {
								id = "giga_blokkat.21"
								set_timed_planet_flag = {
									flag = breached_blokkat_colossus_target
									days = 120
								}
							}
							move_to = this
							destroy_planet = {
								target = this
							}
						}
					}
				}
			}
		}
	}
}

#Indifferent Breach
country_event = {
	id = giga_blokkat.3225
	title = "giga_blokkat.3225.name"
	desc = "giga_blokkat.3225.desc"

	is_triggered_only = yes

	picture = GFX_evt_machine_space_battle

	show_sound = event_space_battle

	immediate = {
		country_event = { id = giga_blokkat.3226 days = 60 }
		country_event = { id = giga_blokkat.3227 days = 60 }
		event_target:blokkat_prison_with_breach = {
			solar_system = {
				create_fleet = { #Spawn some Escort ships
					name = "???"
					settings = {
						spawn_debris = no
						can_upgrade = no
						uses_naval_capacity = no
						can_change_composition = no
						is_boss = no
						garrison = yes
					}
					effect = {
						set_name = {
							key = "NAME_Giga_Blokkat_Prison_Breacher"
							variable_string = "[blokkat_prison_breacher.GetName]"
						}
						set_owner = event_target:blokkat_country
						while = {
							count = 1
							create_ship = {
								name = "Blokkat"
								design = "Blokkat"
								prefix = no
							}
						}
						set_location = {
							target = event_target:blokkat_prison_with_breach.planet
							distance = 0
							angle = random
						}
						set_formation_scale = 1
						set_fleet_flag = breach_blokkat_fleet
						set_fleet_flag = original_breach_blokkat_fleet
						save_global_event_target_as = breaching_blokkat_fleet
						set_variable = {
							which = blokkat_prison_id
							value = event_target:blokkat_prison_with_breach.blokkat_prison_id
						}
					}
				}
			}
		}
	}

	option = { #AAAAA
		name = "giga_blokkat.3225.a"
		custom_tooltip = "giga_blokkat.3225.a.tooltip"
	}
}

#It escapes
country_event = {
	id = giga_blokkat.3226
	title = "giga_blokkat.3226.name"
	desc = "giga_blokkat.3226.desc"

	is_triggered_only = yes

	picture = GFX_evt_ship_travel

	show_sound = event_ship_thrusters

	trigger = {
		exists = event_target:breaching_blokkat_fleet
	}

	immediate = {
		event_target:breaching_blokkat_fleet = { destroy_fleet = this }
		remove_global_flag = blokkat_breach_occurring
		set_country_flag = just_released_blokkat
		event_target:blokkat_prison_with_breach = {
			remove_megastructure_flag = blokkat_prison_has_breach
			solar_system = {
				spawn_megastructure = {
					type = blokkat_prison_1_empty
					planet = event_target:blokkat_prison_with_breach.planet
					owner = space_owner
				}
			}
			remove_megastructure = THIS
		}
	}

	option = { #AAAAA
		name = "giga_blokkat.3226.a"
		custom_tooltip = "giga_blokkat.3226.a.tooltip"
		hidden_effect = {
			if = {
				limit = { has_country_flag = blokkat_inquietude_taught }
				change_variable = {
					which = blokkat_inquietude_value
					value = 0.5
				}
				update_blokkat_inquietude_display = yes
			}
		}
	}
}

#It is recontained
country_event = {
	id = giga_blokkat.3227
	title = "giga_blokkat.3227.name"
	desc = "giga_blokkat.3227.desc"

	is_triggered_only = yes

	picture = GFX_evt_physics_research

	show_sound = event_laboratory_sound

	trigger = {
		NOT = { exists = event_target:breaching_blokkat_fleet }
	}

	immediate = {
		remove_global_flag = blokkat_breach_occurring
		every_owned_megastructure = {
			limit = { has_megastructure_flag = blokkat_prison_has_breach }
			remove_megastructure_flag = blokkat_prison_has_breach
		}
	}

	option = { #AAAAA
		name = "giga_blokkat.3227.a"
		custom_tooltip = "giga_blokkat.3227.a.tooltip"
		add_resource = { influence = 25 }
	}
}

planet_event = {
	id = giga_blokkat.3204
	title = "giga_blokkat.3204.name"
	desc = "giga_blokkat.3204.desc"

	is_triggered_only = yes

	picture = GFX_evt_inhabited_solar_system

	trigger = {
		owner = { NOT = { has_country_flag = currently_fighting_blokkat } }
	}

	immediate = {
		owner = {
			set_country_flag = currently_fighting_blokkat
			set_variable = {
				which = blokkat_containment_ec_cost
				value = blokkat_containment_ec_cost_base
			}
			# random_list = {
			# 	1 = { multiply_variable = { which = blokkat_containment_ec_cost value = 1.3 } }
			# 	1 = { multiply_variable = { which = blokkat_containment_ec_cost value = 1.2 } }
			# 	1 = { multiply_variable = { which = blokkat_containment_ec_cost value = 1.1 } }
			# 	1 = { multiply_variable = { which = blokkat_containment_ec_cost value = 1.0 } }
			# 	1 = { multiply_variable = { which = blokkat_containment_ec_cost value = 0.9 } }
			# 	1 = { multiply_variable = { which = blokkat_containment_ec_cost value = 0.8 } }
			# 	1 = { multiply_variable = { which = blokkat_containment_ec_cost value = 0.7 } }
			# }
		}
	}

	option = { #kk
		name = "giga_blokkat.3204.a"
		custom_tooltip = "giga_blokkat.3204.a.tooltip"
		owner = { add_resource = { influence = 50 } }
		hidden_effect = {
			set_planet_flag = planet_fighting_blokkat
			planet_event = { id = giga_blokkat.3205 }
			owner = {
				add_resource = { 
					energy = -1
					mult = blokkat_containment_ec_cost
				}
			}
			create_army = {
				name = "Lone Blokkat"
				owner = event_target:blokkat_country
				species = event_target:diverse_blokkat_species
				type = "individual_blokkat"
			}
		}
		allow = {
			custom_tooltip = {
				fail_text = "blokkat_not_enough_energy"
				hidden_trigger = {
					owner = {
						resource_stockpile_compare = {
							resource = energy
							value > 1
							mult = blokkat_containment_ec_cost
						}
					}
				}
			}
		}
	}


	option = { #kk
		name = "giga_blokkat.3204.b"
		hidden_effect = {
			owner = { remove_country_flag = currently_fighting_blokkat }
		}
	}
}


planet_event = {
	id = giga_blokkat.3205
	title = "giga_blokkat.3205.name"
	desc = "giga_blokkat.3205.desc"
	is_triggered_only = yes
	picture = GFX_evt_ground_combat
	show_sound = event_ground_battle

	option = { #kk
		name = "giga_blokkat.3205.a"
	}
}

#The Blokkat Wins
country_event = {
	id = giga_blokkat.3206
	title = "giga_blokkat.3206.name"
	desc = "giga_blokkat.3206.desc"

	picture = GFX_evt_burning_settlement
	show_sound = event_public_unrest
	
	is_triggered_only = yes

	trigger = {
		from = { is_country_type = blokkat_stripminers }
		fromfrom = { 
			has_planet_flag = planet_fighting_blokkat
		}
	}

	immediate = {
		remove_country_flag = currently_fighting_blokkat
		fromfrom = { remove_planet_flag = planet_fighting_blokkat }
	}

	option = {
		name = "giga_blokkat.3206.a"
		custom_tooltip = "giga_blokkat.3206.a.tooltip"
		add_resource = {
			influence = -10
		}
		hidden_effect = {
			fromfrom = {
				every_planet_army = {
					limit = { army_type = individual_blokkat }
					remove_army = yes
				}
				set_owner = ROOT
				set_controller = ROOT
				add_planet_devastation = 10
			}
			change_variable = {
				which = blokkat_inquietude_value
				value = 0.25
			}
			update_blokkat_inquietude_display = yes
		}
	}
}

#The Blokkat Loses and is captured
country_event = {
	id = giga_blokkat.3207
	title = "giga_blokkat.3207.name"
	desc = "giga_blokkat.3207.desc"

	picture = GFX_evt_analyzing_artifacts
	show_sound = event_celebration
	
	is_triggered_only = yes

	trigger = {
		from = { is_country_type = blokkat_stripminers }
		fromfrom = { has_planet_flag = planet_fighting_blokkat }
		any_owned_megastructure = { is_megastructure_type = blokkat_prison_1_empty }
	}

	immediate = {
		if = {
			limit = { has_country_flag = blokkat_willingness_active }
			change_variable = {
				which = blokkat_willingness_military_value
				value = 3.5
			}
			update_blokkat_willingness_value = yes
		}
		remove_country_flag = currently_fighting_blokkat
		fromfrom = { remove_planet_flag = planet_fighting_blokkat }
		random_owned_megastructure = {
			limit = { is_megastructure_type = blokkat_prison_1_empty }
			solar_system = {
				spawn_megastructure = {
					type = blokkat_prison_1_filled
					planet = PREV.planet
					owner = space_owner
				}
			}
			remove_megastructure = THIS
		}
		event_target:global_event_country = {
			#If the Blokkat has a set role, define its identity here (eg Blokkmo)
			random_list = {
				1 = {
					create_leader = {
						class = governor
						set_age = 46546
						immortal = yes
						gender = indeterminable
						skill = 8
						name = "Temp"
						species = event_target:diverse_blokkat_species
						traits = {
							trait = trait_blokkat_governor
							trait = leader_trait_governor_psionic
							trait = leader_trait_governor_synthetic
						}
						effect = {
							set_leader_flag = blokkat_is_governor
							set_leader_flag = blokkat_leader
							random_list = {
								10 = { 
									set_leader_flag = blokkitae_leader
									modifier = { #Only 1 Blokkitae
										factor = 0
										any_country = { any_owned_leader = { has_leader_flag = blokkitae_leader } }
									}
								}
								10 = { 
									set_leader_flag = blokkeff_leader
									modifier = { #Only 1 Blokkeff
										factor = 0
										any_country = { any_owned_leader = { has_leader_flag = blokkeff_leader } }
									}
								}
								10 = { 
									set_leader_flag = traceblok_leader
									modifier = { #Only 1 Traceblok
										factor = 0
										any_country = { any_owned_leader = { has_leader_flag = traceblok_leader } }
									}
								}
								10 = { 
									set_leader_flag = breadkat_leader
									modifier = { #Only 1 Breadkat
										factor = 0
										any_country = { any_owned_leader = { has_leader_flag = breadkat_leader } }
									}
								}
								10 = { 
									set_leader_flag = blokkloris_leader
									modifier = { #Only 1 Blokkloris
										factor = 0
										any_country = { any_owned_leader = { has_leader_flag = blokkloris_leader } }
									}
								}
								90 = {}
							}
						}
					}
				}
				1 = {
					create_leader = {
						class = scientist
						set_age = 46546
						immortal = yes
						gender = indeterminable
						skill = 8
						name = "Temp"
						species = event_target:diverse_blokkat_species
						traits = {
							trait = trait_blokkat_scientist
							trait = leader_trait_scientist_psionic
							trait = leader_trait_scientist_synthetic
						}
						effect = {
							set_leader_flag = blokkat_is_scientist
							set_leader_flag = blokkat_leader
							random_list = {
								10 = { 
									set_leader_flag = blokkmo_leader
									modifier = { #Only 1 Blokkmo
										factor = 0
										any_country = { any_owned_leader = { has_leader_flag = blokkmo_leader } }
									}
								}
								10 = { 
									set_leader_flag = blokkiana_leader
									modifier = { #Only 1 Blokkiana
										factor = 0
										any_country = { any_owned_leader = { has_leader_flag = blokkiana_leader } }
									}
								}
								90 = {}
							}
						}
					}
				}
				1 = {
					create_leader = {
						class = admiral
						set_age = 46546
						immortal = yes
						gender = indeterminable
						skill = 8
						name = "Temp"
						species = event_target:diverse_blokkat_species
						traits = {
							trait = trait_blokkat_admiral
							trait = leader_trait_admiral_psionic
							trait = leader_trait_admiral_synthetic
						}
						effect = {
							set_leader_flag = blokkat_is_admiral
							set_leader_flag = blokkat_leader
							random_list = {
								10 = { 
									set_leader_flag = blokkshield_leader
									modifier = { #Only 1 Blokkshield
										factor = 0
										any_country = { any_owned_leader = { has_leader_flag = blokkshield_leader } }
									}
								}
								10 = { 
									set_leader_flag = blokksauna_leader
									modifier = { #Only 1 Blokksauna
										factor = 0
										any_country = { any_owned_leader = { has_leader_flag = blokksauna_leader } }
									}
								}
								10 = { 
									set_leader_flag = blokkazoi_leader
									modifier = { #Only 1 Blokkazoi (thank god lmao)
										factor = 0
										any_country = { any_owned_leader = { has_leader_flag = blokkazoi_leader } }
									}
								}
								10 = { 
									set_leader_flag = blokkdog_leader
									modifier = { #Only 1 Blokkdog
										factor = 0
										any_country = { any_owned_leader = { has_leader_flag = blokkdog_leader } }
									}
								}
								90 = {}
							}
						}
					}
				}
				1 = {
					create_leader = {
						class = general
						set_age = 46546
						immortal = yes
						gender = indeterminable
						skill = 8
						name = "Temp"
						species = event_target:diverse_blokkat_species
						traits = {
							trait = trait_blokkat_general
							trait = leader_trait_general_psionic
							trait = leader_trait_general_synthetic
						}
						effect = {
							set_leader_flag = blokkat_is_general
							set_leader_flag = blokkat_leader
						}
					}
				}
			}
			last_created_leader = {
				set_variable = {
					which = blokkat_prison_id
					value = event_target:global_event_country.current_blokkat_prison_max_id
				}
				#If the Blokkat just has custom traits or behavior, define it there
				set_blokkat_leader_data = yes
				#Interest
				random_list = {
					3 = {
						set_leader_flag = blokkat_is_psionic
						if = {
							limit = { has_leader_flag = blokkat_is_general }
							add_trait = leader_trait_general_chosen
						}
						if = {
							limit = { has_leader_flag = blokkat_is_admiral }
							add_trait = leader_trait_admiral_chosen
						}
						if = {
							limit = { has_leader_flag = blokkat_is_scientist }
							add_trait = leader_trait_scientist_chosen
						}
						if = {
							limit = { has_leader_flag = blokkat_is_governor }
							add_trait = leader_trait_governor_chosen
						}
						modifier = { add = 1000 has_leader_flag = blokkmo_leader }
					}
					3 = {
						set_leader_flag = blokkat_is_keen
						add_trait = trait_blokkat_keen
					}
					3 = {
						set_leader_flag = blokkat_is_mineralizer
						add_trait = trait_blokkat_mineralizer
					}
					3 = {
						set_leader_flag = blokkat_is_ambitious
						add_trait = trait_blokkat_ambitious
						modifier = { add = 1000 has_leader_flag = traceblok_leader }
					}
					3 = {
						set_leader_flag = blokkat_is_combative
						add_trait = trait_blokkat_combative
					}
					0 = {
						set_leader_flag = blokkat_is_blokkazoi
						add_trait = trait_blokkat_blokkazoi
						modifier = { add = 1000 has_leader_flag = blokkazoi_leader }
					}
					0 = {
						set_leader_flag = blokkat_is_omnitae
						add_trait = trait_blokkat_omnitae
						modifier = { add = 1000 has_leader_flag = blokkitae_leader }
					}
					0 = {
						set_leader_flag = blokkat_is_speed_freak
						add_trait = trait_blokkat_speed_freak
						modifier = { add = 1000 has_leader_flag = blokkshield_leader }
					}
					0 = {
						set_leader_flag = blokkat_is_primitive_enthusiast
						add_trait = trait_blokkat_primitive_enthusiast
						modifier = { add = 1000 has_leader_flag = blokkiana_leader }
					}
					0 = {
						set_leader_flag = blokkat_is_catgirl
						add_trait = trait_blokkat_catgirl
						modifier = { add = 1000 has_leader_flag = blokksauna_leader }
					}
					0 = {
						set_leader_flag = blokkat_is_blokkdog
						add_trait = trait_blokkat_blokkdog
						modifier = { add = 1000 has_leader_flag = blokkdog_leader }
					}
					0 = {
						set_leader_flag = blokkat_is_blokkeff
						add_trait = trait_blokkat_blokkeff
						modifier = { add = 1000 has_leader_flag = blokkeff_leader }
					}
					0 = {
						set_leader_flag = blokkat_is_breadkat
						add_trait = trait_blokkat_breadkat
						modifier = { add = 1000 has_leader_flag = breadkat_leader }
					}
					0 = {
						set_leader_flag = blokkat_is_blokkloris
						add_trait = trait_blokkat_blokkloris
						modifier = { add = 1000 has_leader_flag = blokkloris_leader }
					}
				}
				#Behavior
				random_list = {
					1 = {
						set_leader_flag = blokkat_is_catastrophic
						modifier = { add = 1000 has_leader_flag = blokkazoi_leader }
						modifier = { add = 1000 has_leader_flag = breadkat_leader }
						modifier = { add = 1000 has_leader_flag = blokkloris_leader}
					}
					6 = {
						set_leader_flag = blokkat_is_angry
						modifier = { add = 1000 has_leader_flag = blokkmo_leader }
						modifier = { add = 1000 has_leader_flag = blokkshield_leader }
					}
					4 = {
						set_leader_flag = blokkat_is_indifferent
						modifier = { add = 1000 has_leader_flag = blokkiana_leader }
					}
					4 = {
						set_leader_flag = blokkat_is_cooperative
						modifier = { add = 1000 has_leader_flag = blokksauna_leader }
						modifier = { add = 1000 has_leader_flag = blokkdog_leader }
						modifier = { add = 1000 has_leader_flag = blokkeff_leader }
					}
				}
				save_event_target_as = newest_blokkat_prisoner
			}
		}
		random_owned_megastructure = {
			limit = { 
				is_megastructure_type = blokkat_prison_1_filled
				NOT = { has_megastructure_flag = prison_has_blokkat } 
			}
			set_variable = {
				which = blokkat_prison_id
				value = event_target:global_event_country.current_blokkat_prison_max_id
			}
			if = {
				limit = { last_created_leader = { has_leader_flag = blokkat_is_keen } }
				set_megastructure_flag = bold_blokkat
			}
			if = {
				limit = { last_created_leader = { has_leader_flag = blokkat_is_catastrophic } }
				set_megastructure_flag = catastrophic_blokkat
			}
			if = {
				limit = { last_created_leader = { has_leader_flag = blokkat_is_angry } }
				set_megastructure_flag = angry_blokkat
			}
			if = {
				limit = { last_created_leader = { has_leader_flag = blokkat_is_indifferent } }
				set_megastructure_flag = indifferent_blokkat
			}
			if = {
				limit = { last_created_leader = { has_leader_flag = blokkat_is_cooperative } }
				set_megastructure_flag = cooperative_blokkat
			}
			if = {
				limit = { last_created_leader = { has_leader_flag = blokkat_is_speed_freak } }
				set_megastructure_flag = speed_freak_blokkat
			}
			if = {
				limit = { last_created_leader = { has_leader_flag = blokkat_is_primitive_enthusiast } }
				set_megastructure_flag = primitive_enthusiast_blokkat
			}
			if = {
				limit = { last_created_leader = { has_leader_flag = blokkat_is_catgirl } }
				set_megastructure_flag = catgirl_blokkat
			}
			if = {
				limit = { last_created_leader = { has_leader_flag = blokkat_is_omnitae } }
				set_megastructure_flag = blokkitae_blokkat
			}
			if = {
				limit = { last_created_leader = { has_leader_flag = blokkat_is_blokkazoi } }
				set_megastructure_flag = blokkazoi_blokkat
			}
			if = {
				limit = { last_created_leader = { has_leader_flag = blokkat_is_blokkdog } }
				set_megastructure_flag = blokkdog_blokkat
			}
			if = {
				limit = { last_created_leader = { has_leader_flag = blokkat_is_blokkeff } }
				set_megastructure_flag = blokkeff_blokkat
			}
			if = {
				limit = { last_created_leader = { has_leader_flag = blokkat_is_breadkat } }
				set_megastructure_flag = breadkat_blokkat
			}
			if = {
				limit = { last_created_leader = { has_leader_flag = blokkat_is_blokkloris } }
				set_megastructure_flag = blokkloris_blokkat
			}
			set_megastructure_flag = prison_has_blokkat
			save_event_target_as = newest_blokkat_prison
		}
		event_target:global_event_country = {
			change_variable = {
				which = current_blokkat_prison_max_id
				value = 1
			}
		}
	}

	option = {
		name = "giga_blokkat.3207.a"
		custom_tooltip = "giga_blokkat.3207.a.tooltip"
		add_resource = {
			influence = 25
		}
		hidden_effect = {
			event_target:newest_blokkat_prison = {
				upgrade_megastructure_to = blokkat_prison_1_manage
			}
		}
	}
}

#MONTHLY EVENT FOR CAPTURE
country_event = {
	id = giga_blokkat.3209
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_country_flag = blokkat_capture_project_researched
		is_ai = no
	}

	immediate = {
		if = { #Delete those in empty space
			limit = {
				any_megastructure = { 
					is_megastructure_type = blokkat_prison_1_filled
					NOT = { has_megastructure_flag = blokkat_being_reprogramed }
					OR = {
						NOT = { owner = { has_technology = giga_tech_blokkat_snare } }
						NOT = { exists = owner }
					}
				}
			}
			every_megastructure = {
				limit = {
					is_megastructure_type = blokkat_prison_1_filled
					NOT = { has_megastructure_flag = blokkat_being_reprogramed }
					OR = {
						NOT = { owner = { has_technology = giga_tech_blokkat_snare } }
						NOT = { exists = owner }
					}
				}
				remove_megastructure = THIS
			}
		}
		if = {
			limit = {
				any_owned_megastructure = {
					is_megastructure_type = blokkat_prison_1_filled
					NOT = { has_megastructure_flag = blokkat_prison_has_breach }
				}
				check_variable = {
					which = blokkat_knowledge_value
					value >= 35
				}
				has_country_flag = blokkat_mega_stage_2_researched
				NOT = { has_country_flag = blokkat_reprogram_project_unlocked }
			}
			country_event = { id = giga_blokkat.3230 }
		}
		set_variable = {
			which = captured_blokkat_count
			value = 0
		}
		every_owned_megastructure = {
			limit = { is_megastructure_type = blokkat_prison_1_filled }
			ROOT = {
				change_variable = {
					which = captured_blokkat_count
					value = 1
				}
			}
		}
		every_owned_megastructure = {
			limit = { OR = { is_megastructure_type = blokkat_prison_1_filled is_megastructure_type = blokkat_prison_1_manage } }
			if = {
				limit = { has_megastructure_flag = undertaking_blokkat_experiment }
				subtract_variable = {
					which = blokkat_experiment_duration
					value = 1
				}
				if = {
					limit = {
						check_variable = {
							which = blokkat_experiment_duration
							value <= 0
						}
					}
					remove_megastructure_flag = undertaking_blokkat_experiment
					save_event_target_as = blokkat_prison_experiment_complete
					ROOT = { country_event = { id = giga_blokkat.3212 } }
				}
			}
		}
	}
}

#REPROGRAM

country_event = {
	id = giga_blokkat.3230
	title = "giga_blokkat.3230.name"
	desc = "giga_blokkat.3230.desc"
	picture = GFX_evt_machine_sapience
	show_sound = event_mystic_reveal_light

	is_triggered_only = yes
	
	option = { #Bye
		name = "giga_blokkat.3230.a"
		custom_tooltip = "giga_blokkat.3230.a.tooltip"
		hidden_effect = {
			set_country_flag = blokkat_reprogram_project_unlocked
		}
	}
}

country_event = {
	id = giga_blokkat.3231
	title = "giga_blokkat.3231.name"
	desc = "giga_blokkat.3231.desc"
	picture = GFX_evt_sapient_AI
	show_sound = event_laboratory_sound

	is_triggered_only = yes
	immediate = {
		set_country_flag = blokkat_reprogram_possible
	}
	option = { #lets go
		name = "giga_blokkat.3231.a"
		custom_tooltip = cant_do_another_blokkat_project_tech_tooltip
		add_research_option = giga_tech_blokkat_reprogram
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
			set_country_flag = blokkat_project_underway
		}
	}

	option = { #nvm
		name = "giga_blokkat.3231.b"
		hidden_effect = {
			country_event = { id = giga_blokkat.3000 }
			remove_country_flag = blokkat_reprogram_possible
		}
	}
}

country_event = {
	id = giga_blokkat.3232
	title = "giga_blokkat.3232.name"
	desc = "giga_blokkat.3232.desc"

	is_triggered_only = yes

	show_sound = event_machinery
	picture = GFX_evt_sapient_AI

	trigger = {
		last_increased_tech = giga_tech_blokkat_reprogram
	}

	immediate = {
		change_variable = {
			which = blokkat_knowledge_earned_by_general_study
			value = 1
		}
		set_country_flag = blokkat_reprogram_project_researched
	}

	option = { #kk
		name = "giga_blokkat.3232.a"
		custom_tooltip = "giga_blokkat.3232.a.tooltip"
		hidden_effect = {
			remove_country_flag = blokkat_project_underway
		}
	}
}

country_event = {
	id = giga_blokkat.3233
	title = "giga_blokkat.3233.name"
	desc = "giga_blokkat.3233.desc"

	is_triggered_only = yes

	show_sound = event_mystic_reveal
	picture = GFX_evt_sapient_AI

	option = { #kk
		name = "giga_blokkat.3233.a"
		hidden_effect = {
			set_country_flag = currently_reprogramming_blokkat
			remove_global_flag = managing_blokkat_prison
			event_target:blokkat_prison_being_managed = {
				set_megastructure_flag = blokkat_being_reprogramed
			}
			set_variable = {
				which = blokkat_prison_id
				value = event_target:blokkat_prison_being_managed.blokkat_prison_id
			}
		}
		if = {
			limit = { event_target:blokkat_prison_being_managed = { has_megastructure_flag = catastrophic_blokkat } }
			enable_special_project = {
				name = "REPROGRAM_CATASTROPHIC_BLOKKAT"
				owner = root
			}
		}
		if = {
			limit = { event_target:blokkat_prison_being_managed = { has_megastructure_flag = angry_blokkat } }
			enable_special_project = {
				name = "REPROGRAM_DISPLEASED_BLOKKAT"
				owner = root
			}
		}
		if = {
			limit = { event_target:blokkat_prison_being_managed = { has_megastructure_flag = indifferent_blokkat } }
			enable_special_project = {
				name = "REPROGRAM_INDIFFERENT_BLOKKAT"
				owner = root
			}
		}
		if = {
			limit = { event_target:blokkat_prison_being_managed = { has_megastructure_flag = cooperative_blokkat } }
			enable_special_project = {
				name = "REPROGRAM_COOPERATIVE_BLOKKAT"
				owner = root
			}
		}
	}

	option = { #kk
		name = "giga_blokkat.3233.b"
		hidden_effect = {
			country_event = { id = giga_blokkat.3210 }
		}
	}
}

#Blokkat reprogrammed
country_event = {
	id = giga_blokkat.3234
	title = "giga_blokkat.3234.name"
	desc = "giga_blokkat.3234.desc"

	is_triggered_only = yes

	show_sound = event_celebration
	picture = GFX_evt_machine_sapience

	trigger = {
		any_megastructure = {
			check_variable = {
				which = blokkat_prison_id
				value = ROOT.blokkat_prison_id
			}
		}
	}

	immediate = {
		if = {
			limit = { has_country_flag = blokkat_willingness_active }
			change_variable = {
				which = blokkat_willingness_science_value
				value = 2
			}
			update_blokkat_willingness_value = yes
		}
		set_global_flag = managing_blokkat_prison
		random_megastructure = {
			limit = {
				check_variable = {
					which = blokkat_prison_id
					value = ROOT.blokkat_prison_id
				}
			}
			save_global_event_target_as = reprogrammed_blokkat_prison
		}
		event_target:global_event_country = {
			random_owned_leader = {
				limit = {
					check_variable = {
						which = blokkat_prison_id
						value = event_target:reprogrammed_blokkat_prison.blokkat_prison_id
					}
				}
				if = {
					limit = { has_leader_flag = blokkat_is_angry }
					remove_leader_flag = blokkat_is_angry
				}
				if = {
					limit = { has_leader_flag = blokkat_is_catastrophic }
					remove_leader_flag = blokkat_is_catastrophic
				}
				save_global_event_target_as = reprogrammed_blokkat
				exile_leader_as = reprogrammed_blokkat
				if = {
					limit = { has_leader_flag = blokkazoi_leader }
					ROOT = { set_country_flag = acquired_blokkazoi }
				}
			}
		}
		ruler = { save_event_target_as = blokkat_current_ruler }
		set_leader = reprogrammed_blokkat
		set_leader = event_target:blokkat_current_ruler
		set_country_flag = just_released_blokkat
		event_target:reprogrammed_blokkat_prison = {
			solar_system = {
				save_event_target_as = blokkat_nexus_sytem
				spawn_megastructure = {
					type = blokkat_prison_1_empty
					planet = event_target:reprogrammed_blokkat_prison.planet
					owner = space_owner
				}
				if = {
					limit = { ROOT = { has_country_flag = acquired_blokkazoi } }
					create_fleet = { #Spawn B L O K K A Z O I
						name = "Blokkazoi"
						settings = {
							spawn_debris = no
							can_upgrade = no
							uses_naval_capacity = no
							can_change_composition = no
							is_boss = no
							can_change_leader = no
							can_disband = no
						}
						effect = {
							set_owner = ROOT
							while = {
								count = 1
								create_ship = {
									name = "Blokkazoi"
									design = "Blokkazoi"
									prefix = no
									effect = {
										add_modifier = {
											modifier = giga_blokkat_blokkazoi_buff
											days = -1
										}
									}
								}
							}
							set_location = {
								target = PREV.star
								distance = 0
								angle = random
							}
							set_formation_scale = 1
							assign_leader = event_target:reprogrammed_blokkat
						}
					}
					ROOT = { remove_country_flag = acquired_blokkazoi }
				}
			}
			remove_megastructure = THIS
		}
	}

	option = { #kk
		name = "giga_blokkat.3234.a"
		custom_tooltip = "giga_blokkat.3234.a.tooltip"
		add_resource = {
			influence = 50
		}
		hidden_effect = {
			remove_country_flag = currently_reprogramming_blokkat
			remove_global_flag = managing_blokkat_prison
		}
	}
}

country_event = { #Increment age
	id = giga_blokkat.3235
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_country = event_target:global_event_country
		any_owned_leader = { has_leader_flag = blokkat_leader }
	}

	immediate = {
		every_owned_leader = {
			limit = { has_leader_flag = blokkat_leader }
			change_variable = {
				which = blokkat_age_value
				value = 1
			}
		}
	}
}

country_event = {
	id = giga_blokkat.3236
	title = "giga_blokkat.3236.name"
	desc = "giga_blokkat.3236.desc"

	picture = GFX_evt_analyzing_artifacts
	show_sound = event_dyson_sphere_build_complete
	
	location = event_target:giga_system

	is_triggered_only = yes

	option = {
		name = "giga_blokkat.3236.a"
	}
}	

#Experimenting done!
country_event = {
	id = giga_blokkat.3212
	title = "giga_blokkat.3212.name"
	desc = "giga_blokkat.3212.desc"

	location = event_target:blokkat_prison_experiment_complete

	picture = GFX_evt_analyzing_artifacts
	show_sound = event_machinery
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = considering_doing_blokkat_experiment
	}

	option = {
		name = "giga_blokkat.3212.a"
		custom_tooltip = "giga_blokkat.3212.a.tooltip"
		hidden_effect = {
			remove_country_flag = considering_doing_blokkat_experiment
			change_variable = {
				which = blokkat_knowledge_value
				value = 1
			}
			change_variable = {
				which = blokkat_knowledge_earned_by_capture
				value = 1
			}
			if = {
				limit = { has_country_flag = blokkat_willingness_active }
				change_variable = {
					which = blokkat_willingness_science_value
					value = 2
				}
				update_blokkat_willingness_value = yes
			}
		}
	}
}

#Experimenting
country_event = {
	id = giga_blokkat.3211
	title = "giga_blokkat.3211.name"
	desc = "giga_blokkat.3211.desc"

	picture = GFX_evt_analyzing_artifacts
	show_sound = event_laboratory_sound
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = considering_doing_blokkat_experiment
	}

	option = {
		name = "giga_blokkat.3211.a"
		custom_tooltip = "giga_blokkat.3211.a.tooltip"
		hidden_effect = {
			event_target:blokkat_prison_being_managed = {
				set_variable = { #Set the duration
					which = blokkat_experiment_duration
					value = ROOT.blokkat_prison_research_time
				}
				set_megastructure_flag = undertaking_blokkat_experiment
			}
			multiply_variable = {
				which = blokkat_prison_research_time
				value = 1.50
			}
			round_variable = blokkat_prison_research_time
			remove_country_flag = considering_doing_blokkat_experiment
			remove_global_flag = managing_blokkat_prison
		}
	}

	option = {
		name = "giga_blokkat.3211.b"
		hidden_effect = {
			remove_country_flag = considering_doing_blokkat_experiment
			country_event = { id = giga_blokkat.3210 }
		}
	}
}

#VIEWING PRISON SCREEN
country_event = {
	id = giga_blokkat.3210
	title = "giga_blokkat.3210.name"
	desc = "giga_blokkat.3210.desc"
	is_triggered_only = yes
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:blokkat_prisoner_being_viewed
		room = blokkat_prison_room
	}

	immediate = {
		event_target:global_event_country = {
			random_owned_leader = {
				limit = {
					check_variable = {
						which = blokkat_prison_id
						value = event_target:blokkat_prison_being_managed.blokkat_prison_id
					}
				}
				save_global_event_target_as = blokkat_prisoner_being_viewed
			}
		}
	}

	option = { #Experiment Ongoing
		name = "giga_blokkat.3210.experiment"
		hidden_effect = { remove_global_flag = managing_blokkat_prison }
		trigger = {
			NOT = { event_target:blokkat_prison_being_managed = { has_megastructure_flag = blokkat_prison_has_breach } }
			NOT = { has_country_flag = considering_doing_blokkat_experiment }
			event_target:blokkat_prison_being_managed = { has_megastructure_flag = undertaking_blokkat_experiment }
		}
		allow = {
			custom_tooltip = {
				fail_text = "blokkat_experiment_ongoing"
				hidden_trigger = { always = no }
			}
		}
	}

	option = { #Experiment
		name = "giga_blokkat.3210.knowledge"
		allow = {
			resource_stockpile_compare = {
				resource = energy
				value >= 75000
			}
			resource_stockpile_compare = {
				resource = influence
				value >= 25
			}
		}
		add_resource = {
			energy = -75000
			influence = -25
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3211 }
		}
		trigger = {
			NOT = { has_country_flag = considering_doing_blokkat_experiment }
			NOT = { event_target:blokkat_prison_being_managed = { has_megastructure_flag = blokkat_prison_has_breach } }
			NOT = { event_target:blokkat_prison_being_managed = { has_megastructure_flag = blokkat_being_reprogramed } }
			NOT = { event_target:blokkat_prison_being_managed = { has_megastructure_flag = undertaking_blokkat_experiment } }
		}
	}

	option = { #Reprogram (Totally ethical trust me theyre the ones eating the galaxy)
		name = "giga_blokkat.3210.reprogram" #neutral
		trigger = { 
			NOT = { event_target:blokkat_prison_being_managed = { has_megastructure_flag = blokkat_prison_has_breach } }
			NOT = { event_target:blokkat_prison_being_managed = { has_megastructure_flag = blokkat_being_reprogramed } }
			event_target:blokkat_prison_being_managed = { has_megastructure_flag = indifferent_blokkat }
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3233 }
		}
		allow = {
			custom_tooltip = {
				fail_text = "only_1_reprogram"
				NOT = { has_country_flag = currently_reprogramming_blokkat }
			}
			custom_tooltip = {
				fail_text = "cant_reprogram_if_experiment"
				NOT = { event_target:blokkat_prison_being_managed = { has_megastructure_flag = undertaking_blokkat_experiment } }
			}
			custom_tooltip = {
				fail_text = "blokkat_requires_40_knowledge_and_project"
				has_technology = giga_tech_blokkat_reprogram
				check_variable = {
					which = blokkat_knowledge_value
					value >= 40
				}
			}
		}
	}

	option = { #Reprogram (Totally ethical trust me theyre the ones eating the galaxy)
		name = "giga_blokkat.3210.reprogram.cooperative" #cooperative
		trigger = { 
			NOT = { event_target:blokkat_prison_being_managed = { has_megastructure_flag = blokkat_prison_has_breach } } 
			NOT = { event_target:blokkat_prison_being_managed = { has_megastructure_flag = blokkat_being_reprogramed } }
			event_target:blokkat_prison_being_managed = { has_megastructure_flag = cooperative_blokkat }
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3233 }
		}
		allow = {
			custom_tooltip = {
				fail_text = "only_1_reprogram"
				NOT = { has_country_flag = currently_reprogramming_blokkat }
			}
			custom_tooltip = {
				fail_text = "cant_reprogram_if_experiment"
				NOT = { event_target:blokkat_prison_being_managed = { has_megastructure_flag = undertaking_blokkat_experiment } }
			}
			custom_tooltip = {
				fail_text = "blokkat_requires_35_knowledge_and_project"
				has_technology = giga_tech_blokkat_reprogram
				check_variable = {
					which = blokkat_knowledge_value
					value >= 40
				}
			}
		}
	}

	option = { #Reprogram (Totally ethical trust me theyre the ones eating the galaxy)
		name = "giga_blokkat.3210.reprogram.angry" #angry
		trigger = { 
			NOT = { event_target:blokkat_prison_being_managed = { has_megastructure_flag = blokkat_prison_has_breach } }
			NOT = { event_target:blokkat_prison_being_managed = { has_megastructure_flag = blokkat_being_reprogramed } }
			event_target:blokkat_prison_being_managed = { has_megastructure_flag = angry_blokkat }
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3233 }
		}
		allow = {
			custom_tooltip = {
				fail_text = "only_1_reprogram"
				NOT = { has_country_flag = currently_reprogramming_blokkat }
			}
			custom_tooltip = {
				fail_text = "cant_reprogram_if_experiment"
				NOT = { event_target:blokkat_prison_being_managed = { has_megastructure_flag = undertaking_blokkat_experiment } }
			}
			custom_tooltip = {
				fail_text = "blokkat_requires_45_knowledge_and_project"
				has_technology = giga_tech_blokkat_reprogram
				check_variable = {
					which = blokkat_knowledge_value
					value >= 45
				}
			}
		}
	}

	option = { #Reprogram (Totally ethical trust me theyre the ones eating the galaxy)
		name = "giga_blokkat.3210.reprogram.catastrophic" #catastrophic
		trigger = { 
			NOT = { event_target:blokkat_prison_being_managed = { has_megastructure_flag = blokkat_prison_has_breach } }
			NOT = { event_target:blokkat_prison_being_managed = { has_megastructure_flag = blokkat_being_reprogramed } }
			event_target:blokkat_prison_being_managed = { has_megastructure_flag = catastrophic_blokkat }
		}
		hidden_effect = {
			country_event = { id = giga_blokkat.3233 }
		}
		allow = {
			custom_tooltip = {
				fail_text = "only_1_reprogram"
				NOT = { has_country_flag = currently_reprogramming_blokkat }
			}
			custom_tooltip = {
				fail_text = "cant_reprogram_if_experiment"
				NOT = { event_target:blokkat_prison_being_managed = { has_megastructure_flag = undertaking_blokkat_experiment } }
			}
			custom_tooltip = {
				fail_text = "blokkat_requires_55_knowledge_and_project"
				has_technology = giga_tech_blokkat_reprogram
				check_variable = {
					which = blokkat_knowledge_value
					value >= 55
				}
			}
		}
	}


	option = { #Physics
		name = "giga_blokkat.3210.physics"
		custom_tooltip = "giga_blokkat.3210.physics.tooltip"
		trigger = { NOT = { event_target:blokkat_prison_being_managed = { has_megastructure_flag = blokkat_prison_has_breach } } }
		hidden_effect = {
			country_event = { id = giga_blokkat.3210 }
			event_target:blokkat_prison_being_managed = {
				if = {
					limit = { has_megastructure_flag = boosting_blokkat_society }
					remove_megastructure_flag = boosting_blokkat_society
				}
				if = {
					limit = { has_megastructure_flag = boosting_blokkat_engineering }
					remove_megastructure_flag = boosting_blokkat_engineering
				}
				set_megastructure_flag = boosting_blokkat_physics
			}
		}
		allow = {
			custom_tooltip = {
				fail_text = "blokkat_prison_already_doing_this"
				event_target:blokkat_prison_being_managed = {
					NOT = { has_megastructure_flag = boosting_blokkat_physics }
				}
			}
		}
	}

	option = { #Society
		name = "giga_blokkat.3210.society"
		custom_tooltip = "giga_blokkat.3210.society.tooltip"
		trigger = { NOT = { event_target:blokkat_prison_being_managed = { has_megastructure_flag = blokkat_prison_has_breach } } }
		hidden_effect = {
			country_event = { id = giga_blokkat.3210 }
			event_target:blokkat_prison_being_managed = {
				if = {
					limit = { has_megastructure_flag = boosting_blokkat_physics }
					remove_megastructure_flag = boosting_blokkat_physics
				}
				if = {
					limit = { has_megastructure_flag = boosting_blokkat_engineering }
					remove_megastructure_flag = boosting_blokkat_engineering
				}
				set_megastructure_flag = boosting_blokkat_society
			}
		}
		allow = {
			custom_tooltip = {
				fail_text = "blokkat_prison_already_doing_this"
				event_target:blokkat_prison_being_managed = {
					NOT = { has_megastructure_flag = boosting_blokkat_society }
				}
			}
		}
	}

	option = { #Engineering
		name = "giga_blokkat.3210.engineering"
		custom_tooltip = "giga_blokkat.3210.engineering.tooltip"
		trigger = { NOT = { event_target:blokkat_prison_being_managed = { has_megastructure_flag = blokkat_prison_has_breach } } }
		hidden_effect = { 
			country_event = { id = giga_blokkat.3210 }
			event_target:blokkat_prison_being_managed = {
				if = {
					limit = { has_megastructure_flag = boosting_blokkat_physics }
					remove_megastructure_flag = boosting_blokkat_physics
				}
				if = {
					limit = { has_megastructure_flag = boosting_blokkat_society }
					remove_megastructure_flag = boosting_blokkat_society
				}
				set_megastructure_flag = boosting_blokkat_engineering
			}
		}
		allow = {
			custom_tooltip = {
				fail_text = "blokkat_prison_already_doing_this"
				event_target:blokkat_prison_being_managed = {
					NOT = { has_megastructure_flag = boosting_blokkat_engineering }
				}
			}
		}
	}

	option = { #No Focus
		name = "giga_blokkat.3210.nofocus"
		custom_tooltip = "giga_blokkat.3210.nofocus.tooltip"
		trigger = { NOT = { event_target:blokkat_prison_being_managed = { has_megastructure_flag = blokkat_prison_has_breach } } }
		hidden_effect = {
			country_event = { id = giga_blokkat.3210 }
			event_target:blokkat_prison_being_managed = {
				if = {
					limit = { has_megastructure_flag = boosting_blokkat_physics }
					remove_megastructure_flag = boosting_blokkat_physics
				}
				if = {
					limit = { has_megastructure_flag = boosting_blokkat_society }
					remove_megastructure_flag = boosting_blokkat_society
				}
				if = {
					limit = { has_megastructure_flag = boosting_blokkat_engineering }
					remove_megastructure_flag = boosting_blokkat_engineering
				}
			}
		}
		allow = {
			custom_tooltip = {
				fail_text = "blokkat_prison_already_doing_this"
				event_target:blokkat_prison_being_managed = {
					NOT = { 
						AND = { 
							NOT = { has_megastructure_flag = boosting_blokkat_physics }
							NOT = { has_megastructure_flag = boosting_blokkat_society }
							NOT = { has_megastructure_flag = boosting_blokkat_engineering }
						}
					}
				}
			}
		}
	}

	option = { #Release
		name = "giga_blokkat.3210.release"
		custom_tooltip = "giga_blokkat.3210.release.tooltip"
		trigger = { NOT = { event_target:blokkat_prison_being_managed = { has_megastructure_flag = blokkat_prison_has_breach } } }
		hidden_effect = {
			set_country_flag = just_released_blokkat
			remove_global_flag = managing_blokkat_prison
			event_target:blokkat_prison_being_managed = {
				solar_system = {
					spawn_megastructure = {
						type = blokkat_prison_1_empty
						planet = event_target:blokkat_prison_being_managed.planet
						owner = space_owner
					}
				}
				remove_megastructure = THIS
			}
		}
	}

	option = { #Bye
		name = "giga_blokkat.3210.bye"
		default_hide_option = yes
		hidden_effect = { remove_global_flag = managing_blokkat_prison }
	}
}

#construction site of mega
country_event = {
	id = giga_blokkat.3060
	title = "giga_blokkat.3060.name"
	desc = "giga_blokkat.3060.desc"
	is_triggered_only = yes
	show_sound = event_sensor_ping
	picture = GFX_evt_megastructure_construction
	immediate = {
		set_country_flag = destabiliser_stage_0_possible
	}
	option = { #kk
		name = "giga_blokkat.3060.a"
		custom_tooltip = cant_do_another_blokkat_project_tech_tooltip
		add_research_option = giga_tech_blokkat_mega_stage_0
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
			set_country_flag = blokkat_project_underway
		}
	}

	option = { #nvm
		name = "giga_blokkat.3020.b"
		hidden_effect = {
			country_event = { id = giga_blokkat.3000 }
			remove_country_flag = destabiliser_stage_0_possible
		}
	}
}

country_event = {
	id = giga_blokkat.3061
	is_triggered_only = yes

	hide_window = yes

	trigger = {	
		last_increased_tech = giga_tech_blokkat_mega_stage_0
	}

	immediate = {
		remove_country_flag = blokkat_project_underway
		set_country_flag = blokkat_mega_stage_0_researched
		if = {
			limit = {
				event_target:paluushia = {
					exists = THIS
					is_colony = yes
					habitable_planet = yes
					has_ground_combat = no
					owner = {
						is_country_type = primitive
						has_country_flag = paluush_primitives
					}
				}
			}
			country_event = { id = giga_blokkat.3300 days = 30 } #PALUUSH STORYLINE, CHANGE
		}
	}
}

#stage 2 of mega
country_event = {
	id = giga_blokkat.3062
	title = "giga_blokkat.3062.name"
	desc = "giga_blokkat.3062.desc"
	is_triggered_only = yes
	show_sound = event_sensor_ping
	picture = GFX_evt_black_hole
	immediate = {
		set_country_flag = destabiliser_stage_1_possible
	}
	option = { #kk
		name = "giga_blokkat.3062.a"
		custom_tooltip = cant_do_another_blokkat_project_tech_tooltip
		add_research_option = giga_tech_blokkat_mega_stage_1
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
			set_country_flag = blokkat_project_underway
		}
	}

	option = { #nvm
		name = "giga_blokkat.3020.b"
		hidden_effect = {
			country_event = { id = giga_blokkat.3000 }
			remove_country_flag = destabiliser_stage_1_possible
		}
	}
}

country_event = {
	id = giga_blokkat.3063
	is_triggered_only = yes

	hide_window = yes

	trigger = {	
		last_increased_tech = giga_tech_blokkat_mega_stage_1
	}

	immediate = {
		remove_country_flag = blokkat_project_underway
		set_country_flag = blokkat_mega_stage_1_researched
	}
}

#stage 3 of mega
country_event = {
	id = giga_blokkat.3064
	title = "giga_blokkat.3064.name"
	desc = "giga_blokkat.3064.desc"
	is_triggered_only = yes
	show_sound = event_sensor_ping
	picture = GFX_evt_zro_3
	immediate = {
		set_country_flag = destabiliser_stage_2_possible
	}
	option = { #kk
		name = "giga_blokkat.3064.a"
		custom_tooltip = cant_do_another_blokkat_project_tech_tooltip
		add_research_option = giga_tech_blokkat_mega_stage_2
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
			set_country_flag = blokkat_project_underway
		}
	}

	option = { #nvm
		name = "giga_blokkat.3020.b"
		hidden_effect = {
			country_event = { id = giga_blokkat.3000 }
			remove_country_flag = giga_tech_blokkat_mega_stage_2
		}
	}
}

country_event = {
	id = giga_blokkat.3065
	is_triggered_only = yes

	hide_window = yes

	trigger = {	
		last_increased_tech = giga_tech_blokkat_mega_stage_2
	}

	immediate = {
		remove_country_flag = blokkat_project_underway
		set_country_flag = blokkat_mega_stage_2_researched
	}
}

#stage 4 of mega
country_event = {
	id = giga_blokkat.3066
	title = "giga_blokkat.3066.name"
	desc = "giga_blokkat.3066.desc"
	is_triggered_only = yes
	show_sound = event_sensor_ping
	picture = GFX_evt_l-gateway
	immediate = {
		set_country_flag = destabiliser_stage_3_possible
	}
	option = { #kk
		name = "giga_blokkat.3066.a"
		custom_tooltip = cant_do_another_blokkat_project_tech_tooltip
		add_research_option = giga_tech_blokkat_mega_stage_3
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
			set_country_flag = blokkat_project_underway
		}
	}

	option = { #nvm
		name = "giga_blokkat.3020.b"
		hidden_effect = {
			country_event = { id = giga_blokkat.3000 }
			remove_country_flag = destabiliser_stage_3_possible
		}
	}
}

country_event = {
	id = giga_blokkat.3067
	title = "giga_blokkat.3067.name"
	desc = "giga_blokkat.3067.desc"
	is_triggered_only = yes
	show_sound = event_mystic_reveal
	picture = GFX_evt_matter_decompressor

	trigger = {	
		last_increased_tech = giga_tech_blokkat_mega_stage_3
	}

	immediate = {
		remove_country_flag = blokkat_project_underway
		set_country_flag = blokkat_mega_stage_3_researched
	}

	option = { #kk
		name = "giga_blokkat.3067.a"
		custom_tooltip = blokkat_shield_megastructure_ready
	}
}

#mega consite
country_event = {
	id = giga_blokkat.30681
	title = "giga_blokkat.30681.name"
	desc = "giga_blokkat.30681.desc"
	is_triggered_only = yes
	show_sound = event_dyson_sphere_build_start
	picture = GFX_evt_megastructure_construction
	location = event_target:giga_system

	option = { #kk
		name = "giga_blokkat.30681.a"
	}
}

#mega singularity
country_event = {
	id = giga_blokkat.30682
	title = "giga_blokkat.30682.name"
	desc = "giga_blokkat.30682.desc"
	is_triggered_only = yes
	show_sound = event_dyson_sphere_build_upgrade_panel
	picture = GFX_evt_matter_decompressor
	location = event_target:giga_system

	option = { #kk
		name = "giga_blokkat.30682.a"
	}
}

#mega branebreaker
country_event = {
	id = giga_blokkat.30683
	title = "giga_blokkat.30683.name"
	desc = "giga_blokkat.30683.desc"
	is_triggered_only = yes
	show_sound = event_dyson_sphere_build_upgrade_panel
	picture = GFX_evt_vortex
	location = event_target:giga_system

	option = { #kk
		name = "giga_blokkat.30683.a"
	}
}

#mega finished
country_event = {
	id = giga_blokkat.30684
	title = "giga_blokkat.30684.name"
	desc = "giga_blokkat.30684.desc"
	is_triggered_only = yes
	show_sound = event_dyson_sphere_build_complete
	picture = GFX_evt_supernova
	location = event_target:giga_system

	option = { #kk
		name = "giga_blokkat.30684.a"
		custom_tooltip = "giga_blokkat.30684.a.tooltip"
	}
}


#time travel
country_event = {
	id = giga_blokkat.30685
	title = "giga_blokkat.30685.name"
	desc = "giga_blokkat.30685.desc"
	is_triggered_only = yes
	show_sound = event_dyson_sphere_build_complete
	picture = GFX_evt_clocks
	location = event_target:giga_system

	option = { #kk
		name = "giga_blokkat.30685.a"
	}
}

#activate the mega!
country_event = {
	id = giga_blokkat.30691
	title = "giga_blokkat.30691.name"
	desc = {
		text = "giga_blokkat.30691.desc"
		trigger = { NOT = { has_global_flag = giga_chrono_disruptor_activated } }
	}
	desc = {
		text = "giga_blokkat.30691.desc.chrono"
		trigger = { has_global_flag = giga_chrono_disruptor_activated }
	}
	is_triggered_only = yes
	show_sound = event_mystic_reveal
	picture = GFX_evt_supernova
	location = event_target:giga_blokkat_shieldkiller_system

	immediate = {
		set_variable = {
			which = blokkat_shieldkiller_activation_cost
			value = event_target:blokkat_country.blokkat_shieldkiller_activation_cost
		}
	}

	option = { #kk
		name = "giga_blokkat.30691.a"
		custom_tooltip = "giga_blokkat.30691.a.tooltip"
		allow = {
			custom_tooltip = {
				fail_text = "blokkat_not_enough_energy"
				hidden_trigger = {
					resource_stockpile_compare = {
						resource = energy
						value > 1
						mult = blokkat_shieldkiller_activation_cost
					}
				}
			}
		}
		trigger = { NOT = { has_global_flag = just_activated_blokkat_shieldkiller } }
		add_resource = { 
			energy = -1
			mult = blokkat_shieldkiller_activation_cost
		}
		hidden_effect = {
			set_global_flag = just_activated_blokkat_shieldkiller
			country_event = { id = giga_blokkat.30692 days = 20 }
			event_target:blokkat_country = {
				multiply_variable = {
					which = blokkat_shieldkiller_activation_cost
					value = 1.1
				}
				round_variable = blokkat_shieldkiller_activation_cost
			}
			event_target:giga_blokkat_shieldkiller_system = {
				every_system_planet = {
					limit = { is_star = yes }
					create_ambient_object = {
						type = "blokkat_shieldkiller_effect"
						play_animation_once = yes
						location = this
					}
					last_created_ambient_object = {
						set_location = {
							target = prev
							distance = 0
							angle = random
						}
					}
				}
			}
		}
	}

	option = { #no
		name = "giga_blokkat.30691.b"
		custom_tooltip = "giga_blokkat.30691.b.tooltip"
		hidden_effect = {
			remove_global_flag = blokkat_shield_killer_activated
			set_timed_country_flag = {
				flag = cancelled_blokkat_shieldkiller
				days = 2
			}
			event_target:giga_blokkat_shieldkiller_system = {
				every_system_megastructure = {
					limit = { is_megastructure_type = blokkat_shield_killer_activate }
					remove_megastructure = THIS
				}
				spawn_megastructure = {
					type = blokkat_shield_killer_3
					planet = event_target:giga_blokkat_shieldkiller_system.star
					owner = space_owner
				}
			}
		}
	}
}

#yay!
country_event = {
	id = giga_blokkat.30692
	title = "giga_blokkat.30692.name"
	desc = {
		text = "giga_blokkat.30692.desc"
		trigger = { NOT = { has_global_flag = giga_chrono_disruptor_activated } }
	}
	desc = {
		text = "giga_blokkat.30692.desc.chrono"
		trigger = { has_global_flag = giga_chrono_disruptor_activated }
	}
	is_triggered_only = yes
	show_sound = event_power_down
	picture = GFX_evt_vortex

	immediate = {
		set_global_flag = blokkat_mothership_shield_down
		remove_global_flag = just_activated_blokkat_shieldkiller
		every_system = {
			limit = { has_modifier = blokkat_mothership_shield }
			remove_modifier = blokkat_mothership_shield
		}
		every_system = {
			star = {
				create_ambient_object = {
					type = "giga_blokkat_shieldkiller_nebula"
					location = prev
				}
				last_created_ambient_object = {
					set_ambient_object_flag = blokkat_nebula_object
					set_location = {
						target = prev
						distance = 0
						angle = random
					}
				}
				create_ambient_object = {
					type = "space_storm_1"
					location = this
				}
				last_created_ambient_object = {
					set_ambient_object_flag = blokkat_nebula_object
					set_location = {
						target = prev
						distance = 0
						angle = random
					}
				}
			}
		}
		every_country = {
			add_modifier = {
				modifier = blokkat_shieldkiller_broke_reality
				days = 720
			}
		}
		remove_modifier = blokkat_shieldkiller_broke_reality
		set_timed_country_flag = {
			flag = cancelled_blokkat_shieldkiller
			days = 2
		}
		event_target:global_event_country = {
			if = {
				limit = { NOT = { has_global_flag = giga_chrono_disruptor_activated } }
				country_event = { id = giga_blokkat.30693 days = 720 }
			}
			else_if = {
				limit = { has_global_flag = giga_chrono_disruptor_activated }
				country_event = { id = giga_blokkat.30693 days = 2160 }
			}
		}
		if = {
			limit = { NOT = { has_global_flag = giga_chrono_disruptor_activated } }
			event_target:giga_blokkat_shieldkiller_system = {
				every_system_megastructure = {
					limit = { is_megastructure_type = blokkat_shield_killer_activate }
					remove_megastructure = THIS
				}
				spawn_megastructure = {
					type = blokkat_shield_killer_3
					planet = event_target:giga_blokkat_shieldkiller_system.star
					owner = space_owner
				}
			}
		}
		else_if = {
			limit = { has_global_flag = giga_chrono_disruptor_activated }
			event_target:giga_blokkat_shieldkiller_system = {
				every_system_megastructure = {
					limit = { is_megastructure_type = blokkat_shield_killer_activate_chrono }
					remove_megastructure = THIS
				}
				spawn_megastructure = {
					type = blokkat_shield_killer_4
					planet = event_target:giga_blokkat_shieldkiller_system.star
					owner = space_owner
				}
			}
		}
	}

	option = { #kk
		name = "giga_blokkat.30692.a"
		custom_tooltip = "giga_blokkat.30692.a.tooltip"
		add_modifier = {
			modifier = blokkat_shieldkiller_broke_reality
			days = 720
		}
	}
}


#its over!
country_event = {
	id = giga_blokkat.30693
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		remove_global_flag = blokkat_mothership_shield_down
		event_target:blokkat_country = {
			if = {
				limit = { NOT = { has_global_flag = blokkat_crisis_defeated } }
				country_event = { id = giga_blokkat.30695 days = 720 }
			}
		}
		every_system = {
			limit = {
				any_fleet_in_system = { has_fleet_flag = blokkat_mothership_fleet }
			}
			add_modifier = {
				modifier = blokkat_mothership_shield
				days = -1
			}
		}
		every_ambient_object = {
			limit = {
				has_ambient_object_flag = blokkat_nebula_object
			}
			destroy_ambient_object = THIS
		}
		every_country = {
			limit = {
				has_modifier = blokkat_shieldkiller_broke_reality
			}
			remove_modifier = blokkat_shieldkiller_broke_reality
		}
		if = {
			limit = { NOT = { has_global_flag = blokkat_crisis_defeated } }
			every_country = {
				country_event = { id = giga_blokkat.30694 }
			}
		}
	}
}

#its over!
country_event = {
	id = giga_blokkat.30694
	title = "giga_blokkat.30694.name"
	desc = "giga_blokkat.30694.desc"
	is_triggered_only = yes
	show_sound = event_mystic_reveal
	picture = GFX_evt_worrying_signal
	
	trigger = {
		NOT = { has_global_flag = blokkat_crisis_defeated }
	}

	option = { #boo
		name = "giga_blokkat.30694.a"
		custom_tooltip = "giga_blokkat.30694.a.tooltip"
	}
}

country_event = {
	id = giga_blokkat.30695
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		remove_global_flag = blokkat_shield_killer_activated
		every_country = {
			country_event = { id = giga_blokkat.30696 }
		}
	}
}

#can use it again
country_event = {
	id = giga_blokkat.30696
	title = "giga_blokkat.30696.name"
	desc = "giga_blokkat.30696.desc"
	is_triggered_only = yes
	show_sound = event_mystic_reveal
	picture = GFX_evt_physics_research

	option = { #boo
		name = "giga_blokkat.30696.a"
		custom_tooltip = "giga_blokkat.30696.a.tooltip"
	}
}

#(we live in a) Blokkat Society
country_event = {
	id = giga_blokkat.3020
	title = "giga_blokkat.3020.name"
	desc = "giga_blokkat.3020.desc"
	is_triggered_only = yes
	show_sound = event_sensor_ping
	picture = GFX_evt_machine_sapience
	immediate = {
		set_country_flag = blokkat_sociology_possible
	}
	option = { #kk
		name = "giga_blokkat.3020.a"
		custom_tooltip = cant_do_another_blokkat_project_tech_tooltip
		add_research_option = giga_tech_blokkat_sociology_study
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
			set_country_flag = blokkat_project_underway
		}
	}

	option = { #nvm
		name = "giga_blokkat.3020.b"
		hidden_effect = {
			country_event = { id = giga_blokkat.3000 }
			remove_country_flag = blokkat_sociology_possible
		}
	}
}

#results
country_event = {
	id = giga_blokkat.3021
	title = "giga_blokkat.3021.name"
	desc = "giga_blokkat.3021.desc"
	is_triggered_only = yes
	show_sound = event_radio_chatter
	picture = GFX_evt_machine_sapience

	trigger = {	
		last_increased_tech = giga_tech_blokkat_sociology_study
	}

	option = { #kk
		name = "giga_blokkat.3021.a"
		custom_tooltip = "giga_blokkat.3021.a.tooltip"
		hidden_effect = {
			country_event = { id = giga_blokkat.3200 days = 180 } #BLOKKAT CAPTURE EVENT, CHANGE
			set_country_flag = blokkat_society_researched
			remove_country_flag = blokkat_project_underway
			change_variable = {
				which = blokkat_knowledge_value
				value = 1
			}
			change_variable = {
				which = blokkat_knowledge_earned_by_general_study
				value = 1
			}
		}
	}
}

#blokkat flatland
country_event = {
	id = giga_blokkat.3030
	title = "giga_blokkat.3030.name"
	desc = "giga_blokkat.3030.desc"
	is_triggered_only = yes
	show_sound = event_sensor_ping
	picture = GFX_evt_wormhole
	immediate = {
		set_country_flag = blokkat_dimensions_possible
	}
	option = { #kk
		name = "giga_blokkat.3030.a"
		custom_tooltip = cant_do_another_blokkat_project_tech_tooltip
		add_research_option = giga_tech_blokkat_dimension_study
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
			set_country_flag = blokkat_project_underway
		}
	}

	option = { #nvm
		name = "giga_blokkat.3020.b"
		hidden_effect = {
			country_event = { id = giga_blokkat.3000 }
			remove_country_flag = blokkat_dimensions_possible
		}
	}
}

#results
country_event = {
	id = giga_blokkat.3031
	title = "giga_blokkat.3031.name"
	desc = "giga_blokkat.3031.desc"
	is_triggered_only = yes
	show_sound = event_laboratory_sound
	picture = GFX_evt_supernova

	trigger = {	
		last_increased_tech = giga_tech_blokkat_dimension_study
	}

	option = { #kk
		name = "giga_blokkat.3031.a"
		custom_tooltip = "giga_blokkat.3031.a.tooltip"
		hidden_effect = {
			set_country_flag = blokkat_physics_researched
			remove_country_flag = blokkat_project_underway
			change_variable = {
				which = blokkat_knowledge_value
				value = 1
			}
			change_variable = {
				which = blokkat_knowledge_earned_by_general_study
				value = 1
			}
		}
	}
}

#blokkat armor
country_event = {
	id = giga_blokkat.3050
	title = "giga_blokkat.3050.name"
	desc = "giga_blokkat.3050.desc"
	is_triggered_only = yes
	show_sound = event_sensor_ping
	picture = GFX_evt_engineering_research
	immediate = {
		set_country_flag = blokkat_armor_study_possible
	}
	option = { #kk
		name = "giga_blokkat.3050.a"
		custom_tooltip = cant_do_another_blokkat_project_tech_tooltip
		add_research_option = giga_tech_blokkat_armor_study
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
			set_country_flag = blokkat_project_underway
		}
	}

	option = { #nvm
		name = "giga_blokkat.3020.b"
		hidden_effect = {
			country_event = { id = giga_blokkat.3000 }
			remove_country_flag = blokkat_armor_study_possible
		}
		
	}
}

#results
country_event = {
	id = giga_blokkat.3051
	title = "giga_blokkat.3051.name"
	desc = "giga_blokkat.3051.desc"
	is_triggered_only = yes
	show_sound = event_machinery
	picture = GFX_evt_engineering_research

	trigger = {	
		last_increased_tech = giga_tech_blokkat_armor_study
	}

	option = { #kk
		name = "giga_blokkat.3051.a"
		custom_tooltip = "giga_blokkat.3051.a.tooltip"
		hidden_effect = {
			set_country_flag = blokkat_engineering_researched
			remove_country_flag = blokkat_project_underway
			change_variable = {
				which = blokkat_knowledge_value
				value = 1
			}
			change_variable = {
				which = blokkat_knowledge_earned_by_general_study
				value = 1
			}
		}
	}
}

#repeatables
#results
country_event = {
	id = giga_blokkat.3040
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		OR = {
			last_increased_tech = giga_tech_blokkat_society_repeatable
			last_increased_tech = giga_tech_blokkat_physics_repeatable
			last_increased_tech = giga_tech_blokkat_engineering_repeatable
		}
	}

	immediate = {
		change_variable = {
			which = blokkat_knowledge_value
			value = 1
		}
		change_variable = {
			which = blokkat_knowledge_earned_by_repeatables
			value = 1
		}
	}
}

#The Shield
country_event = {
	id = giga_blokkat.3010
	title = "giga_blokkat.3010.name"
	desc = "giga_blokkat.3010.desc"
	is_triggered_only = yes
	show_sound = event_sensor_ping
	picture = GFX_evt_vortex

	option = { #kk
		name = "giga_blokkat.3010.a"
		enable_special_project = {
			name = "RESEARCH_BLOKKAT_SHIELD"
			owner = root
		}
		hidden_effect = {
			remove_country_flag = monitoring_blokkats
		}
	}
}

#The Shield Results
country_event = {
	id = giga_blokkat.3011
	title = "giga_blokkat.3011.name"
	desc = "giga_blokkat.3011.desc"
	is_triggered_only = yes
	show_sound = event_laboratory_sound
	picture = GFX_evt_physics_research

	immediate = {
		remove_country_flag = blokkat_shield_being_researched
		set_country_flag = blokkat_shield_researched
		change_variable = {
			which = blokkat_knowledge_earned_by_general_study
			value = 1
		}
		change_variable = {
			which = blokkat_knowledge_value
			value = 1
		}
	}

	option = { #kk
		name = "giga_blokkat.3011.a"
		custom_tooltip = "giga_blokkat.3011.a.tooltip"
		hidden_effect = {
			country_event = { id = giga_blokkat_join.1000 }
		}
	}
}

#scourge runs away
event = {
	id = giga_blokkat.6600
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		any_country = { is_country_type = blokkat_stripminers }
		any_country = { is_country_type = swarm }
		NOT = { has_global_flag = scourge_ran_away_from_blokkats }
	}

	immediate = {
		every_country = {
			limit = { is_ai = no }
			country_event = { id = giga_blokkat.6607 days = 10 }
		}
		event_target:global_event_country = {
			country_event = { id = giga_blokkat.6606 days = 720 } #Clear Prethoryn when dead
		}
		set_global_flag = scourge_ran_away_from_blokkats
		random_rim_system = { #designate random rim system to flee to
			limit = {
				NOR = { 
					any_ship_in_system = { owner = { is_country_type = blokkat_stripminers } }
					has_star_flag = blokkat_stripmined_system
					has_star_flag = blokkat_system_being_stripmined
					is_star_class = sc_blokkat_stripmined 
				}
			}
			set_star_flag = scourge_escape_system
			save_global_event_target_as = scourge_escape_system
			#set_name = "Bonjour"
		}
		every_galaxy_planet = {
			limit = { is_planet_class = pc_infested }
			event_target:prethoryn = {
				random_list = {
					75 = {
						create_leader = {
							class = admiral
							species = event_target:prethoryn_species
							name = random
							skill = 3
							set_age = 1125
						}
					}
					25 = {
						create_leader = {
							class = admiral
							species = event_target:prethoryn_species
							name = random
							skill = 3
							set_age = 1125
							traits = {
								trait = leader_trait_hive_affinity
							}
						}
					}
				}
			}
			create_fleet = {
				name = "NAME_Prethoryn_Star_Brood"
				effect = {
					set_owner = event_target:prethoryn
					create_ship = {
						name = random
						design = "NAME_Swarm_Queen"
						graphical_culture = "swarm_01"
					}
					assign_leader = last_created_leader
					while = {
						count = 2
						create_ship = {
							name = random
							design = "NAME_Swarm_Large"
							graphical_culture = "swarm_01"
						}
					}
					while = {
						count = 4
						create_ship = {
							name = random
							design = "NAME_Swarm_Carrier"
							graphical_culture = "swarm_01"
						}
					}
					while = {
						count = 10
						create_ship = {
							name = random
							design = "NAME_Swarm_Small"
							graphical_culture = "swarm_01"
						}
					}
					set_location = PREV
					set_fleet_stance = aggressive
					set_aggro_range = 500
					set_aggro_range_measure_from = self
					set_fleet_bombardment_stance = armageddon
				}
			}
			change_pc = pc_barren
		}
		every_country = {
			limit = { is_country_type = swarm }
			set_country_type = swarm_fleeing_blokkats
			#set_name = "oh god oh fuck"
			country_event = { id = giga_blokkat.6603 days = 30 } #Loop it!
			every_owned_fleet = {
				set_fleet_flag = scourge_fleet_fleeing_from_blokkat
				fleet_event = { id = giga_blokkat.6601 } #Fleets bail
			}
			every_owned_ship = {
				limit = {
					OR = {
						is_ship_size = construction_ship_swarm
						is_ship_size = colony_ship_swarm
						is_ship_size = transport_ship_swarm
					}
				}
				delete_ship = THIS
			}
			country_event = { id = giga_blokkat.6604 days = 3600 } #If not escaped by 10 years wipe them anyways
		}
	}
}

#Move to escape route
fleet_event = {
	id = giga_blokkat.6601
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		if = {
			limit = { solar_system = { NOT = { has_star_flag = scourge_escape_system } } }
			fleet_event = { id = giga_blokkat.6601 days = 10 }
		}
		if = {
			limit = {
				OR = { 
					solar_system = { has_star_flag = scourge_escape_system }
					solar_system = { is_rim_system = yes } 
				}
			}
			delete_fleet = THIS
		}
		queue_actions = { #Move to escape route
			find_closest_system = {
				trigger = {
					id = giga_blokkat.6601.trigger.1
					has_star_flag = scourge_escape_system
				}
				found_system = {
					move_to = this
				}
			}
		}
	}
}

#Delete if escape route reached
fleet_event = {
	id = giga_blokkat.6602
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		owner = { is_country_type = swarm_fleeing_blokkats }
		has_global_flag = scourge_ran_away_from_blokkats
		from = {
			OR = {
				is_rim_system = yes
				has_star_flag = scourge_escape_system
			}
		}
	}

	immediate = {
		delete_fleet = THIS
	}
}

#Force all fleets to move to escape route
country_event = {
	id = giga_blokkat.6603
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		country_event = { id = giga_blokkat.6603 days = 30 }
		every_owned_fleet = {
			limit = { NOT = { has_fleet_flag = scourge_fleet_fleeing_from_blokkat } }
			fleet_event = { id = giga_blokkat.6601 }
		}
		every_owned_fleet = {
			limit = {
				OR = {
					solar_system = { is_rim_system = yes }
					solar_system = { has_star_flag = scourge_escape_system }
				}
			}
			delete_fleet = THIS
		}
	}
}

#Clear them all in the end
country_event = {
	id = giga_blokkat.6604
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		any_country = { is_country_type = swarm_fleeing_blokkats }
	}

	immediate = {
		stop_crisis_sound = yes
		end_crisis = yes
		remove_global_flag = ongoing_prethoryn_invasion
		set_global_flag = prethoryn_invasion_defeated
		every_country = {
			limit = { has_event_chain = "prethoryn_scourge_chain" }
			end_event_chain = "prethoryn_scourge_chain"
		}
		event_target:prethoryn = {
			every_owned_fleet = { delete_fleet = THIS } 
			destroy_country = yes 
		}
		if = {
			limit = { exists = event_target:sentinels }
			event_target:sentinels = {
				country_event = { id = crisis.75 days = 15 random = 10 }
			}
		}
	}
}
 
#Debug
country_event = {
	id = giga_blokkat.6605
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		every_galaxy_planet = {
			random = {
				chance = 5
				change_pc = pc_infested
			}
		}
	}
}

#Clear if dead
country_event = {
	id = giga_blokkat.6606
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = { 
				OR = {
					NOT = { any_country = { is_country_type = swarm_fleeing_blokkats } }
					AND = {
						exists = event_target:prethoryn
						event_target:prethoryn = {
							NOR = {
								any_owned_ship = { is_ship_size = large_ship_swarm } 
								any_owned_ship = { is_ship_size = large_ship_carrier_swarm } 
								any_owned_ship = { is_ship_size = small_ship_swarm } 
								any_owned_ship = { is_ship_size = queen_swarm } 
							}
						}
					}
				}
			}
			stop_crisis_sound = yes
			end_crisis = yes
			remove_global_flag = ongoing_prethoryn_invasion
			set_global_flag = prethoryn_invasion_defeated
			every_country = {
				limit = { has_event_chain = "prethoryn_scourge_chain" }
				end_event_chain = "prethoryn_scourge_chain"
			}
			if = {
				limit = { exists = event_target:sentinels }
				event_target:sentinels = {
					country_event = { id = crisis.75 days = 15 random = 10 }
				}
			}
			if = {
				limit = { exists = event_target:prethoryn }
				event_target:prethoryn = {
					every_owned_fleet = { delete_fleet = THIS } 
					destroy_country = yes 
				}
			}
		}
		else = { country_event = { id = giga_blokkat.6606 days = 30 } }
	}
}

country_event = {
	id = giga_blokkat.6607
	title = "giga_blokkat.6607.name"
	desc = "giga_blokkat.6607.desc"
	is_triggered_only = yes
	show_sound = event_yellow_alert
	picture = GFX_evt_worrying_signal

	option = { #kk
		name = "giga_blokkat.6607.a"
		hidden_effect = {
			country_event = { id = giga_blokkat.6608 }
		}
	}
}

country_event = {
	id = giga_blokkat.6608
	title = "TRANSMISSION"
	desc = {
		text = "giga_blokkat.6608.desc.notpsi"
		trigger = {
			NOT = { owner_species = { OR = { has_trait = trait_psionic has_trait = trait_hive_mind } } }
		}
	}
	desc = {
		text = "giga_blokkat.6608.desc.psi"
		trigger = {
			owner_species = { has_trait = trait_psionic }
		}
	}
	desc = {
		text = "giga_blokkat.6608.desc.hive"
		trigger = {
			owner_species = { has_trait = trait_hive_mind }
		}
	}

	diplomatic = yes

	picture_event_data = {
		portrait = swarm1
		room = "swarm_room"
	}

	is_triggered_only = yes

	option = {
		name = "giga_blokkat.6608.b"
		trigger = {
			owner_species = { OR = { has_trait = trait_psionic has_trait = trait_hive_mind } }
		}
		response_text = "giga_blokkat.6608.b.response"
		is_dialog_only = yes
	}

	option = {
		name = "giga_blokkat.6608.c"
		trigger = {
			owner_species = { OR = { has_trait = trait_psionic has_trait = trait_hive_mind } }
		}
		response_text = "giga_blokkat.6608.c.response"
		is_dialog_only = yes
	}

	option = { #kk
		name = "giga_blokkat.6608.a"
	}
}

#####FLEET MOVEMENT#####

#The Unborker!
country_event = {
	id = giga_blokkat.7500
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		every_owned_fleet = {
			limit = {
				has_fleet_flag = blokkat_stripmine_fleet
				NOT = { has_fleet_flag = moving_to_blokkat_mothership_system }
				is_in_combat = no
				solar_system = {
					NOT = { any_ship_in_system = { is_ship_size = giga_blokkat_mothership } }
				}
			}
			ROOT = {
				random_owned_fleet = {
					limit = {
						has_fleet_flag = blokkat_escort_fleet
						check_variable = { which = blokkat_stripminer_id value = PREVPREV.blokkat_stripminer_id }
					}
					destroy_fleet = THIS
				}
				spawn_blokkat_escort_fleet = yes
				spawn_blokkat_harvesting_fleet = yes
			}
			destroy_fleet = THIS
		}
		every_owned_fleet = {
			limit = {
				solar_system = { any_ship_in_system = { is_ship_size = giga_blokkat_mothership } }
			}
			if = {
				limit = { has_fleet_flag = blokkat_stripmine_fleet_moving }
				remove_fleet_flag = blokkat_stripmine_fleet_moving
			}
			if = {
				limit = { has_fleet_flag = blokkat_fleet_just_stripmined_system }
				remove_fleet_flag = blokkat_fleet_just_stripmined_system
			}
		}
	}
}

#Another attempt...this time with fleet events.
country_event = {
	id = giga_blokkat.7000
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		every_owned_ship = {
			limit = {
				has_modifier = blokkat_stripminer_speed_debuff
				is_ship_size = giga_blokkat_harvester
				solar_system = {
					NOR = {
						any_system_megastructure = { is_megastructure_type = blokkat_harvester_charged }
						any_system_megastructure = { is_megastructure_type = blokkat_harvester_charging_up }
					}
				}
			}
			remove_modifier = blokkat_stripminer_speed_debuff
		}
		every_owned_ship = {
			limit = {
				has_modifier = blokkat_stripminer_speed_debuff
				is_ship_size = giga_blokkat_mothership
				solar_system = {
					NOR = {
						any_system_megastructure = { is_megastructure_type = blokkat_harvester_charged_mothership }
						any_system_megastructure = { is_megastructure_type = blokkat_harvester_charging_up_mothership }
					}
				}
			}
			remove_modifier = blokkat_stripminer_speed_debuff
		}
		every_owned_fleet = { #Assign IDs to Blokkat Stripminers
			limit = {
				has_fleet_flag = blokkat_stripmine_fleet
				NOT = { has_fleet_flag = got_blokkat_id }
			}
			set_variable = {
				which = blokkat_stripminer_id
				value = ROOT.current_blokkat_stripminer_max_id
			}
			set_fleet_flag = got_blokkat_id
			ROOT = {
				change_variable = {
					which = current_blokkat_stripminer_max_id
					value = 1
				}
			}
		}
		# if = {
		# 	limit = {
		# 		has_country_flag = blokkat_stripminers_heading_home
		# 		any_system = {
		# 			has_star_flag = blokkat_system_being_stripmined
		# 			NOT = { is_star_class = sc_blokkat_stripmined }
		# 			NOT = { any_ship_in_system = { is_ship_size = giga_blokkat_harvester } }
		# 			NOT = { any_ship_in_system = { is_ship_size = giga_blokkat_mothership } }
		# 		}
		# 	}
		# 	every_system = {
		# 		limit = {
		# 			has_star_flag = blokkat_system_being_stripmined
		# 			NOT = { is_star_class = sc_blokkat_stripmined }
		# 			NOT = { any_ship_in_system = { is_ship_size = giga_blokkat_harvester } }
		# 			NOT = { any_ship_in_system = { is_ship_size = giga_blokkat_mothership } }
		# 		}
		# 		remove_star_flag = blokkat_system_being_stripmined
		# 	}
		# }
		# if = {
		# 	limit = {
		# 		NOT = {
		# 			any_owned_fleet = {
		# 				has_fleet_flag = blokkat_stripmine_fleet
		# 				solar_system = { NOT = { any_ship_in_system = { is_ship_size = giga_blokkat_mothership } } }
		# 			}
		# 		}
		# 		has_country_flag = blokkat_stripminers_heading_home
		# 	}
		# 	remove_country_flag = blokkat_stripminers_heading_home
		# }
		# if = {
		# 	limit = {
		# 		has_country_flag = blokkat_stripminers_heading_home
		# 		NOT = { has_country_flag = blokkat_all_stripmining_fleets_go_home }
		# 	}
		# 	country_event = { id = giga_blokkat.7500 }
		# }
		every_owned_fleet = { #escorts
			limit = {
				has_fleet_flag = blokkat_escort_fleet
			}
			fleet_event = { id = giga_blokkat.7006 }
		}
		every_owned_fleet = { #harvesters
			limit = {
				has_fleet_flag = blokkat_stripmine_fleet
			}
			fleet_event = { id = giga_blokkat.7001 }
		}
		every_owned_fleet = { #mothership
			limit = {
				has_fleet_flag = blokkat_mothership_fleet
			}
			fleet_event = { id = giga_blokkat.7003 }
		}
		if = {
			limit = { NOT = { is_country_type = blokkat_stripminers_defeated } }
			country_event = { id = giga_blokkat.7000 days = 15 }
		}
	}
}

fleet_event = {
	id = giga_blokkat.7006
	hide_window = yes
	is_triggered_only = yes

	immediate = { #Pair them with a random stripmining fleet
		fleet_event = { id = giga_blokkat.7006 days = 15 }
		if = {
			limit = { NOT = { has_fleet_flag = paired_with_stripminer } }
			event_target:blokkat_country = {
				random_owned_fleet = {
					limit = {
						has_fleet_flag = blokkat_stripmine_fleet
						NOT = { has_fleet_flag = paired_with_escort }
					}
					set_fleet_flag = paired_with_escort
					ROOT = {
						set_fleet_flag = paired_with_stripminer
						clear_fleet_actions = this
						clear_orders = yes
						remove_auto_move_target = yes
						auto_follow_fleet = {
							target = PREV
							attack_fleet = no
						}
						set_variable = {
							which = blokkat_stripminer_id
							value = PREV.blokkat_stripminer_id
						}
					}
				}
			}
		}
	}
}

fleet_event = {
	id = giga_blokkat.7008
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		fleet_event = { id = giga_blokkat.7008 days = 15 }
		clear_fleet_actions = this
		clear_orders = yes
		remove_auto_move_target = yes
		auto_follow_fleet = {
			target = event_target:blokkat_mothership_fleet
			attack_fleet = no
		}
	}
}

#Set unbork timer
fleet_event = {
	id = giga_blokkat.7009
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		has_fleet_flag = blokkat_stripmine_fleet
		FROM = { NOT = { is_star_class = sc_blokkat_stripmined } }
	}

	immediate = {
		FROM = { #give it a kick if stuck
			system_event = { id = giga_blokkat.7010 days = 360 }
		}
	}
}

system_event = {
	id = giga_blokkat.7010
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		any_fleet_in_system = { has_fleet_flag = blokkat_stripmine_fleet }
	}

	immediate = {
		if = {
			limit = { any_fleet_in_system = { has_fleet_flag = blokkat_stripmine_fleet } }
			system_event = { id = giga_blokkat.7010 days = 60 }
			every_fleet_in_system = {
				limit = { has_fleet_flag = blokkat_stripmine_fleet }
				queue_actions = {
					find_closest_system = {
						trigger = {
							id = giga_blokkat.7010.trigger.1
							is_same_value = event_target:future_blokkat_mothership_system
						}
						found_system = {
							effect = {
								id = giga_blokkat.7010.trigger.2
								THIS = {
									if = {
										limit = {
											NOT = {
												has_hyperlane_to = event_target:current_blokkat_mothership_system
											}
										}
										add_hyperlane = {
											from = event_target:current_blokkat_mothership_system
											to = THIS
										}
									}
								}
							}
							move_to = this
						}
					}
				}
			}
		}
	}
}

#Set unbork timer (vester)
fleet_event = {
	id = giga_blokkat.7011
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		has_fleet_flag = blokkat_mothership_fleet
		FROM = { NOT = { is_star_class = sc_blokkat_stripmined } }
	}

	immediate = {
		FROM = { #give it a kick if stuck
			system_event = { id = giga_blokkat.7012 days = 540 }
		}
	}
}

system_event = {
	id = giga_blokkat.7012
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		any_fleet_in_system = { has_fleet_flag = blokkat_mothership_fleet }
	}

	immediate = {
		set_timed_global_flag = {
			flag = blokkats_respawned_to_unstuck
			days = 180
		}
		if = {
			limit = { 
				any_fleet_in_system = { has_fleet_flag = blokkat_mothership_fleet } 
			}
			system_event = { id = giga_blokkat.7012 days = 30 }
			if = {
				limit = { event_target:blokkat_mothership_fleet = { is_in_combat = no } }
				event_target:blokkat_mothership_fleet = { set_disabled = yes }
				event_target:blokkat_mothership_fleet = { destroy_fleet = THIS }
			}
		}
	}
}

fleet_event = { #this event is ran monthly on the harvesting fleets
	id = giga_blokkat.7001
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = { #is vibing in the mothership system and hasn't stripmined anything, hasn't found a target system yet
				NOT = { has_fleet_flag = blokkat_fleet_just_stripmined_system }
				NOT = { has_fleet_flag = blokkat_stripmine_fleet_moving }
				solar_system = {
					any_fleet_in_system = {
						has_fleet_flag = blokkat_mothership_fleet
					}	
				}
			}
			if = {
				limit = { has_fleet_flag = moving_to_blokkat_mothership_system }
				remove_fleet_flag = moving_to_blokkat_mothership_system
			}
			queue_actions = {
				find_closest_system = {
					trigger = {
						id = giga_blokkat.7000.trigger.1
						NOR = {
							systems_blokkats_wont_stripmine = yes
							has_star_flag = blokkat_stripmined_system #already stripmined
							has_star_flag = blokkat_system_being_stripmined #will be stripmined
							is_same_value = event_target:current_blokkat_mothership_system #the mothership
						}
					}
					found_system = {
						effect = {
							id = giga_blokkat.7000.trigger.2
							THIS = {
								set_star_flag = blokkat_system_being_stripmined
								set_star_flag = blokkat_harvester_en_route
								ROOT = {
									set_fleet_flag = blokkat_stripmine_fleet_moving #So it doesn't try to endlessly queue orders to other systems
									set_timed_fleet_flag = { #So it goes to the star and stops if it takes too long
										flag = blokkat_stripmine_fleet_goes_to_star
										days = 30
									}
								}
								if = {
									limit = {
										NOT = { has_hyperlane_to = event_target:current_blokkat_mothership_system } 
									}
									add_hyperlane = {
										from = event_target:current_blokkat_mothership_system
										to = THIS
									}
								}
								set_variable = {
									which = blokkat_target_system_id
									value = ROOT.blokkat_stripminer_id #Assign it an ID
								}
							}
						}
						move_to = this
					}
				}
			}
		}
		if = {
			limit = { #is vibing in the mothership system and hasn't stripmined anything, has found a target system
				NOT = { has_fleet_flag = blokkat_fleet_just_stripmined_system }
				has_fleet_flag = blokkat_stripmine_fleet_moving
				solar_system = {
					any_fleet_in_system = {
						has_fleet_flag = blokkat_mothership_fleet
					}
				}
			}
			remove_fleet_flag = blokkat_stripmine_fleet_moving
			queue_actions = {
				find_closest_system = {
					trigger = {
						id = giga_blokkat.7000.trigger.3
						NOR = {
							has_star_flag = blokkat_stripmined_system #already stripmined
							has_star_flag = blokkat_system_being_stripmined #will be stripmined
						}
						check_variable = {
							which = blokkat_target_system_id
							value = ROOT.blokkat_stripminer_id
						}
					}
					found_system = {
						effect = {
							id = giga_blokkat.7000.trigger.4
							THIS = {
								if = {
									limit = {
										NOT = { has_hyperlane_to = event_target:current_blokkat_mothership_system } 
									}
									add_hyperlane = {
										from = event_target:current_blokkat_mothership_system
										to = THIS
									}
								}
							}
						}
						move_to = this
					}
				}
			}
		}
		if = {
			limit = {
				NOT = { has_fleet_flag = blokkat_stripmine_fleet_goes_to_star } #doesnt care about going to the star anymore
				solar_system = {
					has_star_flag = blokkat_system_being_stripmined #system being stripmined but isnt actually being harvested yet
					NOT = { has_star_flag = blokkat_stripmined_system }
					NOT = { any_fleet_in_system = { has_fleet_flag = blokkat_mothership_fleet } }
				}
				NOT = { has_fleet_flag = blokkat_charging_up } #isnt already making the based mega
			}
			clear_fleet_actions = this
			clear_orders = yes
			set_fleet_flag = blokkat_charging_up
			create_ambient_object = {
				type = "blokkat_harvester_temp_object"
				location = THIS
			}
			last_created_ambient_object = {
				save_global_event_target_as = giga_temp_blokkat_planet
			}
			solar_system = {
				every_ship_in_system = {
					limit = {
						is_ship_size = giga_blokkat_harvester
					}
					add_modifier = {
						modifier = blokkat_stripminer_speed_debuff
						days = -1
					}
				}
				spawn_megastructure = {
					type = blokkat_harvester_charging_up
					owner = event_target:blokkat_country
					coords_from = event_target:giga_temp_blokkat_planet
				}
				random_system_megastructure = {
					limit = { is_megastructure_type = blokkat_harvester_charging_up }
					upgrade_megastructure_to = blokkat_harvester_charged
				}
				event_target:giga_temp_blokkat_planet = {
					destroy_ambient_object = THIS
				}
			}
		}
		if = {
			limit = {
				has_fleet_flag = blokkat_fleet_just_stripmined_system #just broke a system lol
				solar_system = {
					has_star_flag = blokkat_stripmined_system #system being stripmined but isnt actually being harvested yet
					NOT = { #not in the mothership system
						any_fleet_in_system = {
							has_fleet_flag = blokkat_mothership_fleet
						}
					}
				}
			}
			set_fleet_flag = moving_to_blokkat_mothership_system
			queue_actions = {
				find_closest_system = {
					trigger = {
						id = giga_blokkat.7001.trigger.5
						any_fleet_in_system = {
							has_fleet_flag = blokkat_mothership_fleet
						}
					}
					found_system = {
						effect = {
							id = giga_blokkat.7001.trigger.6
							THIS = {
								if = {
									limit = {
										NOT = {
											has_hyperlane_to = PREVPREV.solar_system
										}
									}
									add_hyperlane = {
										from = PREVPREV.solar_system
										to = THIS
									}
								}
							}
						}
						move_to = this
					}
				}
			}
		}
		if = {
			limit = {
				has_fleet_flag = blokkat_fleet_just_stripmined_system #can return home
				has_fleet_flag = blokkat_found_destination
				solar_system = {
					has_star_flag = blokkat_stripmined_system
				}
				OR = {
					solar_system = {
						any_fleet_in_system = { #in the mothership system
							has_fleet_flag = blokkat_mothership_fleet
						}
					}
					event_target:future_blokkat_mothership_system = {
						any_fleet_in_system = { #in the mothership system
							has_fleet_flag = blokkat_mothership_fleet
						}
					}
				}
			}
			queue_actions = {
				find_closest_system = {
					trigger = {
						id = giga_blokkat.7001.trigger.7
						is_same_value = event_target:future_blokkat_mothership_system
					}
					found_system = {
						effect = {
							id = giga_blokkat.7001.trigger.8
							THIS = {
								if = {
									limit = {
										NOT = {
											has_hyperlane_to = event_target:current_blokkat_mothership_system
										}
									}
									add_hyperlane = {
										from = event_target:current_blokkat_mothership_system
										to = THIS
									}
								}
							}
						}
						move_to = this
					}
				}
			}
		}
	}
}


#Clear the giant megastructure when system is deleted and move ship back to mothership.
system_event = {
	id = giga_blokkat.7002
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		remove_star_flag = blokkat_system_being_stripmined
		blokkat_increment_system_ships = yes
		every_fleet_in_system = {
			limit = {
				owner = { NOT = { is_country_type = blokkat_stripminers } }
			}
			destroy_fleet = THIS
		}
		every_ambient_object = {
			destroy_ambient_object = THIS
		}
		every_system_megastructure = {
			limit = {
				NOT = { mega_blokkats_wont_stripmine = yes }
			}
			remove_megastructure = THIS
		}
		every_system_planet = {
			limit = { is_star = no NOT = { has_planet_flag = blokkat_dont_delete_yet } }
			if = {
				limit = {
					is_colony = yes
					owner = { count_owned_planet = { count <= 1 } }
				}
				owner = { set_country_flag = destroyed_by_blokkats }
			}
			giga_remove_planet = yes
		}
		random_fleet_in_system = {
			limit = { has_fleet_flag = blokkat_stripmine_fleet }
			set_fleet_flag = blokkat_fleet_just_stripmined_system
		}
		every_ship_in_system = {
			limit = { has_modifier = blokkat_stripminer_speed_debuff }
			remove_modifier = blokkat_stripminer_speed_debuff
		}
	}
}

fleet_event = {
	id = giga_blokkat.7007
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		ROOT = { has_fleet_flag = blokkat_mothership_fleet }
	}

	immediate = {
		every_system = {
			limit = { has_modifier = blokkat_mothership_shield }
			remove_modifier = blokkat_mothership_shield
		}
		if = {
			limit = {
				NOT = { has_global_flag = blokkat_mothership_shield_down }
			}
			FROM = {
				add_modifier = { modifier = blokkat_mothership_shield }
			}
		}
	}
}

fleet_event = { #this event is ran monthly on the mothership fleet
	id = giga_blokkat.7003
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				solar_system = {
					exists = THIS
					is_same_value = event_target:future_blokkat_mothership_system
				}
			}
			remove_fleet_flag = blokkat_found_destination
		}

		# ---- Unstuck the Vester ----
		random_system_megastructure = {
			limit = {
				OR = {
					is_megastructure_type = blokkat_harvester_charging_up_mothership
					is_megastructure_type = blokkat_harvester_charged_mothership
				}
			}
			solar_system = {
				set_star_flag = blokkat_system_being_stripmined_true
			}
		}
		if = { 
			limit = {
				solar_system = {
					exists = this
					has_star_flag = blokkat_system_being_stripmined
					NOT = { has_star_flag = blokkat_system_being_stripmined_true }
				}
			}
			solar_system = {
				remove_star_flag = blokkat_system_being_stripmined
				set_star_flag = blokkat_system_being_stripmined_true
			}
			remove_fleet_flag = blokkat_mothership_fleet_goes_to_star
		} else_if = {
			limit = {
				solar_system = {
					has_star_flag = blokkat_system_being_stripmined_true
					NOT = { has_star_flag = blokkat_system_being_stripmined }
				}
			}
			solar_system = {
				set_star_flag = blokkat_system_being_stripmined
			}
		}
		# ---- End of Patch ----
		
		if = {
			limit = {
				NOT = { has_fleet_flag = blokkat_mothership_fleet_goes_to_star }
				solar_system = {
					exists = THIS
					NOR = {
						has_star_flag = blokkat_stripmined_system
						has_star_flag = blokkat_system_being_stripmined
					}
				}
			}
			#we also respawn broken ships here
			if = {
				limit = {
					NOT = { has_global_flag = blokkat_crisis_defeated }
					event_target:blokkat_country = { 
						has_country_flag = blokkat_stripmine_fleet_needs_repairs
						NOT = { has_country_flag = blokkat_stripmine_fleet_repair_cooldown } 
					}
				}
				event_target:blokkat_country = {
					spawn_blokkat_escort_fleet = yes
					spawn_blokkat_harvesting_fleet = yes
					every_country = {
						limit = { is_ai = no }
						country_event = { id = giga_blokkat.1044 }
					}
					remove_country_flag = blokkat_stripmine_fleet_needs_repairs #it will be set again by the next inquietude monthly event
					remove_country_flag = hasnt_repaired_stripmine_fleet_yet
				}
			}
			create_ambient_object = {
				type = "blokkat_harvester_temp_object"
				location = THIS
			}
			last_created_ambient_object = {
				save_global_event_target_as = giga_temp_blokkat_planet
			}
			solar_system = {
				set_star_flag = blokkat_system_being_stripmined
				every_ship_in_system = {
					limit = {
						is_ship_size = giga_blokkat_mothership
					}
					add_modifier = {
						modifier = blokkat_stripminer_speed_debuff
						days = -1
					}
				}
				spawn_megastructure = {
					type = blokkat_harvester_charging_up_mothership
					owner = event_target:blokkat_country
					coords_from = event_target:giga_temp_blokkat_planet
				}
				random_system_megastructure = {
					limit = { is_megastructure_type = blokkat_harvester_charging_up_mothership }
					upgrade_megastructure_to = blokkat_harvester_charged_mothership
				}
				event_target:giga_temp_blokkat_planet = {
					destroy_ambient_object = THIS
				}
			}
		}
		if = {
			limit = { #if all harvesters just stripmined stuff and are in the mothership system, move to new system
				solar_system = {
					has_star_flag = blokkat_stripmined_system
				}
				event_target:blokkat_country = {
					NOT = {
						any_owned_fleet = { #all blokkat stripmine fleets are vibing in the mothership system and just stripmined stuff
							has_fleet_flag = blokkat_stripmine_fleet
							NOT = {
								solar_system = {
									any_fleet_in_system = {
										has_fleet_flag = blokkat_mothership_fleet
									}
								}
							}
						}
					}
					NOT = {
						any_owned_fleet = {
							has_fleet_flag = blokkat_stripmine_fleet
							NOT = { has_fleet_flag = blokkat_fleet_just_stripmined_system }
						}
					}
				}
			}
			if = {
				limit = {
					NOT = { has_fleet_flag = blokkat_found_destination } 
				}
				event_target:current_blokkat_mothership_system = {
					every_neighbor_system = { remove_hyperlane = { from = prev to = this } }
				}
				clear_orders = yes
				clear_fleet_actions = this
				queue_actions = {
					find_closest_system = {
						trigger = {
							id = giga_blokkat.7003.trigger.1
							NOR = {
								systems_blokkats_wont_stripmine = yes
								is_same_value = event_target:current_blokkat_mothership_system
								has_star_flag = blokkat_stripmined_system
							}
						}
						found_system = {
							effect = {
								id = giga_blokkat.7003.trigger.2
								THIS = {
									set_star_flag = future_blokkat_mothership_system
									clear_global_event_target = future_blokkat_mothership_system
									save_global_event_target_as = future_blokkat_mothership_system
									if = {
										limit = {
											NOT = {
												has_hyperlane_to = event_target:current_blokkat_mothership_system
											}
										}
										add_hyperlane = {
											from = event_target:current_blokkat_mothership_system
											to = THIS
										}
									}
								}
								event_target:blokkat_country = {
									every_owned_fleet = {
										limit = {
											OR = {
												has_fleet_flag = blokkat_stripmine_fleet
												has_fleet_flag = blokkat_mothership_fleet
											}
										}
										set_fleet_flag = blokkat_found_destination
									}
									random_owned_fleet = {
										limit = {
											has_fleet_flag = blokkat_mothership_fleet
										}
										set_timed_fleet_flag = {
											flag = blokkat_mothership_fleet_goes_to_star
											days = 30
										}
									}
								}
							}
							move_to = this
						}
					}
				}
			}
			if = {
				limit = {
					has_fleet_flag = blokkat_found_destination
					solar_system = {
						exists = THIS
						NOT = { is_same_value = event_target:future_blokkat_mothership_system }
					}
				}
				queue_actions = {
					find_closest_system = {
						trigger = {
							id = giga_blokkat.7003.trigger.3
							is_same_value = event_target:future_blokkat_mothership_system
						}
						found_system = {
							effect = {
								id = giga_blokkat.7003.trigger.4
								THIS = {
									if = {
										limit = {
											NOT = {
												has_hyperlane_to = event_target:current_blokkat_mothership_system
											}
										}
										add_hyperlane = {
											from = event_target:current_blokkat_mothership_system
											to = THIS
										}
									}
								}
							}
							move_to = this
						}
					}
				}
			}
		}
		random_system = { 
			limit = {
				any_fleet_in_system = { has_fleet_flag = blokkat_mothership_fleet }
			}
			save_global_event_target_as = current_blokkat_mothership_system
		}
	}
}

fleet_event = {
	id = giga_blokkat.7004
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		OR = {
			has_fleet_flag = blokkat_stripmine_fleet
			has_fleet_flag = blokkat_mothership_fleet
		}
		has_fleet_flag = blokkat_found_destination
		has_fleet_flag = blokkat_fleet_just_stripmined_system
	}
	
	immediate = {
		remove_fleet_flag = blokkat_found_destination
		remove_fleet_flag = blokkat_fleet_just_stripmined_system
	}
}

#OLD STUFF

system_event = {
	id = giga_blokkat.7005
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		every_ship_in_system = {
			limit = { has_modifier = blokkat_stripminer_speed_debuff }
			remove_modifier = blokkat_stripminer_speed_debuff
		}
		blokkat_increment_system_ships = yes
		every_fleet_in_system = {
			limit = {
				owner = { NOT = { is_country_type = blokkat_stripminers } }
			}
			destroy_fleet = THIS
		}
		every_ambient_object = {
			destroy_ambient_object = THIS
		}
		every_system_megastructure = {
			limit = {
				NOT = { mega_blokkats_wont_stripmine = yes }
			}
			remove_megastructure = THIS
		}
		every_system_planet = {
			limit = { is_star = no NOT = { has_planet_flag = blokkat_dont_delete_yet } }
			if = {
				limit = {
					is_colony = yes
					owner = { count_owned_planet = { count <= 1 } }
				}
				owner = { set_country_flag = destroyed_by_blokkats }
			}
			giga_remove_planet = yes
		}
	}
}

#Doing it via a monthly script
country_event = {
	id = giga_blokkat.8000
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		every_owned_fleet = { #Assign IDs to Blokkat Stripminers
			limit = {
				has_fleet_flag = blokkat_stripmine_fleet
				NOT = { has_fleet_flag = got_blokkat_id }
			}
			set_variable = {
				which = blokkat_stripminer_id
				value = ROOT.current_blokkat_stripminer_max_id
			}
			set_fleet_flag = got_blokkat_id
			ROOT = {
				change_variable = {
					which = current_blokkat_stripminer_max_id
					value = 1
				}
			}
		}
		every_system = {
			limit = {
				has_star_flag = blokkat_stripmined_system
			}
			clear_variable = blokkat_target_system_id
		}
		country_event = { id = giga_blokkat.8000 days = 10 }
		if = { #FIRST PHASE: The mothership system has been stripmined and the harvester ships are being sent out.
			limit = { check_variable = { which = current_blokkat_phase value = 1 } }
			every_owned_fleet = { #This is the initial "pulse", it will start by targeting neighboring systems and giving them an ID
				limit = {
					has_fleet_flag = blokkat_stripmine_fleet
					NOT = { has_fleet_flag = blokkat_stripmine_fleet_moving }
				}
				set_timed_fleet_flag = {
					flag = blokkat_stripmine_fleet_goes_to_star
					days = 60
				}
				queue_actions = {
					find_closest_system = {
						trigger = {
							id = giga_blokkat.8000.trigger.1
							NOR = {
								has_star_flag = blokkat_stripmined_system
								has_star_flag = blokkat_system_being_stripmined
								is_same_value = event_target:current_blokkat_mothership_system 
							}
						}
						found_system = {
							effect = {
								id = giga_blokkat.8000.trigger.2
								THIS = {
									PREVPREV = {
										set_fleet_flag = blokkat_stripmine_fleet_moving #So it doesn't try to endlessly queue orders to other systems
									}
									if = {
										limit = {
											NOT = { has_hyperlane_to = event_target:current_blokkat_mothership_system } 
										}
										add_hyperlane = {
											from = event_target:current_blokkat_mothership_system
											to = THIS
										}
									}
									set_variable = {
										which = blokkat_target_system_id
										value = PREVPREV.blokkat_stripminer_id #Assign it an ID
									}
									set_star_flag = blokkat_system_being_stripmined
									set_star_flag = blokkat_harvester_en_route
								}
							}
							move_to = this
						}
					}
				}
			}
			every_owned_fleet = { #Now it will push them over and over in case they get into combat
				limit = {
					has_fleet_flag = blokkat_stripmine_fleet
					has_fleet_flag = blokkat_stripmine_fleet_moving
				}
				queue_actions = {
					find_closest_system = {
						trigger = {
							id = giga_blokkat.8000.trigger.3
							check_variable = {
								which = blokkat_target_system_id #Find the associated system with the right ID and move there
								value = PREV.blokkat_stripminer_id
							}
						}
						found_system = {
							effect = {
								id = giga_blokkat.8000.trigger.4
								THIS = {
									if = {
										limit = {
											NOT = { has_hyperlane_to = event_target:current_blokkat_mothership_system } 
										}
										add_hyperlane = {
											from = event_target:current_blokkat_mothership_system
											to = THIS
										}
									}
								}
							}
							move_to = this
						}
					}
				}
			}
			if = { #If all fleets have reached other systems, we can start the second phase.
				limit = {
					NOT = {
						any_owned_fleet = {
							has_fleet_flag = blokkat_stripmine_fleet
							solar_system = { is_same_value = event_target:current_blokkat_mothership_system }
						}
					}
					NOT = {
						any_owned_fleet = {
							has_fleet_flag = blokkat_stripmine_fleet_goes_to_star
						}
					}
				}
				set_variable = {
					which = current_blokkat_phase
					value = 2
				}
			}
		}
		if = { #SECOND PHASE: The ships are all in new, non-stripmined systems, and will now spawn the stripmining mega regardless of their current combat stance.
			limit = { check_variable = { which = current_blokkat_phase value = 2 } }
			every_owned_fleet = {
				limit = { has_fleet_flag = blokkat_stripmine_fleet_moving }
				remove_fleet_flag = blokkat_stripmine_fleet_moving
			}
			every_owned_fleet = {
				limit = {
					has_fleet_flag = blokkat_stripmine_fleet
					NOT = { has_fleet_flag = blokkat_charging_up }
				}
				add_modifier = {
					modifier = blokkat_stripminer_speed_debuff
					days = -1
				}
				clear_fleet_actions = this
				clear_orders = yes
			}
			every_system = {
				limit = {
					has_star_flag = blokkat_system_being_stripmined
					any_fleet_in_system = {
						has_fleet_flag = blokkat_stripmine_fleet
					}
					NOR = {
						any_system_megastructure = { is_megastructure_type = blokkat_harvester_charging_up }
						any_system_megastructure = { is_megastructure_type = blokkat_harvester_charged }
					}
				}
				random_fleet_in_system = {
					limit = { 
						has_fleet_flag = blokkat_stripmine_fleet
						NOT = { has_fleet_flag = blokkat_charging_up } 
					}
					set_fleet_flag = blokkat_charging_up
					create_ambient_object = {
						type = "blokkat_harvester_temp_object"
						location = THIS
					}
					last_created_ambient_object = {
						save_global_event_target_as = giga_temp_blokkat_planet
					}
				}
				spawn_megastructure = {
					type = blokkat_harvester_charging_up
					owner = event_target:blokkat_country
					coords_from = event_target:giga_temp_blokkat_planet
				}
				random_system_megastructure = {
					limit = { is_megastructure_type = blokkat_harvester_charging_up }
					upgrade_megastructure_to = blokkat_harvester_charged
				}
				event_target:giga_temp_blokkat_planet = {
					destroy_ambient_object = THIS
				}
			}
			if = { #If all fleets have just stripmined, time for phase 3
				limit = {
					NOT = {
						any_owned_fleet = {
							has_fleet_flag = blokkat_stripmine_fleet
							NOT = { has_fleet_flag = blokkat_fleet_just_stripmined_system }
						}
					}
				}
				set_variable = {
					which = current_blokkat_phase
					value = 3
				}
			}
		}
		if = { #THIRD PHASE: They return to the mothership when they are done.
			limit = { check_variable = { which = current_blokkat_phase value = 3 } }
			every_owned_fleet = {
				limit = {
					has_fleet_flag = blokkat_stripmine_fleet
					has_fleet_flag = blokkat_fleet_just_stripmined_system
				}
				remove_fleet_flag = blokkat_charging_up
				queue_actions = {
					find_closest_system = {
						trigger = {
							id = giga_blokkat.8000.trigger.5
							is_same_value = event_target:current_blokkat_mothership_system 
						}
						found_system = {
							effect = {
								id = giga_blokkat.8000.trigger.6
								THIS = {
									if = {
										limit = {
											NOT = {
												has_hyperlane_to = PREVPREV.solar_system
											}
										}
										add_hyperlane = {
											from = PREVPREV.solar_system
											to = THIS
										}
									}
								}
							}
							move_to = this
						}
					}
				}
			}
			if = {
				limit = {
					NOT = {
						any_owned_fleet = {
							has_fleet_flag = blokkat_stripmine_fleet
							solar_system = {
								NOT = { is_same_value = event_target:current_blokkat_mothership_system }
							}
						}
					}
				}
				every_owned_fleet = {
					limit = { has_fleet_flag = blokkat_fleet_just_stripmined_system }
					remove_fleet_flag = blokkat_fleet_just_stripmined_system
				}
				set_variable = {
					which = current_blokkat_phase
					value = 4
				}
			}
		}
		if = { #FOURTH PHASE: They all move to a new system
			limit = { check_variable = { which = current_blokkat_phase value = 4 } }
			if = {
				limit = {
					event_target:current_blokkat_mothership_system = {
						NOT = { has_star_flag = blokkats_wiped_hyperlanes }
					}
				}
				event_target:current_blokkat_mothership_system = {
					every_neighbor_system = { remove_hyperlane = { from = prev to = this } }
					set_star_flag = blokkats_wiped_hyperlanes
				}
			}
			event_target:blokkat_mothership_fleet = { #Locate a good neighbor system
				if = {
					limit = {
						NOT = { has_fleet_flag = blokkat_found_destination } 
					}
					queue_actions = {
						find_closest_system = {
							trigger = {
								id = giga_blokkat.8000.trigger.7
								NOR = {
									is_same_value = event_target:current_blokkat_mothership_system
									has_star_flag = blokkat_stripmined_system
								}
							}
							found_system = {
								effect = {
									id = giga_blokkat.8000.trigger.8
									THIS = {
										save_global_event_target_as = future_blokkat_mothership_system
										set_star_flag = future_blokkat_mothership_system
										if = {
											limit = {
												NOT = {
													has_hyperlane_to = event_target:current_blokkat_mothership_system
												}
											}
											add_hyperlane = {
												from = event_target:current_blokkat_mothership_system
												to = THIS
											}
										}
									}
									event_target:blokkat_country = {
										every_owned_fleet = {
											limit = {
												OR = {
													has_fleet_flag = blokkat_stripmine_fleet
													has_fleet_flag = blokkat_mothership_fleet
												}
											}
											set_fleet_flag = blokkat_found_destination
										}
										random_owned_fleet = {
											limit = {
												has_fleet_flag = blokkat_mothership_fleet
											}
											set_timed_fleet_flag = {
												flag = blokkat_mothership_fleet_goes_to_star
												days = 30
											}
										}
									}
								}
								move_to = this
							}
						}
					}
				}
			}
			every_owned_fleet = { #Now just push everyone to there.
				limit = {
					has_fleet_flag = blokkat_found_destination
				}
				queue_actions = {
					find_closest_system = {
						trigger = {
							id = giga_blokkat.8000.trigger.9
							is_same_value = event_target:future_blokkat_mothership_system
						}
						found_system = {
							# effect = {
							# 	id = giga_blokkat.8000.trigger.10
							# }
							move_to = this
						}
					}
				}
			}
			if = {
				limit = {
					event_target:future_blokkat_mothership_system = {
						any_fleet_in_system = {
							has_fleet_flag = blokkat_mothership_fleet
						}
						any_fleet_in_system = {
							has_fleet_flag = blokkat_stripmine_fleet
						}
					}
				}
				set_variable = { #If they're all in the new system, time for phase 5.
					which = current_blokkat_phase
					value = 5
				}
				every_owned_fleet = {
					limit = { has_fleet_flag = blokkat_found_destination }
					remove_fleet_flag = blokkat_found_destination
				}
				event_target:future_blokkat_mothership_system = {
					save_global_event_target_as = current_blokkat_mothership_system
				}
			}
		}
		if = { #FIFTH PHASE: Mothership stripmines its system and it starts again.
			limit = { check_variable = { which = current_blokkat_phase value = 5 } }
			if = {
				limit = {
					event_target:current_blokkat_mothership_system = { NOT = { has_star_flag = blokkat_stripmined_system } }
				}
				event_target:current_blokkat_mothership_system = {
					blokkat_harvest_system_mothership = yes
				}
			}
		}
	}
}

#The Blokkat stripminers will head to other systems.
#First step of the cycle: All stripmining ships head to other systems and begin the harvesting.
country_event = {
	id = giga_blokkat.9000
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		set_global_flag = blokkat_stripmining_underway
		event_target:blokkat_country = {
			every_owned_fleet = {
				limit = {
					has_fleet_flag = blokkat_stripmine_fleet
				}
				queue_actions = {
					find_closest_system = {
						trigger = {
							id = giga_blokkat.9000.trigger.1
							NOR = {
								has_star_flag = blokkat_stripmined_system
								has_star_flag = blokkat_system_being_stripmined
								is_same_value = event_target:current_blokkat_mothership_system 
							}
						}
						found_system = {
							effect = {
								id = giga_blokkat.9000.trigger.2
								THIS = {
									add_hyperlane = {
										from = event_target:current_blokkat_mothership_system
										to = THIS
									}
									set_star_flag = blokkat_system_being_stripmined
								}
							}
							move_to = this
						}
					}
				}
			}
		}
	}
}

#When a Harvester enters a system, build the "charging up" mega
fleet_event = {
	id = giga_blokkat.9001
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_fleet_flag = blokkat_stripmine_fleet
		has_global_flag = blokkat_stripmining_underway
		from = {
			NOT = {
				has_star_flag = blokkat_stripmined_system
			}
		}
	}
	
	immediate = {
		from = {
			star = {
				planet_event = { id = giga_blokkat.9002 days = 20 } #CHANGE TO 30
			}
		}
	}
}

#Place the "charging up" mega
planet_event = {
	id = giga_blokkat.9002
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		solar_system = {
			random_fleet_in_system = {
				limit = { has_fleet_flag = blokkat_stripmine_fleet }
			}
			spawn_megastructure = {
				type = blokkat_harvester_charging_up
				owner = event_target:blokkat_country
				planet = ROOT
			}
			random_system_megastructure = {
				limit = { is_megastructure_type = blokkat_harvester_charging_up }
				upgrade_megastructure_to = blokkat_harvester_charged
			}
		}
	}
}

#Clear the giant megastructure when system is deleted and move ship back to mothership.
planet_event = {
	id = giga_blokkat.9003
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		solar_system = {
			remove_star_flag = blokkat_system_being_stripmined
			every_fleet_in_system = {
				limit = {
					owner = { NOT = { is_country_type = blokkat_stripminers } }
				}
				destroy_fleet = THIS
			}
			every_ambient_object = {
				destroy_ambient_object = THIS
			}
			every_system_megastructure = {
				limit = {
					NOR = {
						is_megastructure_type = gateway_0
						is_megastructure_type = gateway_0
						is_megastructure_type = gateway_restored
						is_megastructure_type = gateway_ruined
						is_megastructure_type = lgate_base
						is_megastructure_type = ehof_pgate_unknown
						is_megastructure_type = ehof_pgate_gateway
					}
				}
				remove_megastructure = THIS
			}
			every_system_planet = {
				limit = { is_star = no }
				giga_remove_planet = yes
			}
			random_fleet_in_system = {
				limit = { has_fleet_flag = blokkat_stripmine_fleet }
				set_fleet_flag = blokkat_fleet_just_stripmined_system
			}
			every_ship_in_system = {
				limit = { has_modifier = blokkat_stripminer_speed_debuff }
				remove_modifier = blokkat_stripminer_speed_debuff
			}
		}
	}
}

planet_event = {
	id = giga_blokkat.90031
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		solar_system = {
			remove_star_flag = blokkat_system_being_stripmined
			every_fleet_in_system = {
				limit = {
					owner = { NOT = { is_country_type = blokkat_stripminers } }
				}
				destroy_fleet = THIS
			}
			every_ambient_object = {
				destroy_ambient_object = THIS
			}
			every_system_megastructure = {
				limit = {
					NOR = {
						is_megastructure_type = gateway_0
						is_megastructure_type = gateway_0
						is_megastructure_type = gateway_restored
						is_megastructure_type = gateway_ruined
						is_megastructure_type = lgate_base
						is_megastructure_type = ehof_pgate_unknown
						is_megastructure_type = ehof_pgate_gateway
					}
				}
				remove_megastructure = THIS
			}
			every_system_planet = {
				limit = { is_star = no }
				giga_remove_planet = yes
			}
		}
		event_target:blokkat_country = { #Restart everything over again.
			set_variable = {
				which = current_blokkat_phase
				value = 1
			}
		}
	}
}

#When a Harvester enters the mothership system and all other Harvesters are within the mothership system, move the mothership
fleet_event = {
	id = giga_blokkat.9004
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_fleet_flag = blokkat_stripmine_fleet
		has_global_flag = blokkat_return_fleet #This means the fleets are in the process of coming back to the mothership
		event_target:blokkat_country = {
			NOT = {
				any_owned_fleet = {
					has_fleet_flag = blokkat_stripmine_fleet
					solar_system = {
						NOT = { is_same_value = event_target:current_blokkat_mothership_system  }
					}
				}
			}
		}
	}
	
	immediate = {
		remove_global_flag = blokkat_stripmining_underway
		remove_global_flag = blokkat_return_fleet
		event_target:current_blokkat_mothership_system = {
			every_neighbor_system = { remove_hyperlane = { from = prev to = this } }
		}
		event_target:blokkat_country = {
			random_owned_fleet = {
				limit = {
					has_fleet_flag = blokkat_mothership_fleet
				}
				queue_actions = {
					find_closest_system = {
						trigger = {
							id = giga_blokkat.9004.trigger.1
							NOR = {
								is_same_value = event_target:current_blokkat_mothership_system
								has_star_flag = blokkat_stripmined_system
							}
						}
						found_system = {
							effect = {
								id = giga_blokkat.9004.trigger.2
								THIS = {
									if = {
										limit = {
											NOT = {
												has_hyperlane_to = event_target:current_blokkat_mothership_system
											}
										}
										add_hyperlane = {
											from = event_target:current_blokkat_mothership_system
											to = THIS
										}
									}
								}
								save_global_event_target_as = current_blokkat_mothership_system
							}
							move_to = this
						}
					}
				}
			}
			every_owned_fleet = {
				limit = {
					NOT = { has_fleet_flag = blokkat_mothership_fleet }
				}
				queue_actions = {
					find_closest_system = {
						trigger = {
							id = giga_blokkat.9004.trigger.3
							is_same_value = event_target:current_blokkat_mothership_system
						}
						found_system = {
							# effect = {
							# 	id = giga_blokkat.9004.trigger.4
							# }
							move_to = this
						}
					}
				}
			}
		}
	}
}

#When the mothership enters a new system, build the "charging up" mega
fleet_event = {
	id = giga_blokkat.9005
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_fleet_flag = blokkat_mothership_fleet
	}
	
	immediate = {
		owner = {
			country_event = { id = giga_blokkat.9000 days = 5 } #And so it begins once more...
		}
		from = {
			save_global_event_target_as = current_blokkat_mothership_system
			star = {
				planet_event = { id = giga_blokkat.9002 days = 20 } #CHANGE TO 30
			}
		}
	}
}

#Place the "charging up" mega for the mothership
planet_event = {
	id = giga_blokkat.9006
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		solar_system = {
			random_fleet_in_system = {
				limit = { has_fleet_flag = blokkat_mothership_fleet }
			}
			spawn_megastructure = {
				type = blokkat_harvester_charging_up
				owner = event_target:blokkat_country
				planet = ROOT
			}
			random_system_megastructure = {
				limit = { is_megastructure_type = blokkat_harvester_charging_up }
				upgrade_megastructure_to = blokkat_harvester_charged
			}
		}
	}
}

#Debug
planet_event = {
	id = giga_blokkat.2001
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		solar_system = {
			blokkat_harvest_system = yes
		}
	}
}

#Delete a planet every day
planet_event = {
	id = giga_blokkat.2002
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				solar_system = {
					any_system_planet = {
						is_star = no
						NOT = { has_planet_flag = blokkat_dont_delete_yet }
					}
				}
			}
			solar_system = {
				blokkat_increment_system_ships = yes
				every_fleet_in_system = {
					limit = {
						owner = { 
							NOR = {
								is_country_type = blokkat_stripminers
								is_country_type = blokkat_stripminers_ascended_country
							}
						 }
					}
					destroy_fleet = THIS
				}
				random_system_planet = {
					limit = { is_star = no NOT = { has_planet_flag = blokkat_dont_delete_yet } }
					if = {
						limit = {
							is_colony = yes
							owner = { count_owned_planet = { count <= 1 } }
						}
						owner = { set_country_flag = destroyed_by_blokkats }
					}
					giga_remove_planet = yes
				}
			}
		}
		if = {
			limit = {
				solar_system = {
					any_system_planet = {
						is_star = no
						NOT = { has_planet_flag = blokkat_dont_delete_yet }
					}
				}
			}
			planet_event = { id = giga_blokkat.2002 days = 1 }
		}
	}
}

system_event = {
	id = giga_blokkat.2003
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		blokkat_increment_system_ships = yes
		every_fleet_in_system = {
			limit = {
				owner = {
					NOR = {
						is_country_type = blokkat_stripminers
						has_country_flag = blokkat_stripminers_ascended_country
					}
				}
			}
			destroy_fleet = THIS
		}
		if = {
			limit = {
				any_system_ambient_object = { is_ambient_object_type = blokkat_star_collapse }
			}
			system_event = { id = giga_blokkat.2003 days = 1 }
		}
	}
}

#is this a crossover episode?
country_event = {
	id = giga_blokkat.5500
	title = "giga_blokkat.5500.name"
	desc = "giga_blokkat.5500.desc"
	is_triggered_only = yes
	
	picture_event_data = {
		portrait = event_target:blokkat_sbtg_warning_species
		room = blokkat_stellarborne_message_room
	}
	
	is_triggered_only = yes
	force_open = yes

	diplomatic = yes

	trigger = {
		is_ai = no
		has_global_flag = sbtg_blokkat_light_block
		is_country_type = original_empire_active
		NOT = { has_country_flag = sb_told_about_blokkats }
	}

	immediate = {
		create_species = {
			name = "hello"
			class = PROGENITOR
			portrait = progenitors
			traits = {
				trait = trait_pc_all_preference
				trait = trait_bionic_implants
				trait = trait_ancient_race
				trait = trait_ancient_knowledge
				trait = trait_master_mind
			}
			immortal = yes
			effect = { save_global_event_target_as = blokkat_sbtg_warning_species }
		}
		create_country = {
			name = "good day to you"
			type = giga_t3_tech_dump
			species = event_target:blokkat_sbtg_warning_species
			name_list = "Stellarborne"
			authority = auth_sofe_ancients
			civics = { 						# Custom civics with bonuses against AEs here
				civic = civic_eternal_fleet
				civic = civic_know_everything
				civic = civic_solar_empire
			}
			ignore_initial_colony_error = yes
			flag = {
				icon= {
					category = "original"
					file = "original_empire_flag.dds"
				}
				background= {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors={
					"black"
					"beige"
					"null"
					"null"
				}
			}
			effect = { save_global_event_target_as = blokkat_sbtg_warning_country }
			# ROOT = { establish_communications_no_message = event_target:blokkat_sbtg_warning_country }
			# establish_contact = {
			# 	who = event_target:blokkat_sbtg_warning_country
			# 	location = ROOT.capital_scope
			# }
		}
		set_country_flag = sb_told_about_blokkats
		every_owned_fleet = {
			limit = { has_fleet_flag = sbtg_loc_created_fleet }
			delete_fleet = THIS
		}
	}

	option = { #wtf
		name = "giga_blokkat.5500.a"
		custom_tooltip = "giga_blokkat.5500.a.tooltip"
		hidden_effect = {
			event_target:blokkat_sbtg_warning_country = { destroy_country = YES }
		}
	}
}

#blokks won (somehow)
country_event = {
	id = giga_blokkat.5501
	title = "giga_blokkat.5501.name"
	desc = "giga_blokkat.5501.desc"
	is_triggered_only = yes
	
	picture_event_data = {
		portrait = event_target:blokkat_sbtg_warning_species
		room = blokkat_stellarborne_message_room
	}
	
	is_triggered_only = yes
	force_open = yes

	diplomatic = yes

	pre_triggers = {
		is_ai = no
		
	}

	trigger = {
		has_global_flag = sbtg_blokkat_light_block
		is_country_type = original_empire_active
		any_country = { is_country_type = blokkat_stripminers }
		NOT = {
			any_galaxy_planet = {
				is_colony = yes
				owner = { is_country = ROOT }
			}
		}
		has_country_flag = sb_told_about_blokkats
		NOT = { has_global_flag = blokkats_won_tournament }
	}

	immediate = {
		set_global_flag = blokkats_won_tournament
		create_species = {
			name = "hello"
			class = PROGENITOR
			portrait = progenitors
			traits = {
				trait = trait_pc_all_preference
				trait = trait_bionic_implants
				trait = trait_ancient_race
				trait = trait_ancient_knowledge
				trait = trait_master_mind
			}
			immortal = yes
			effect = { save_global_event_target_as = blokkat_sbtg_warning_species }
		}
		create_country = {
			name = "good day to you"
			type = giga_t3_tech_dump
			species = event_target:blokkat_sbtg_warning_species
			name_list = "Stellarborne"
			authority = auth_sofe_ancients
			civics = { 						# Custom civics with bonuses against AEs here
				civic = civic_eternal_fleet
				civic = civic_know_everything
				civic = civic_solar_empire
			}
			ignore_initial_colony_error = yes
			flag = {
				icon= {
					category = "original"
					file = "original_empire_flag.dds"
				}
				background= {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors={
					"black"
					"beige"
					"null"
					"null"
				}
			}
			effect = { save_global_event_target_as = blokkat_sbtg_warning_country }
			# ROOT = { establish_communications_no_message = event_target:blokkat_sbtg_warning_country }
			# establish_contact = {
			# 	who = event_target:blokkat_sbtg_warning_country
			# 	location = ROOT.capital_scope
			# }
		}
	}

	option = { #wtf
		name = "giga_blokkat.5501.a"
		custom_tooltip = "giga_blokkat.5501.a.tooltip"
		hidden_effect = {
			ROOT = { every_owned_fleet = { destroy_fleet = THIS } }
		}
	}
}


#DEBUG

namespace = blokkat_debug

# +5 Knowledge
country_event = {
	id = blokkat_debug.1
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		change_variable = {
			which = blokkat_knowledge_value
			value = 5
		}
	}
}

# +20 Scrap
country_event = {
	id = blokkat_debug.2
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		change_variable = {
			which = blokkat_scrap_value
			value = 20
		}
	}
}

# Blokkat Damage Debuff
country_event = {
	id = blokkat_debug.3
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		every_system = {
			add_modifier = {
				modifier = blokkat_system_modifier
				days = -1
			}
		}
	}
}

# +10 Inquietude
country_event = {
	id = blokkat_debug.4
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		change_variable = {
			which = blokkat_inquietude_value
			value = 10
		}
	}
}

country_event = { #make blokkats really weak
	id = blokkat_debug.5
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		event_target:blokkat_country = {
			add_modifier = {
				modifier = aeternum_debug_debuff
				days = -1
			}
		}
	}
}

country_event = {
	id = blokkat_debug.6
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		event_target:blokkat_country = {
			remove_modifier = aeternum_debug_debuff
		}
	}
}

country_event = {
	id = blokkat_debug.7
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		event_target:blokkat_country = {
			change_variable = {
				which = blokkat_mothership_life_count
				value = 1
			}
		}
	}
}

# +300 Scrap
country_event = {
	id = blokkat_debug.8
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		change_variable = {
			which = blokkat_scrap_value
			value = 300
		}
	}
}

# Spawn Terminator
planet_event = {
	id = blokkat_debug.9
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		solar_system = { spawn_blokkat_combat_fleet = yes }
	}
}

country_event = {
	id = blokkat_debug.10
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		event_target:global_event_country = {
			set_variable = {
				which = current_blokkat_prison_max_id
				value = 1
			}
		}
		every_country = {
			set_variable = {
				which = blokkat_prison_research_time
				value = 8
			}
		}
	}
}

event = {
	id = blokkat_debug.1000
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = { NOT = { has_global_flag = blokkats_managed_to_spawn } }
			set_global_flag = blokkats_managed_to_spawn
		}
		event_target:global_event_country = {
			set_variable = {
				which = blokkat_distance_from_galaxy
				value = 15000 #lightyears, blokkats will spawn 5 to 10 years after initial event.
			}
			country_event = { id = giga_blokkat.1003 days = 80 }
		}
		every_country = {
			country_event = { id = giga_blokkat.1001 } #Initial popup
			country_event = { id = giga_blokkat.1002 days = 10 }
		}
	}
}

country_event = {
	id = blokkat_debug.1001
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		change_country_flag = {
			icon={
				category="Blokkat"
				file="Blokkat_flag.dds"
			}
			background={
				category="backgrounds"
				file="triangle_split.dds"
			}
			colors={
				"red"
				"red"
				"null"
				"null"
			}
		}
	}
}
